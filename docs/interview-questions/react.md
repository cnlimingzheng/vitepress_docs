# React é¢è¯•é¢˜

## React18æœ‰å“ªäº›æ›´æ–°ï¼Ÿ

React 18 çš„æ ¸å¿ƒæ›´æ–°å›´ç»• **å¹¶å‘æ¸²æŸ“ï¼ˆConcurrent Renderingï¼‰** å±•å¼€ï¼Œå¸¦æ¥æ€§èƒ½ã€å¼€å‘ä½“éªŒå’Œ API ä¸€è‡´æ€§ä¸‰å¤§æå‡ã€‚ä¸»è¦æ›´æ–°å¦‚ä¸‹ï¼š

---

### ä¸€ã€**è‡ªåŠ¨æ‰¹å¤„ç†ï¼ˆAutomatic Batchingï¼‰**
- **é—®é¢˜**ï¼šReact 17 åŠä¹‹å‰ï¼Œåªæœ‰ React äº‹ä»¶ä¸­çš„å¤šä¸ª `setState` ä¼šè¢«åˆå¹¶ï¼ˆæ‰¹å¤„ç†ï¼‰ï¼Œè€Œ `setTimeout`ã€Promise ç­‰å¼‚æ­¥å›è°ƒä¸­ä¸ä¼šã€‚
- **æ”¹è¿›**ï¼š**æ‰€æœ‰åœºæ™¯ä¸‹çš„çŠ¶æ€æ›´æ–°éƒ½ä¼šè‡ªåŠ¨æ‰¹å¤„ç†**ï¼Œå‡å°‘ä¸å¿…è¦çš„é‡æ¸²æŸ“ã€‚
  ```js
  setTimeout(() => {
    setA(a + 1);
    setB(b + 1); // React 18 ä¸­åªè§¦å‘ä¸€æ¬¡æ¸²æŸ“
  }, 0);
  ```

---

### äºŒã€**æ–°æ ¹ APIï¼ˆNew Root APIï¼‰**
- **æ—§**ï¼š`ReactDOM.render(<App />, root)`
- **æ–°**ï¼š
  ```js
  import { createRoot } from 'react-dom/client';
  const root = createRoot(document.getElementById('root'));
  root.render(<App />);
  ```
- **æ„ä¹‰**ï¼šä¸ºå¹¶å‘ç‰¹æ€§ï¼ˆå¦‚ `startTransition`ã€`useDeferredValue`ï¼‰æä¾›è¿è¡Œæ—¶æ”¯æŒã€‚

---

### ä¸‰ã€**å¹¶å‘ç‰¹æ€§ï¼ˆConcurrent Featuresï¼‰**
> å¹¶å‘ä¸æ˜¯â€œå¹¶è¡Œâ€ï¼Œè€Œæ˜¯ **å¯ä¸­æ–­ã€å¯æ¢å¤ã€å¸¦ä¼˜å…ˆçº§çš„æ¸²æŸ“æœºåˆ¶**ã€‚

#### 1. **`startTransition` / `useTransition`**
- æ ‡è®°**éç´§æ€¥æ›´æ–°**ï¼ˆå¦‚æœç´¢ã€åˆ‡æ¢ Tabï¼‰ï¼Œé¿å…é˜»å¡ç”¨æˆ·äº¤äº’ã€‚
  ```js
  const [isPending, startTransition] = useTransition();
  startTransition(() => {
    setSearchQuery(input); // ä½ä¼˜å…ˆçº§æ›´æ–°
  });
  ```

#### 2. **`useDeferredValue`**
- å»¶è¿Ÿæ¸²æŸ“æŸéƒ¨åˆ† UIï¼ˆç±»ä¼¼é˜²æŠ–ï¼Œä½†ç”± React è°ƒåº¦ï¼‰ï¼š
  ```js
  const deferredQuery = useDeferredValue(query);
  ```

#### 3. **`<Suspense>` æ”¯æŒ SSR å’Œæ›´å¤šåœºæ™¯**
- ä¸å†ä»…é™äº `lazy` + `Suspense`ï¼Œå¯ç”¨äºæ•°æ®è¯·æ±‚ã€è¿‡æ¸¡åŠ¨ç”»ç­‰ã€‚

---

### å››ã€**Strict Mode æ”¹è¿›**
- **ç§»é™¤åŒé‡æ¸²æŸ“å‰¯ä½œç”¨**ï¼š  
  React 18 çš„ Strict Mode **ä¸å†åŒé‡è°ƒç”¨ `useEffect` çš„ cleanup å’Œ setup**ï¼ˆä»…åœ¨å¼€å‘ç¯å¢ƒæ¨¡æ‹Ÿå¸è½½/é‡è£…ç»„ä»¶æœ¬èº«ï¼‰ã€‚
- ç›®çš„ï¼šå¸®åŠ©å¼€å‘è€…ç¼–å†™æ›´å¥å£®çš„å¯å¤ç”¨ç»„ä»¶ã€‚

---

### äº”ã€**æ–°çš„ Hook**
- `useId()`ï¼šç”Ÿæˆç¨³å®šã€SSR å®‰å…¨çš„å”¯ä¸€ IDï¼ˆç”¨äº label/for å…³è”ï¼‰
- `useSyncExternalStore`ï¼šé›†æˆå¤–éƒ¨çŠ¶æ€åº“ï¼ˆå¦‚ Reduxï¼‰çš„æ¨èæ–¹å¼
- `useInsertionEffect`ï¼šCSS-in-JS åº“ä¸“ç”¨ï¼Œç¡®ä¿æ ·å¼åœ¨ DOM å˜æ›´å‰æ³¨å…¥

---

### å…­ã€**å…¶ä»–æ”¹è¿›**
- æ›´å¥½çš„ TypeScript æ”¯æŒ
- ç§»é™¤éƒ¨åˆ†è¿‡æ—¶ APIï¼ˆå¦‚ `ReactDOM.render` å°†åœ¨æœªæ¥åºŸå¼ƒï¼‰
- æ”¯æŒç°ä»£æµè§ˆå™¨ï¼ˆIE11 ä¸å†æ”¯æŒï¼‰

---

âœ… **æ€»ç»“**ï¼š  
React 18 ä¸æ˜¯é¢ è¦†æ€§é‡æ„ï¼Œè€Œæ˜¯**é€šè¿‡å¹¶å‘èƒ½åŠ›ä¸ºæœªæ¥æ‰“åŸºç¡€**ã€‚å®ƒè®©åº”ç”¨æ›´æµç•…ã€æ›´æ–°æ›´æ™ºèƒ½ï¼Œå¹¶ç»Ÿä¸€äº†çŠ¶æ€æ›´æ–°è¡Œä¸ºã€‚å‡çº§æˆæœ¬ä½ï¼Œæ”¶ç›Šé«˜ï¼Œ**å¼ºçƒˆå»ºè®®è¿ç§»**ã€‚

## JSXæ˜¯ä»€ä¹ˆï¼Œå®ƒå’ŒJSæœ‰ä»€ä¹ˆåŒºåˆ«

### **JSX æ˜¯ä»€ä¹ˆï¼Ÿ**
JSXï¼ˆJavaScript XMLï¼‰æ˜¯ **JavaScript çš„è¯­æ³•æ‰©å±•**ï¼Œç”¨äºåœ¨ JS ä»£ç ä¸­**å£°æ˜å¼åœ°æè¿° UI ç»“æ„**ã€‚å®ƒçœ‹èµ·æ¥åƒ HTMLï¼Œä½†æœ€ç»ˆä¼šè¢«ç¼–è¯‘æˆæ™®é€šçš„ JavaScript å‡½æ•°è°ƒç”¨ã€‚

```jsx
// JSX
const element = <h1>Hello, {name}!</h1>;

// ç¼–è¯‘åï¼ˆReact.createElementï¼‰
const element = React.createElement('h1', null, 'Hello, ', name, '!');
```

> âœ… **æ ¸å¿ƒæœ¬è´¨**ï¼šJSX æ˜¯ `React.createElement()` çš„è¯­æ³•ç³–ï¼ˆä¸ä»…é™äº Reactï¼Œä¹Ÿå¯ç”¨äº Vueã€Solid ç­‰ï¼‰ã€‚

---

### **JSX ä¸ JS çš„åŒºåˆ«**

| ç‰¹æ€§         | JavaScript (JS)                              | JSX                                          |
| ------------ | -------------------------------------------- | -------------------------------------------- |
| **ç”¨é€”**     | é€šç”¨ç¼–ç¨‹è¯­è¨€                                 | **ä¸“ç”¨äºæè¿° UI ç»“æ„**                       |
| **è¯­æ³•**     | æ ‡å‡† JS è¯­æ³•                                 | ç±» HTML è¯­æ³•ï¼ˆå¦‚ `<div>`ã€`{}` æ’å€¼ï¼‰        |
| **æ‰§è¡Œæ–¹å¼** | æµè§ˆå™¨/Node ç›´æ¥è¿è¡Œ                         | **å¿…é¡»ç»ç¼–è¯‘**ï¼ˆBabelã€TS ç­‰ï¼‰è½¬ä¸º JS        |
| **è¡¨è¾¾å¼**   | ç›´æ¥å†™é€»è¾‘                                   | åœ¨ `{}` ä¸­åµŒå…¥ JS è¡¨è¾¾å¼ï¼ˆå¦‚ `{user.name}`ï¼‰ |
| **å…ƒç´ åˆ›å»º** | æ‰‹åŠ¨è°ƒç”¨ `document.createElement` æˆ–æ¡†æ¶ API | å£°æ˜å¼å†™æ ‡ç­¾ï¼Œç”±ç¼–è¯‘å™¨è½¬ä¸ºå‡½æ•°è°ƒç”¨           |

---

### **å…³é”®è§„åˆ™**
1. **å¿…é¡»å¼•å…¥ Reactï¼ˆReact 17+ å¯çœç•¥ï¼‰**  
   ï¼ˆå›  JSX ç¼–è¯‘ä¾èµ– `React.createElement`ï¼‰
2. **åªèƒ½è¿”å›ä¸€ä¸ªæ ¹å…ƒç´ **  
   ```jsx
   // âŒ é”™è¯¯
   return (<div></div><span></span>);
   // âœ… æ­£ç¡®
   return (<><div></div><span></span></>);
   ```
3. **å±æ€§å‘½åç”¨é©¼å³°**ï¼ˆå¦‚ `className` è€Œé `class`ï¼‰
4. **è‡ªé—­åˆæ ‡ç­¾å¿…é¡»é—­åˆ**ï¼š`<img />` è€Œé `<img>`

---

### **ä¸ºä»€ä¹ˆç”¨ JSXï¼Ÿ**
- **ç›´è§‚**ï¼šç»“æ„æ¸…æ™°ï¼Œæ¥è¿‘ HTML
- **é«˜æ•ˆ**ï¼šç¼–è¯‘æ—¶é™æ€åˆ†æä¼˜åŒ–
- **å®‰å…¨**ï¼šè‡ªåŠ¨è½¬ä¹‰é˜²æ­¢ XSSï¼ˆ`{userInput}` ä¼šè¢«è½¬ä¹‰ï¼‰

---

âœ… **ä¸€å¥è¯æ€»ç»“**ï¼š  
**JSX ä¸æ˜¯å­—ç¬¦ä¸²ï¼Œä¹Ÿä¸æ˜¯ HTMLï¼Œè€Œæ˜¯ç¼–è¯‘æˆ JS å‡½æ•°è°ƒç”¨çš„è¯­æ³•ç³–ï¼Œè®© UI ä»£ç æ›´ç®€æ´ã€å¯è¯»ã€å¯ç»´æŠ¤ã€‚**

## ç®€è¿°Reactçš„ç”Ÿå‘½å‘¨æœŸ

React çš„ç”Ÿå‘½å‘¨æœŸåˆ†ä¸º **æŒ‚è½½ï¼ˆMountingï¼‰**ã€**æ›´æ–°ï¼ˆUpdatingï¼‰** å’Œ **å¸è½½ï¼ˆUnmountingï¼‰** ä¸‰ä¸ªé˜¶æ®µã€‚**React 16.3+ å¼•å…¥æ–° APIï¼Œ17+ åºŸå¼ƒéƒ¨åˆ†æ—§é’©å­ï¼Œå‡½æ•°ç»„ä»¶ç”¨ Hooks æ›¿ä»£**ã€‚

---

### ä¸€ã€**ç±»ç»„ä»¶ç”Ÿå‘½å‘¨æœŸï¼ˆReact 16.3+ æ¨èå†™æ³•ï¼‰**

#### âœ… **æŒ‚è½½é˜¶æ®µ**
1. `constructor()`ï¼šåˆå§‹åŒ– stateã€ç»‘å®šæ–¹æ³•  
2. `static getDerivedStateFromProps(props, state)`ï¼š**æ ¹æ® props æ´¾ç”Ÿ state**ï¼ˆæå°‘ç”¨ï¼‰  
3. `render()`ï¼šè¿”å› JSXï¼ˆçº¯å‡½æ•°ï¼Œæ— å‰¯ä½œç”¨ï¼‰  
4. `componentDidMount()`ï¼š**å‘èµ·è¯·æ±‚ã€è®¢é˜…ã€æ“ä½œ DOM**ï¼ˆä»…å®¢æˆ·ç«¯æ‰§è¡Œï¼‰

#### âœ… **æ›´æ–°é˜¶æ®µ**
1. `static getDerivedStateFromProps()`  
2. `shouldComponentUpdate(nextProps, nextState)`ï¼š**æ€§èƒ½ä¼˜åŒ–**ï¼Œè¿”å› `false` é˜»æ­¢æ¸²æŸ“  
3. `render()`  
4. `getSnapshotBeforeUpdate(prevProps, prevState)`ï¼š**æ•è· DOM æ›´æ–°å‰çš„çŠ¶æ€**ï¼ˆå¦‚æ»šåŠ¨ä½ç½®ï¼‰  
5. `componentDidUpdate(prevProps, prevState, snapshot)`ï¼š**å¤„ç†æ›´æ–°åçš„å‰¯ä½œç”¨**ï¼ˆå¦‚å‘è¯·æ±‚ï¼‰

#### âœ… **å¸è½½é˜¶æ®µ**
- `componentWillUnmount()`ï¼š**æ¸…ç†å®šæ—¶å™¨ã€å–æ¶ˆè®¢é˜…ã€ç§»é™¤ç›‘å¬**

> âš ï¸ **å·²åºŸå¼ƒ**ï¼ˆä¸æ¨èä½¿ç”¨ï¼‰ï¼š  
> `componentWillMount`ã€`componentWillReceiveProps`ã€`componentWillUpdate`

---

### äºŒã€**å‡½æ•°ç»„ä»¶ï¼šç”¨ Hooks æ›¿ä»£**
- `useEffect(() => { ... }, [])` â‰ˆ `componentDidMount` + `componentWillUnmount`
- `useEffect(() => { ... })` â‰ˆ `componentDidUpdate`
- `useMemo` / `useCallback` â‰ˆ `shouldComponentUpdate` ä¼˜åŒ–
- æ— ç›´æ¥ç­‰ä»·äº `getSnapshotBeforeUpdate` çš„ Hook

---

### ä¸‰ã€**å…³é”®åŸåˆ™**
- **é¿å…åœ¨ `render` ä¸­å†™å‰¯ä½œç”¨**
- **ä¼˜å…ˆç”¨å‡½æ•°ç»„ä»¶ + Hooks**ï¼ˆæ›´ç®€æ´ã€é€»è¾‘å¤ç”¨å¼ºï¼‰
- **æ–°ç”Ÿå‘½å‘¨æœŸæ›´å®‰å…¨**ï¼šå»é™¤äº†å®¹æ˜“å¼•å‘ bug çš„ `will` é’©å­

---

âœ… **ä¸€å¥è¯æ€»ç»“**ï¼š  
React ç”Ÿå‘½å‘¨æœŸæ˜¯ç»„ä»¶ä»åˆ›å»ºåˆ°é”€æ¯çš„å…¨è¿‡ç¨‹æ§åˆ¶æœºåˆ¶ï¼Œ**ç±»ç»„ä»¶ç”¨æ–°é’©å­ï¼Œå‡½æ•°ç»„ä»¶ç”¨ Hooks**ï¼Œæ ¸å¿ƒç›®æ ‡æ˜¯**åˆç†ç®¡ç†å‰¯ä½œç”¨ä¸æ€§èƒ½**ã€‚

## Reactäº‹ä»¶æœºåˆ¶å’ŒåŸç”ŸDOMäº‹ä»¶æµæœ‰ä»€ä¹ˆåŒºåˆ«

React çš„äº‹ä»¶æœºåˆ¶ï¼ˆ**åˆæˆäº‹ä»¶ï¼ŒSyntheticEvent**ï¼‰ä¸åŸç”Ÿ DOM äº‹ä»¶æµæœ‰ä»¥ä¸‹æ ¸å¿ƒåŒºåˆ«ï¼š

---

### ä¸€ã€**äº‹ä»¶ç»‘å®šä½ç½®ä¸åŒ**
- **åŸç”Ÿ DOM**ï¼š  
  äº‹ä»¶å¯ç»‘å®šåœ¨**ä»»æ„å…ƒç´ **ä¸Šï¼Œæ”¯æŒ**å†’æ³¡ï¼ˆbubbleï¼‰å’Œæ•è·ï¼ˆcaptureï¼‰** é˜¶æ®µã€‚
- **React**ï¼š  
  æ‰€æœ‰äº‹ä»¶**å§”æ‰˜åˆ° documentï¼ˆReact 16ï¼‰æˆ– root å®¹å™¨ï¼ˆReact 17+ï¼‰** ä¸Šç»Ÿä¸€å¤„ç†ï¼ˆäº‹ä»¶å§”æ‰˜ï¼‰ã€‚

> âœ… ä¼˜åŠ¿ï¼šå‡å°‘å†…å­˜å ç”¨ï¼Œé¿å…é¢‘ç¹ add/remove listenerã€‚

---

### äºŒã€**äº‹ä»¶å¯¹è±¡ä¸åŒ**
- **åŸç”Ÿäº‹ä»¶**ï¼šæµè§ˆå™¨åŸç”Ÿ `Event` å¯¹è±¡ã€‚
- **React äº‹ä»¶**ï¼š**è·¨æµè§ˆå™¨å°è£…çš„ `SyntheticEvent`** å¯¹è±¡ï¼š
  - æ¥å£ä¸åŸç”Ÿä¸€è‡´ï¼ˆå¦‚ `stopPropagation()`ã€`preventDefault()`ï¼‰
  - **è‡ªåŠ¨æ± åŒ–ï¼ˆpoolingï¼‰**ï¼šäº‹ä»¶å›è°ƒç»“æŸåå±æ€§è¢«æ¸…ç©ºï¼ˆReact 17+ å·²ç§»é™¤æ± åŒ–ï¼‰

> âš ï¸ æ³¨æ„ï¼šè‹¥éœ€å¼‚æ­¥è®¿é—®äº‹ä»¶å¯¹è±¡ï¼Œéœ€è°ƒç”¨ `event.persist()`ï¼ˆä»… React 16 åŠæ›´æ—©ç‰ˆæœ¬éœ€è¦ï¼‰ã€‚

---

### ä¸‰ã€**äº‹ä»¶å‘½åä¸è¯­æ³•**
- **å‘½å**ï¼šReact ä½¿ç”¨**é©¼å³°å‘½å**ï¼ˆå¦‚ `onClick`ï¼‰ï¼ŒåŸç”Ÿä¸ºå…¨å°å†™ï¼ˆ`onclick`ï¼‰ã€‚
- **ä¼ å‚**ï¼šReact ä¸­éœ€ä½¿ç”¨ç®­å¤´å‡½æ•°æˆ– `bind`ï¼Œä¸èƒ½ç›´æ¥æ‹¼æ¥ï¼š
  ```jsx
  // âœ… æ­£ç¡®
  <button onClick={() => handleClick(id)}>Click</button>
  // âŒ é”™è¯¯ï¼ˆç«‹å³æ‰§è¡Œï¼‰
  <button onClick={handleClick(id)}>Click</button>
  ```

---

### å››ã€**é˜»æ­¢é»˜è®¤è¡Œä¸ºæ–¹å¼**
- **åŸç”Ÿ**ï¼š`return false` å¯åŒæ—¶é˜»æ­¢é»˜è®¤ + å†’æ³¡ï¼ˆä»…é™ onxxx å±æ€§å†™æ³•ï¼‰ã€‚
- **React**ï¼š**å¿…é¡»æ˜¾å¼è°ƒç”¨ `preventDefault()`**ï¼Œ`return false` æ— æ•ˆã€‚

```jsx
function handleClick(e) {
  e.preventDefault(); // å¿…é¡»
}
```

---

### äº”ã€**å…¼å®¹æ€§ä¸ä¸€è‡´æ€§**
- React åˆæˆäº‹ä»¶**æŠ¹å¹³æµè§ˆå™¨å·®å¼‚**ï¼ˆå¦‚ IE äº‹ä»¶ API ä¸åŒï¼‰ã€‚
- æ‰€æœ‰äº‹ä»¶å›è°ƒéƒ½åœ¨**React æ§åˆ¶çš„äº‹åŠ¡ä¸­æ‰§è¡Œ**ï¼Œç¡®ä¿çŠ¶æ€æ›´æ–°ä¸€è‡´æ€§ã€‚

---

### å…­ã€**æ–°å¢é™åˆ¶**
- æ— æ³•ç›´æ¥ä½¿ç”¨åŸç”Ÿäº‹ä»¶ APIï¼ˆå¦‚ `addEventListener`ï¼‰ä¸ React äº‹ä»¶æ··ç”¨ï¼ˆå¯èƒ½é€ æˆé¡ºåºæ··ä¹±ï¼‰ã€‚
- æŸäº›åŸç”Ÿäº‹ä»¶ï¼ˆå¦‚ `onScroll`ã€`onMouseEnter`ï¼‰åœ¨ React ä¸­è¡Œä¸ºç•¥æœ‰è°ƒæ•´ã€‚

---

âœ… **æ€»ç»“**ï¼š  
React åˆæˆäº‹ä»¶ = **äº‹ä»¶å§”æ‰˜ + è·¨æµè§ˆå™¨å°è£… + ç»Ÿä¸€ API**ï¼Œæå‡æ€§èƒ½ä¸å¼€å‘ä½“éªŒï¼Œä½†éœ€æ³¨æ„å…¶ä¸åŸç”Ÿäº‹ä»¶çš„éš”ç¦»æ€§ã€‚

## Reduxå·¥ä½œåŸç†

Redux æ˜¯ä¸€ä¸ª**é›†ä¸­å¼çŠ¶æ€ç®¡ç†åº“**ï¼Œæ ¸å¿ƒæ€æƒ³æ˜¯ï¼š**å•ä¸€æ•°æ®æºã€çŠ¶æ€åªè¯»ã€çº¯å‡½æ•°æ›´æ–°**ã€‚å…¶å·¥ä½œåŸç†å¯æ¦‚æ‹¬ä¸º **â€œStore â†’ Action â†’ Reducer â†’ New Stateâ€** çš„å•å‘æ•°æ®æµã€‚

---

### ä¸€ã€ä¸‰å¤§æ ¸å¿ƒåŸåˆ™
1. **å•ä¸€æ•°æ®æºï¼ˆSingle Source of Truthï¼‰**  
   - æ•´ä¸ªåº”ç”¨çŠ¶æ€å­˜å‚¨åœ¨**ä¸€ä¸ª store å¯¹è±¡**ä¸­ã€‚
2. **State æ˜¯åªè¯»çš„ï¼ˆState is Read-Onlyï¼‰**  
   - å”¯ä¸€æ”¹å˜ state çš„æ–¹å¼æ˜¯**æ´¾å‘ action**ï¼ˆæ™®é€šå¯¹è±¡ï¼‰ã€‚
3. **ä½¿ç”¨çº¯å‡½æ•°ä¿®æ”¹çŠ¶æ€ï¼ˆChanges with Pure Functionsï¼‰**  
   - é€šè¿‡ **reducer**ï¼ˆçº¯å‡½æ•°ï¼‰æ¥æ”¶æ—§ state å’Œ actionï¼Œè¿”å›æ–° stateã€‚

---

### äºŒã€æ ¸å¿ƒç»„æˆéƒ¨åˆ†

#### 1. **Store**
- ç”± `createStore(reducer)` åˆ›å»º
- æä¾›æ–¹æ³•ï¼š
  - `getState()`ï¼šè·å–å½“å‰çŠ¶æ€
  - `dispatch(action)`ï¼šè§¦å‘çŠ¶æ€æ›´æ–°
  - `subscribe(listener)`ï¼šç›‘å¬çŠ¶æ€å˜åŒ–

#### 2. **Action**
- æ™®é€š JavaScript å¯¹è±¡ï¼Œå¿…é¡»æœ‰ `type` å­—æ®µ
- æè¿°â€œå‘ç”Ÿäº†ä»€ä¹ˆâ€
  ```js
  { type: 'INCREMENT', payload: 1 }
  ```

#### 3. **Reducer**
- çº¯å‡½æ•°ï¼š`(state, action) => newState`
- æ ¹æ® `action.type` å†³å®šå¦‚ä½•ç”Ÿæˆæ–°çŠ¶æ€
- **ä¸èƒ½ç›´æ¥ä¿®æ”¹åŸ state**ï¼Œéœ€è¿”å›æ–°å¯¹è±¡ï¼ˆå¸¸ç”¨å±•å¼€è¿ç®—ç¬¦æˆ– Immerï¼‰

---

### ä¸‰ã€å·¥ä½œæµç¨‹ï¼ˆå•å‘æ•°æ®æµï¼‰

![An Image](../public/assets/tongyi-mermaid-2026-01-05-145633.png)

1. ç»„ä»¶è°ƒç”¨ `store.dispatch(action)`
2. Store å°† `action` å’Œå½“å‰ `state` ä¼ ç»™ `reducer`
3. Reducer è¿”å›æ–° `state`
4. Store æ›´æ–°çŠ¶æ€ï¼Œå¹¶é€šçŸ¥æ‰€æœ‰è®¢é˜…è€…ï¼ˆå¦‚ UI é‡æ–°æ¸²æŸ“ï¼‰

---

### å››ã€ä¸­é—´ä»¶ï¼ˆMiddlewareï¼‰
- æ‰©å±• Redux åŠŸèƒ½ï¼ˆå¦‚æ—¥å¿—ã€å¼‚æ­¥å¤„ç†ï¼‰
- å…¸å‹ï¼š`redux-thunk`ï¼ˆæ”¯æŒ dispatch å‡½æ•°ï¼‰ã€`redux-saga`ï¼ˆåŸºäº generatorï¼‰
- é€šè¿‡ `applyMiddleware` æ³¨å…¥

```js
const store = createStore(
  reducer,
  applyMiddleware(thunk)
);
```

---

### äº”ã€ä¸ React é›†æˆï¼ˆReact-Reduxï¼‰
- ä½¿ç”¨ `Provider` æ³¨å…¥ store
- ç»„ä»¶é€šè¿‡ `useSelector` è¯»å–çŠ¶æ€ï¼Œ`useDispatch` æ´¾å‘ action

---

âœ… **ä¸€å¥è¯æ€»ç»“**ï¼š  
Redux é€šè¿‡ **â€œæ´¾å‘ action â†’ çº¯å‡½æ•°è®¡ç®— â†’ æ›´æ–°å…¨å±€çŠ¶æ€â€** çš„ä¸¥æ ¼å•å‘æµï¼Œå®ç°å¯é¢„æµ‹ã€å¯è°ƒè¯•çš„çŠ¶æ€ç®¡ç†ã€‚é€‚ç”¨äº**å¤æ‚ã€å¤šç»„ä»¶å…±äº«çŠ¶æ€**çš„åœºæ™¯ã€‚

## React-Routerå·¥ä½œåŸç†? react-router-domæœ‰å“ªäº›ç»„ä»¶

### React Router å·¥ä½œåŸç†

React Router çš„æ ¸å¿ƒæ˜¯ **ç›‘å¬ URL å˜åŒ– â†’ åŒ¹é…è·¯ç”±è§„åˆ™ â†’ åŠ¨æ€æ¸²æŸ“å¯¹åº”ç»„ä»¶**ï¼Œå®ç° SPAï¼ˆå•é¡µåº”ç”¨ï¼‰çš„æ— åˆ·æ–°å¯¼èˆªã€‚

#### æ ¸å¿ƒæœºåˆ¶ï¼š
1. **è·¯ç”±æ¨¡å¼**ï¼š
   - **`BrowserRouter`**ï¼šåŸºäº HTML5 History APIï¼ˆ`pushState`/`replaceState` + `popstate` äº‹ä»¶ï¼‰
   - **`HashRouter`**ï¼šåŸºäº URL çš„ hashï¼ˆ`#`ï¼‰å˜åŒ– + `hashchange` äº‹ä»¶
2. **è·¯ç”±åŒ¹é…**ï¼š
   - ä½¿ç”¨ `path-to-regexp` åº“å°†è·¯ç”±è·¯å¾„ï¼ˆå¦‚ `/users/:id`ï¼‰ç¼–è¯‘ä¸ºæ­£åˆ™è¡¨è¾¾å¼
   - å¯¹å½“å‰ URL è¿›è¡ŒåŒ¹é…ï¼Œæå–å‚æ•°ï¼ˆå¦‚ `params.id`ï¼‰
3. **åŠ¨æ€æ¸²æŸ“**ï¼š
   - é€šè¿‡ React Context å…±äº«è·¯ç”±çŠ¶æ€ï¼ˆlocationã€history ç­‰ï¼‰
   - `<Route>` ç»„ä»¶æ ¹æ®åŒ¹é…ç»“æœå†³å®šæ˜¯å¦æ¸²æŸ“å…¶ `element`ï¼ˆv6ï¼‰æˆ– `component`/`render`ï¼ˆv5ï¼‰

> âœ… **å…³é”®ç‚¹**ï¼šæ‰€æœ‰è·¯ç”±ç»„ä»¶å…±äº«åŒä¸€ä¸ª `history` å¯¹è±¡ï¼ŒURL å˜åŒ–æ—¶é€šçŸ¥æ‰€æœ‰ `<Route>` é‡æ–°åŒ¹é…ã€‚

---

### react-router-dom ä¸»è¦ç»„ä»¶ï¼ˆä»¥ v6 ä¸ºä¸»ï¼‰

#### 1. **è·¯ç”±å™¨ï¼ˆå¿…é¡»åŒ…è£¹æ•´ä¸ªåº”ç”¨ï¼‰**
- `BrowserRouter`ï¼šHTML5 history æ¨¡å¼ï¼ˆæ¨èï¼‰
- `HashRouter`ï¼šhash æ¨¡å¼ï¼ˆå…¼å®¹æ—§æµè§ˆå™¨ï¼‰
- `MemoryRouter`ï¼šå†…å­˜ historyï¼ˆæµ‹è¯•/éæµè§ˆå™¨ç¯å¢ƒï¼‰

#### 2. **è·¯ç”±åŒ¹é…ä¸æ¸²æŸ“**
- `Routes`ï¼š**v6 æ–°å¢**ï¼Œæ›¿ä»£ v5 çš„ `Switch`ï¼ŒåŒ…å«å¤šä¸ª `Route`
- `Route`ï¼šå®šä¹‰è·¯å¾„ä¸ç»„ä»¶æ˜ å°„  
  ```jsx
  <Route path="/users" element={<Users />} />
  ```
- `Navigate`ï¼š**v6 æ›¿ä»£ `Redirect`**ï¼Œç”¨äºé‡å®šå‘  
  ```jsx
  <Route path="/old" element={<Navigate to="/new" />} />
  ```

#### 3. **å¯¼èˆªç»„ä»¶**
- `Link`ï¼šå£°æ˜å¼å¯¼èˆªï¼ˆç”Ÿæˆ `<a>` æ ‡ç­¾ï¼Œä¸åˆ·æ–°é¡µé¢ï¼‰  
  ```jsx
  <Link to="/home">Home</Link>
  ```
- `NavLink`ï¼š**å¸¦æ¿€æ´»çŠ¶æ€çš„ Link**ï¼ˆå¸¸ç”¨äºå¯¼èˆªæ ï¼‰  
  ```jsx
  <NavLink to="/profile" className={({ isActive }) => isActive ? 'active' : ''} />
  ```
- `useNavigate()` Hookï¼š**ç¼–ç¨‹å¼å¯¼èˆª**ï¼ˆv6 æ›¿ä»£ `history.push`ï¼‰  
  ```js
  const navigate = useNavigate();
  navigate('/login');
  ```

#### 4. **Hooksï¼ˆv6 æ¨èæ–¹å¼ï¼‰**
- `useParams()`ï¼šè·å–åŠ¨æ€è·¯ç”±å‚æ•°ï¼ˆå¦‚ `/users/:id` â†’ `{ id: '123' }`ï¼‰
- `useSearchParams()`ï¼šè¯»å†™ URL æŸ¥è¯¢å‚æ•°ï¼ˆç±»ä¼¼ `?name=foo`ï¼‰
- `useLocation()`ï¼šè·å–å½“å‰ location å¯¹è±¡ï¼ˆpathnameã€search ç­‰ï¼‰
- `useNavigate()`ï¼šå¯¼èˆªå‡½æ•°ï¼ˆè§ä¸Šï¼‰

#### 5. **å…¶ä»–**
- `Outlet`ï¼š**åµŒå¥—è·¯ç”±çš„å ä½ç¬¦**ï¼ˆçˆ¶è·¯ç”±ä¸­ä½¿ç”¨ï¼Œæ¸²æŸ“å­è·¯ç”±å†…å®¹ï¼‰
- `useRoutes()`ï¼šç”¨ JS å¯¹è±¡é…ç½®è·¯ç”±ï¼ˆæ›¿ä»£ JSX å†™æ³•ï¼‰

---

### v5 vs v6 å…³é”®å·®å¼‚
| åŠŸèƒ½       | v5                   | v6                    |
| ---------- | -------------------- | --------------------- |
| è·¯ç”±å®¹å™¨   | `<Switch>`           | `<Routes>`            |
| è·¯ç”±ç»„ä»¶   | `component`/`render` | `element`ï¼ˆJSXï¼‰      |
| é‡å®šå‘     | `<Redirect>`         | `<Navigate>`          |
| ç¼–ç¨‹å¼å¯¼èˆª | `props.history`      | `useNavigate()`       |
| åµŒå¥—è·¯ç”±   | æ‰‹åŠ¨æ‹¼æ¥             | è‡ªåŠ¨åµŒå¥— + `<Outlet>` |

---

âœ… **æ€»ç»“**ï¼š  
React Router é€šè¿‡ **History API ç›‘å¬ + è·¯å¾„åŒ¹é… + Context å…±äº«çŠ¶æ€** å®ç° SPA è·¯ç”±ã€‚`react-router-dom` æä¾›äº†ä»è·¯ç”±å®šä¹‰ï¼ˆ`Route`ï¼‰ã€å¯¼èˆªï¼ˆ`Link`/`useNavigate`ï¼‰åˆ°å‚æ•°è·å–ï¼ˆ`useParams`ï¼‰çš„å®Œæ•´å·¥å…·é“¾ï¼Œ**v6 æ›´ç®€æ´ã€ç±»å‹å®‰å…¨ã€æ€§èƒ½æ›´å¥½**ã€‚

## React hooksè§£å†³äº†ä»€ä¹ˆé—®é¢˜? å‡½æ•°ç»„ä»¶ä¸ç±»ç»„ä»¶çš„åŒºåˆ«

### React Hooks è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ

Hooks æ˜¯ React 16.8 å¼•å…¥çš„ç‰¹æ€§ï¼Œ**è®©å‡½æ•°ç»„ä»¶æ‹¥æœ‰ç±»ç»„ä»¶çš„èƒ½åŠ›**ï¼Œä¸»è¦è§£å†³ä»¥ä¸‹é—®é¢˜ï¼š

---

#### 1. **é€»è¾‘å¤ç”¨å›°éš¾ï¼ˆMixin / HOC / Render Props çš„ç¼ºé™·ï¼‰**
- ç±»ç»„ä»¶ä¸­ï¼Œå…±äº«çŠ¶æ€é€»è¾‘éœ€å€ŸåŠ©é«˜é˜¶ç»„ä»¶ï¼ˆHOCï¼‰æˆ– Render Propsï¼Œå¯¼è‡´**åµŒå¥—åœ°ç‹±ã€å‘½åå†²çªã€props ä¼ é€’ç¹ç**ã€‚
- **Hooks é€šè¿‡è‡ªå®šä¹‰ Hookï¼ˆå¦‚ `useFetch`ï¼‰å®ç°æ‰å¹³åŒ–é€»è¾‘å¤ç”¨**ï¼Œæ— åµŒå¥—ã€æ—  props å¹²æ‰°ã€‚

#### 2. **ç»„ä»¶å¤æ‚åº¦é«˜ï¼ˆâ€œWrapper Hellâ€ + çŠ¶æ€é€»è¾‘åˆ†æ•£ï¼‰**
- ç±»ç»„ä»¶ä¸­ï¼Œç›¸å…³é€»è¾‘ï¼ˆå¦‚è®¢é˜…ã€æ•°æ®è·å–ï¼‰å¸¸åˆ†æ•£åœ¨å¤šä¸ªç”Ÿå‘½å‘¨æœŸï¼ˆ`componentDidMount`ã€`componentDidUpdate`ã€`componentWillUnmount`ï¼‰ã€‚
- **Hooks å°†å…³è”é€»è¾‘èšåˆåœ¨åŒä¸€ä¸ª `useEffect` ä¸­**ï¼Œæå‡å¯è¯»æ€§å’Œç»´æŠ¤æ€§ã€‚

#### 3. **ç±»ç»„ä»¶éš¾ä»¥ä¼˜åŒ–å’Œç†è§£**
- `this` æŒ‡å‘æ˜“é”™ã€éœ€ç»‘å®šæ–¹æ³•ã€å‹ç¼©åéš¾è°ƒè¯•ã€‚
- **å‡½æ•°ç»„ä»¶æ›´è½»é‡ã€æ—  `this`ã€æ›´æ˜“æµ‹è¯•å’Œæ¨ç†**ã€‚

#### 4. **æ— æ³•åœ¨å‡½æ•°ç»„ä»¶ä¸­ä½¿ç”¨çŠ¶æ€å’Œå‰¯ä½œç”¨**
- å‡½æ•°ç»„ä»¶åŸä¸ºâ€œçº¯å‡½æ•°â€ï¼Œæ— æ³•ç®¡ç†çŠ¶æ€æˆ–æ‰§è¡Œå‰¯ä½œç”¨ã€‚
- **Hooksï¼ˆ`useState`, `useEffect` ç­‰ï¼‰èµ‹äºˆå‡½æ•°ç»„ä»¶å®Œæ•´èƒ½åŠ›**ï¼Œç»Ÿä¸€ç¼–ç¨‹æ¨¡å‹ã€‚

---

### å‡½æ•°ç»„ä»¶ vs ç±»ç»„ä»¶çš„åŒºåˆ«

| ç‰¹æ€§                | å‡½æ•°ç»„ä»¶ï¼ˆ+ Hooksï¼‰         | ç±»ç»„ä»¶                           |
| ------------------- | --------------------------- | -------------------------------- |
| **çŠ¶æ€ç®¡ç†**        | `useState`, `useReducer`    | `this.state` + `setState`        |
| **å‰¯ä½œç”¨å¤„ç†**      | `useEffect`                 | `componentDidMount` ç­‰ç”Ÿå‘½å‘¨æœŸ   |
| **é€»è¾‘å¤ç”¨**        | è‡ªå®šä¹‰ Hookï¼ˆæ‰å¹³ã€ç»„åˆå¼ï¼‰ | HOC / Render Propsï¼ˆåµŒå¥—ã€å¤æ‚ï¼‰ |
| **ä»£ç ä½“ç§¯**        | æ›´å°ï¼ˆæ— ç±»è¯­æ³•å¼€é”€ï¼‰        | è¾ƒå¤§                             |
| **æ€§èƒ½**            | æ›´æ˜“ä¼˜åŒ–ï¼ˆReact å›¢é˜Ÿæ¨èï¼‰  | éœ€æ‰‹åŠ¨ä¼˜åŒ–ï¼ˆå¦‚ `PureComponent`ï¼‰ |
| **`this` é—®é¢˜**     | æ—                           | éœ€ç»‘å®šæ–¹æ³•ï¼Œæ˜“å‡ºé”™               |
| **çƒ­æ›´æ–°ï¼ˆHMRï¼‰**   | æ”¯æŒæ›´å¥½                    | å¯èƒ½ä¸¢å¤±çŠ¶æ€                     |
| **TypeScript æ”¯æŒ** | æ›´å‹å¥½ï¼ˆç±»å‹æ¨å¯¼æ¸…æ™°ï¼‰      | éœ€å¤„ç† `this` ç±»å‹               |

---

### âœ… æ€»ç»“
- **Hooks ä¸æ˜¯æ›¿ä»£ç±»ç»„ä»¶ï¼Œè€Œæ˜¯æä¾›æ›´ä¼˜çš„ç¼–ç¨‹èŒƒå¼**ï¼š  
  **å‡½æ•°å¼ + å£°æ˜å¼ + ç»„åˆå¼**ï¼Œè®©ä»£ç æ›´ç®€æ´ã€å¯å¤ç”¨ã€æ˜“æµ‹è¯•ã€‚
- **å®˜æ–¹æ¨è**ï¼šæ–°é¡¹ç›®ä¼˜å…ˆä½¿ç”¨å‡½æ•°ç»„ä»¶ + Hooksï¼Œç±»ç»„ä»¶ä»…ç”¨äºç»´æŠ¤æ—§ä»£ç ã€‚

> â€œHooks è®©å‡½æ•°ç»„ä»¶ä»â€˜å±•ç¤ºå‹â€™å‡çº§ä¸ºâ€˜å…¨èƒ½å‹â€™ï¼ŒåŒæ—¶è§£å†³äº†ç±»ç»„ä»¶çš„å†å²åŒ…è¢±ã€‚â€ â€”â€” React å›¢é˜Ÿ

## SetStateæ˜¯åŒæ­¥è¿˜æ˜¯å¼‚æ­¥çš„ï¼ŒsetStateåšäº†ä»€ä¹ˆ

`setState` åœ¨ React ä¸­**é€šå¸¸æ˜¯å¼‚æ­¥çš„ï¼Œä½†åœ¨æŸäº›ç‰¹å®šåœºæ™¯ä¸‹è¡¨ç°ä¸ºåŒæ­¥**ã€‚å®ƒçš„æ ¸å¿ƒä½œç”¨æ˜¯ï¼š**è°ƒåº¦çŠ¶æ€æ›´æ–°ï¼Œå¹¶è§¦å‘ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ï¼ˆre-renderï¼‰**ã€‚

---

### ä¸€ã€`setState` æ˜¯åŒæ­¥è¿˜æ˜¯å¼‚æ­¥ï¼Ÿ

#### âœ… **å¤§å¤šæ•°æƒ…å†µï¼šå¼‚æ­¥ï¼ˆæ‰¹é‡æ›´æ–°ï¼‰**
- åœ¨ **React äº‹ä»¶å¤„ç†å™¨**ï¼ˆå¦‚ `onClick`ï¼‰å’Œ **ç”Ÿå‘½å‘¨æœŸæ–¹æ³•** ä¸­ï¼š
  ```js
  handleClick() {
    this.setState({ count: this.state.count + 1 });
    console.log(this.state.count); // âŒ è¾“å‡ºæ—§å€¼ï¼ˆå¼‚æ­¥ï¼‰
  }
  ```
  - React ä¼šå°†å¤šä¸ª `setState` **åˆå¹¶ï¼ˆbatchingï¼‰**ï¼Œåœ¨äº‹ä»¶ç»“æŸæ—¶**ç»Ÿä¸€æ›´æ–°**ï¼Œé¿å…é¢‘ç¹æ¸²æŸ“ã€‚

#### âš ï¸ **å°‘æ•°æƒ…å†µï¼šåŒæ­¥ï¼ˆé React æ§åˆ¶çš„ä¸Šä¸‹æ–‡ï¼‰**
- åœ¨ **åŸç”Ÿäº‹ä»¶**ã€**setTimeout**ã€**Promise**ã€**async/await** ç­‰ä¸­ï¼š
  ```js
  setTimeout(() => {
    this.setState({ count: 1 });
    console.log(this.state.count); // âœ… è¾“å‡º 1ï¼ˆåŒæ­¥ï¼‰
  }, 0);
  ```
  - å› ä¸º React æ— æ³•æ§åˆ¶è¿™äº›ä¸Šä¸‹æ–‡ï¼Œæ‰€ä»¥**ç«‹å³æ‰§è¡Œæ›´æ–°**ï¼ˆä½†æ³¨æ„ï¼šReact 18 åé€šè¿‡ `createRoot` å¯ç”¨è‡ªåŠ¨æ‰¹å¤„ç†ï¼Œä¸Šè¿°è¡Œä¸ºå¯èƒ½æ”¹å˜ï¼‰ã€‚

> ğŸ”” **React 18 æ–°ç‰¹æ€§**ï¼š  
> ä½¿ç”¨ `createRoot` åï¼Œ**æ‰€æœ‰ `setState` é»˜è®¤è‡ªåŠ¨æ‰¹å¤„ç†**ï¼ˆåŒ…æ‹¬ setTimeoutï¼‰ï¼Œé™¤éæ‰‹åŠ¨è°ƒç”¨ `flushSync` å¼ºåˆ¶åŒæ­¥ã€‚

---

### äºŒã€`setState` åšäº†ä»€ä¹ˆï¼Ÿ

1. **è°ƒåº¦æ›´æ–°ï¼ˆSchedule Updateï¼‰**  
   - å°†æ–°çš„ state ä¸å½“å‰ state åˆå¹¶ï¼ˆå¯¹è±¡æµ…åˆå¹¶ï¼‰
   - å°†æ›´æ–°ä»»åŠ¡æ”¾å…¥ React çš„æ›´æ–°é˜Ÿåˆ—

2. **è§¦å‘åè°ƒï¼ˆReconciliationï¼‰**  
   - åœ¨åˆé€‚çš„æ—¶æœºï¼ˆå¦‚äº‹ä»¶ç»“æŸï¼‰ï¼ŒReact æ‰§è¡Œï¼š
     - è°ƒç”¨ `render()` ç”Ÿæˆæ–°è™šæ‹Ÿ DOM
     - ä¸æ—§è™šæ‹Ÿ DOM diff
     - æ›´æ–°çœŸå® DOMï¼ˆå¦‚æœ‰å·®å¼‚ï¼‰

3. **è°ƒç”¨ç”Ÿå‘½å‘¨æœŸ / Hooks**  
   - ç±»ç»„ä»¶ï¼š`getSnapshotBeforeUpdate` â†’ `componentDidUpdate`
   - å‡½æ•°ç»„ä»¶ï¼š`useEffect` å›è°ƒï¼ˆåœ¨ DOM æ›´æ–°åæ‰§è¡Œï¼‰

---

### ä¸‰ã€æ³¨æ„äº‹é¡¹

- **ä¸è¦ä¾èµ– `this.state` ç«‹å³æ›´æ–°**ï¼šä½¿ç”¨å›è°ƒå‡½æ•°å½¢å¼è·å–æœ€æ–°çŠ¶æ€
  ```js
  this.setState((prevState) => ({ count: prevState.count + 1 }));
  ```
- **å¯¹è±¡ state éœ€æ‰‹åŠ¨åˆå¹¶**ï¼š`setState` åªåšæµ…åˆå¹¶
  ```js
  // âŒ é”™è¯¯ï¼šä¼šè¦†ç›–å…¶ä»–å±æ€§
  this.setState({ user: { name: 'Alice' } });
  // âœ… æ­£ç¡®
  this.setState(prev => ({ user: { ...prev.user, name: 'Alice' } }));
  ```

---

âœ… **ä¸€å¥è¯æ€»ç»“**ï¼š  
`setState` æ˜¯ **â€œè°ƒåº¦å™¨â€è€Œéâ€œèµ‹å€¼å™¨â€** â€”â€” å®ƒå‘Šè¯‰ React â€œçŠ¶æ€è¦å˜äº†â€ï¼Œç”± React å†³å®šä½•æ—¶æ›´æ–°ï¼Œä»¥å®ç°é«˜æ€§èƒ½æ‰¹é‡æ¸²æŸ“ã€‚ç†è§£å…¶å¼‚æ­¥æ€§æ˜¯é¿å…çŠ¶æ€ bug çš„å…³é”®ã€‚

## ä»€ä¹ˆæ˜¯fiberï¼Œfiberè§£å†³äº†ä»€ä¹ˆé—®é¢˜

### ä»€ä¹ˆæ˜¯ Fiberï¼Ÿ

**Fiber æ˜¯ React 16 å¼•å…¥çš„å…¨æ–°åè°ƒï¼ˆReconciliationï¼‰å¼•æ“**ï¼Œæ˜¯å¯¹ React æ ¸å¿ƒç®—æ³•çš„é‡å†™ã€‚å®ƒçš„æœ¬è´¨æ˜¯ä¸€ä¸ª **åŸºäºä¼˜å…ˆçº§å’Œå¯ä¸­æ–­çš„å¢é‡æ¸²æŸ“æœºåˆ¶**ï¼Œæ ¸å¿ƒç›®æ ‡æ˜¯ï¼š**æå‡å¤æ‚ UI çš„å“åº”æ€§å’Œæ€§èƒ½**ã€‚

> ğŸ“Œ â€œFiberâ€ æ—¢æŒ‡ä»£è¿™ä¸ªæ–°æ¶æ„ï¼Œä¹ŸæŒ‡ä»£ React å†…éƒ¨ç”¨äºè¡¨ç¤ºç»„ä»¶å·¥ä½œå•å…ƒçš„æ•°æ®ç»“æ„ï¼ˆæ¯ä¸ªç»„ä»¶å¯¹åº”ä¸€ä¸ª Fiber èŠ‚ç‚¹ï¼‰ã€‚

---

### Fiber è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ

#### âŒ **React 15 çš„ Stack Reconcilerï¼ˆæ ˆåè°ƒå™¨ï¼‰çš„é—®é¢˜**
- **é€’å½’ diffï¼Œä¸å¯ä¸­æ–­**ï¼šä¸€æ—¦å¼€å§‹æ›´æ–°ï¼Œå¿…é¡»åŒæ­¥å®Œæˆæ•´ä¸ªè™šæ‹Ÿ DOM æ ‘çš„éå†å’Œæ›´æ–°ã€‚
- **é•¿æ—¶é—´å ç”¨ä¸»çº¿ç¨‹**ï¼šå¤§å‹åº”ç”¨æ›´æ–°æ—¶ä¼šé˜»å¡æµè§ˆå™¨ï¼Œå¯¼è‡´é¡µé¢å¡é¡¿ã€æ‰å¸§ï¼ˆ>16msï¼‰ï¼Œç”¨æˆ·äº¤äº’æ— å“åº”ã€‚

#### âœ… **Fiber çš„è§£å†³æ–¹æ¡ˆ**

1. **å¯ä¸­æ–­çš„æ¸²æŸ“ï¼ˆInterruptible Renderingï¼‰**  
   - å°†æ¸²æŸ“/æ›´æ–°ä»»åŠ¡æ‹†åˆ†ä¸ºå¤šä¸ª **å°å•å…ƒï¼ˆFiber èŠ‚ç‚¹ï¼‰**ã€‚
   - æ¯å¤„ç†å®Œä¸€ä¸ªå•å…ƒï¼Œæ£€æŸ¥æ˜¯å¦éœ€è®©å‡ºä¸»çº¿ç¨‹ï¼ˆå¦‚å“åº”ç”¨æˆ·è¾“å…¥ã€åŠ¨ç”»ï¼‰ã€‚
   - è‹¥æœ‰é«˜ä¼˜å…ˆçº§ä»»åŠ¡ï¼ˆå¦‚ç‚¹å‡»ï¼‰ï¼Œæš‚åœå½“å‰æ›´æ–°ï¼Œå…ˆå¤„ç†ç´§æ€¥ä»»åŠ¡ã€‚

2. **ä¼˜å…ˆçº§è°ƒåº¦ï¼ˆPriority Schedulingï¼‰**  
   - ä¸åŒæ›´æ–°èµ‹äºˆä¸åŒä¼˜å…ˆçº§ï¼š
     - **é«˜ä¼˜å…ˆçº§**ï¼šç”¨æˆ·äº¤äº’ï¼ˆç‚¹å‡»ã€è¾“å…¥ï¼‰
     - **ä½ä¼˜å…ˆçº§**ï¼šæ•°æ®è·å–ã€è¿‡æ¸¡åŠ¨ç”»
   - é«˜ä¼˜ä»»åŠ¡å¯æ‰“æ–­ä½ä¼˜ä»»åŠ¡ï¼Œå®ç°â€œæµç•…äº¤äº’â€ã€‚

3. **å¢é‡æ›´æ–°ï¼ˆIncremental Updatesï¼‰**  
   - æ›´æ–°å¯åˆ†å¤šå¸§å®Œæˆï¼Œé¿å…å•å¸§è¶…æ—¶ï¼ˆ>16msï¼‰ã€‚
   - å³ä½¿æœªå®Œæˆå…¨éƒ¨æ›´æ–°ï¼Œä¹Ÿèƒ½ä¿è¯éƒ¨åˆ† UI åŠæ—¶å“åº”ã€‚

4. **æ”¯æŒæ–°ç‰¹æ€§åŸºç¡€**  
   - ä¸º `Suspense`ã€`Concurrent Mode`ï¼ˆç°ç§° Concurrent Featuresï¼‰ã€`startTransition` ç­‰æä¾›åº•å±‚æ”¯æŒã€‚

---

### Fiber çš„å·¥ä½œæœºåˆ¶ï¼ˆç®€åŒ–ï¼‰

1. **åŒç¼“å†²æ ‘ï¼ˆDouble Bufferingï¼‰**  
   - ç»´æŠ¤ä¸¤æ£µ Fiber æ ‘ï¼š`current`ï¼ˆå·²æ¸²æŸ“ï¼‰å’Œ `workInProgress`ï¼ˆæ­£åœ¨æ„å»ºï¼‰ã€‚
   - æ›´æ–°åœ¨ `workInProgress` ä¸Šè¿›è¡Œï¼Œå®ŒæˆååŸå­åˆ‡æ¢ï¼Œé¿å…ä¸­é—´çŠ¶æ€æš´éœ²ã€‚

2. **å·¥ä½œå¾ªç¯ï¼ˆWork Loopï¼‰**  
   ```js
   while (workInProgress !== null && !shouldYield()) {
     performUnitOfWork(workInProgress);
   }
   ```
   - `shouldYield()`ï¼šæ£€æŸ¥æ˜¯å¦éœ€è®©å‡ºä¸»çº¿ç¨‹ï¼ˆåŸºäºå¸§æ—¶é—´é¢„ç®—ï¼‰ã€‚

3. **é“¾è¡¨éå†**  
   - Fiber èŠ‚ç‚¹é€šè¿‡ `child`ã€`sibling`ã€`return` æŒ‡é’ˆæ„æˆé“¾è¡¨ï¼Œæ›¿ä»£é€’å½’ï¼Œä¾¿äºæš‚åœ/æ¢å¤ã€‚

---

### âœ… æ€»ç»“

| é—®é¢˜             | Fiber å¦‚ä½•è§£å†³        |
| ---------------- | --------------------- |
| æ¸²æŸ“å¡é¡¿         | æ‹†åˆ†ä»»åŠ¡ + è®©å‡ºä¸»çº¿ç¨‹ |
| äº¤äº’å»¶è¿Ÿ         | é«˜ä¼˜å…ˆçº§ä»»åŠ¡æ’é˜Ÿ      |
| å¤§æ›´æ–°é˜»å¡       | å¢é‡ã€å¯ä¸­æ–­æ›´æ–°      |
| æ— æ³•å®ç°å¹¶å‘ç‰¹æ€§ | æä¾›åº•å±‚è°ƒåº¦èƒ½åŠ›      |

> **Fiber ä¸æ˜¯ä¸ºäº†æ›´å¿«ï¼Œè€Œæ˜¯ä¸ºäº†è®© React â€œæ›´èªæ˜â€** â€”â€” åœ¨æ­£ç¡®çš„æ—¶é—´åšæ­£ç¡®çš„äº‹ï¼Œä¿éšœç”¨æˆ·ä½“éªŒæµç•…ã€‚

## Reactä¸­åœ¨å“ªæ•è·é”™è¯¯ï¼Ÿ

åœ¨ React ä¸­ï¼Œ**ä¸èƒ½ä½¿ç”¨ä¼ ç»Ÿçš„ `try...catch` æ•è·å­ç»„ä»¶å†…éƒ¨çš„æ¸²æŸ“é”™è¯¯æˆ–ç”Ÿå‘½å‘¨æœŸé”™è¯¯**ï¼Œå› ä¸º React çš„æ¸²æŸ“æ˜¯å¼‚æ­¥å’Œæ‰¹é‡å¤„ç†çš„ã€‚ä¸ºæ­¤ï¼ŒReact æä¾›äº† **é”™è¯¯è¾¹ç•Œï¼ˆError Boundariesï¼‰** æœºåˆ¶ã€‚

---

### âœ… æ­£ç¡®æ–¹å¼ï¼šä½¿ç”¨ **é”™è¯¯è¾¹ç•Œï¼ˆError Boundaryï¼‰**

é”™è¯¯è¾¹ç•Œæ˜¯ä¸€ä¸ª **React ç»„ä»¶**ï¼Œå®ƒèƒ½æ•è·å…¶**å­ç»„ä»¶æ ‘ä¸­ä»»ä½•ä½ç½®çš„ JavaScript é”™è¯¯**ï¼ˆåŒ…æ‹¬æ¸²æŸ“ã€ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ã€æ„é€ å‡½æ•°ç­‰ï¼‰ï¼Œå¹¶é˜²æ­¢æ•´ä¸ªåº”ç”¨å´©æºƒã€‚

#### å¦‚ä½•åˆ›å»ºé”™è¯¯è¾¹ç•Œï¼Ÿ
é€šè¿‡å®šä¹‰ä»¥ä¸‹ **ä¸¤ä¸ªç”Ÿå‘½å‘¨æœŸæ–¹æ³•**ï¼ˆä»…é™ç±»ç»„ä»¶ï¼‰ï¼š

```jsx
class ErrorBoundary extends React.Component {
  constructor(props) {
    super(props);
    this.state = { hasError: false };
  }

  // æ•è·å­ç»„ä»¶çš„é”™è¯¯
  static getDerivedStateFromError(error) {
    return { hasError: true }; // æ›´æ–° state ä»¥è§¦å‘ fallback UI
  }

  // è®°å½•é”™è¯¯ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰
  componentDidCatch(error, errorInfo) {
    console.log('Error:', error);
    console.log('Error Info:', errorInfo);
    // å¯ä¸ŠæŠ¥é”™è¯¯æ—¥å¿—ï¼ˆå¦‚ Sentryï¼‰
  }

  render() {
    if (this.state.hasError) {
      return <h1>Oops! Something went wrong.</h1>; // fallback UI
    }
    return this.props.children; // æ­£å¸¸æ¸²æŸ“å­ç»„ä»¶
  }
}
```

#### ä½¿ç”¨æ–¹å¼ï¼š
```jsx
<ErrorBoundary>
  <MyComponent /> {/* è‹¥ MyComponent æŠ¥é”™ï¼Œä¼šè¢«æ•è· */}
</ErrorBoundary>
```

---

### âš ï¸ é”™è¯¯è¾¹ç•Œ **ä¸èƒ½æ•è·** çš„é”™è¯¯ç±»å‹ï¼š
1. **äº‹ä»¶å¤„ç†å™¨ä¸­çš„é”™è¯¯**ï¼ˆå¦‚ `onClick`ï¼‰  
   â†’ ç›´æ¥ç”¨ `try...catch`
2. **å¼‚æ­¥ä»£ç ä¸­çš„é”™è¯¯**ï¼ˆå¦‚ `setTimeout`ã€`Promise`ï¼‰  
   â†’ éœ€åœ¨å¼‚æ­¥å›è°ƒå†…è‡ªè¡Œå¤„ç†
3. **æœåŠ¡ç«¯æ¸²æŸ“ï¼ˆSSRï¼‰é”™è¯¯**
4. **é”™è¯¯è¾¹ç•Œè‡ªèº«æŠ›å‡ºçš„é”™è¯¯**

---

### âœ… å‡½æ•°ç»„ä»¶æ€ä¹ˆåŠï¼Ÿ
- **å‡½æ•°ç»„ä»¶æœ¬èº«ä¸èƒ½æˆä¸ºé”™è¯¯è¾¹ç•Œ**ï¼ˆå› æ— ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼‰ã€‚
- ä½†å¯ä»¥**è¢«é”™è¯¯è¾¹ç•ŒåŒ…è£¹**ã€‚
- è‹¥éœ€åœ¨å‡½æ•°ç»„ä»¶ä¸­å¤„ç†å±€éƒ¨é”™è¯¯ï¼Œå¯ï¼š
  - å°†å¯èƒ½å‡ºé”™çš„éƒ¨åˆ†å°è£…åˆ°ç±»ç»„ä»¶ä¸­ä½œä¸ºé”™è¯¯è¾¹ç•Œ
  - æˆ–ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“ï¼ˆå¦‚ `react-error-boundary`ï¼‰

```jsx
// ä½¿ç”¨ react-error-boundaryï¼ˆæ¨èï¼‰
import { ErrorBoundary } from 'react-error-boundary';

function App() {
  return (
    <ErrorBoundary FallbackComponent={ErrorFallback}>
      <MyComponent />
    </ErrorBoundary>
  );
}
```

---

### âœ… æœ€ä½³å®è·µ
- åœ¨**åº”ç”¨é¡¶å±‚**è®¾ç½®å…¨å±€é”™è¯¯è¾¹ç•Œï¼ˆé˜²ç™½å±ï¼‰
- åœ¨**å…³é”®æ¨¡å—**ï¼ˆå¦‚è¯„è®ºåŒºã€æ”¯ä»˜ç»„ä»¶ï¼‰è®¾ç½®å±€éƒ¨é”™è¯¯è¾¹ç•Œ
- é”™è¯¯è¾¹ç•Œå†…æä¾›**ç”¨æˆ·å‹å¥½çš„é™çº§ UI** å’Œ**é‡è¯•æœºåˆ¶**
- ç»“åˆç›‘æ§å¹³å°ï¼ˆå¦‚ Sentryï¼‰ä¸ŠæŠ¥é”™è¯¯

---

âœ… **æ€»ç»“**ï¼š  
React ä¸­é€šè¿‡ **é”™è¯¯è¾¹ç•Œï¼ˆç±»ç»„ä»¶ + `getDerivedStateFromError` / `componentDidCatch`ï¼‰** æ•è·å­ç»„ä»¶æ¸²æŸ“é”™è¯¯ï¼›å…¶ä»–é”™è¯¯ï¼ˆäº‹ä»¶ã€å¼‚æ­¥ï¼‰ä»éœ€ä¼ ç»Ÿ `try...catch`ã€‚**é”™è¯¯è¾¹ç•Œæ˜¯ä¿éšœåº”ç”¨å¥å£®æ€§çš„å…³é”®æœºåˆ¶ã€‚**

## Reactç»„ä»¶ä¼ å€¼æœ‰å“ªäº›æ–¹å¼

React ç»„ä»¶ä¼ å€¼ï¼ˆæ•°æ®æµï¼‰éµå¾ª **â€œå•å‘æ•°æ®æµâ€** åŸåˆ™ï¼Œä¸»è¦æ–¹å¼å¦‚ä¸‹ï¼š

---

### ä¸€ã€**çˆ¶å­ç»„ä»¶é€šä¿¡**

#### 1. **çˆ¶ â†’ å­ï¼š`props`**
- æœ€åŸºç¡€æ–¹å¼ï¼Œçˆ¶ç»„ä»¶é€šè¿‡å±æ€§ä¼ é€’æ•°æ®/å‡½æ•°
  ```jsx
  // çˆ¶ç»„ä»¶
  <Child name="Alice" onUpdate={handleUpdate} />

  // å­ç»„ä»¶
  function Child({ name, onUpdate }) { ... }
  ```

#### 2. **å­ â†’ çˆ¶ï¼šå›è°ƒå‡½æ•°ï¼ˆCallbackï¼‰**
- çˆ¶ç»„ä»¶ä¼ é€’å‡½æ•°ç»™å­ç»„ä»¶ï¼Œå­ç»„ä»¶è°ƒç”¨æ—¶ä¼ å‚
  ```jsx
  // å­ç»„ä»¶
  props.onUpdate(newValue);
  ```

---

### äºŒã€**è·¨å±‚çº§ / å…„å¼Ÿç»„ä»¶é€šä¿¡**

#### 3. **çŠ¶æ€æå‡ï¼ˆLifting State Upï¼‰**
- å°†å…±äº«çŠ¶æ€ç§»åˆ°**æœ€è¿‘çš„å…±åŒçˆ¶ç»„ä»¶**ï¼Œé€šè¿‡ `props` å‘ä¸‹ä¼ é€’

#### 4. **Context APIï¼ˆå®˜æ–¹è·¨ç»„ä»¶æ–¹æ¡ˆï¼‰**
- é€‚ç”¨äº**å¤šå±‚åµŒå¥—**ä¸”ä¸å¸Œæœ›é€å±‚é€ä¼  `props`
  ```jsx
  // åˆ›å»º Context
  const ThemeContext = React.createContext('light');

  // ç¥–å…ˆç»„ä»¶æä¾›å€¼
  <ThemeContext.Provider value="dark">
    <Child />
  </ThemeContext.Provider>

  // ä»»æ„åä»£ç»„ä»¶æ¶ˆè´¹
  const theme = useContext(ThemeContext);
  ```
> âœ… é€‚åˆï¼šä¸»é¢˜ã€è¯­è¨€ã€ç”¨æˆ·ä¿¡æ¯ç­‰å…¨å±€ä½†éé¢‘ç¹å˜åŒ–çš„æ•°æ®

#### 5. **çŠ¶æ€ç®¡ç†åº“ï¼ˆRedux / Zustand / Jotai ç­‰ï¼‰**
- é€‚ç”¨äº**å¤æ‚åº”ç”¨**ï¼Œé›†ä¸­ç®¡ç†å…¨å±€çŠ¶æ€
  ```js
  // Redux ç¤ºä¾‹
  const count = useSelector(state => state.count);
  const dispatch = useDispatch();
  ```

---

### ä¸‰ã€**ç‰¹æ®Šåœºæ™¯**

#### 6. **Ref è½¬å‘ï¼ˆçˆ¶è®¿é—®å­ç»„ä»¶å®ä¾‹æˆ– DOMï¼‰**
- ä½¿ç”¨ `forwardRef` + `useImperativeHandle` æš´éœ²å­ç»„ä»¶æ–¹æ³•
  ```jsx
  const Child = forwardRef((props, ref) => {
    useImperativeHandle(ref, () => ({ focus: () => inputRef.current.focus() }));
  });
  ```

#### 7. **äº‹ä»¶æ€»çº¿ï¼ˆEvent Busï¼‰â€” ä¸æ¨è**
- é€šè¿‡ç¬¬ä¸‰æ–¹åº“ï¼ˆå¦‚ `mitt`ï¼‰å®ç°å‘å¸ƒè®¢é˜…
- **ç ´åç»„ä»¶å°è£…æ€§ï¼Œè°ƒè¯•å›°éš¾ï¼Œä»…é™ç‰¹æ®Šåœºæ™¯**

#### 8. **URL å‚æ•° / æµè§ˆå™¨å­˜å‚¨**
- é€šè¿‡è·¯ç”±å‚æ•°ï¼ˆ`useParams`ï¼‰ã€æŸ¥è¯¢å‚æ•°ï¼ˆ`useSearchParams`ï¼‰æˆ– `localStorage` å…±äº«çŠ¶æ€

---

### å››ã€**å‡½æ•°ç»„ä»¶ vs ç±»ç»„ä»¶å·®å¼‚**
- å‡½æ•°ç»„ä»¶ï¼šä½¿ç”¨ `props`ã€`useContext`ã€`useRef` ç­‰ Hooks
- ç±»ç»„ä»¶ï¼š`this.props`ã€`contextType`ã€`ref` å›è°ƒ

---

### âœ… é€‰æ‹©å»ºè®®
| åœºæ™¯                         | æ¨èæ–¹å¼                             |
| ---------------------------- | ------------------------------------ |
| ç®€å•çˆ¶å­é€šä¿¡                 | `props` + å›è°ƒ                       |
| å¤šå±‚åµŒå¥—é€ä¼                  | `Context`                            |
| å…¨å±€çŠ¶æ€ï¼ˆç”¨æˆ·ã€ä¸»é¢˜ï¼‰       | `Context` æˆ–è½»é‡åº“ï¼ˆZustandï¼‰        |
| å¤æ‚ä¸šåŠ¡çŠ¶æ€ï¼ˆè´­ç‰©è½¦ã€è¡¨å•ï¼‰ | Redux / Zustand                      |
| çˆ¶è°ƒç”¨å­æ–¹æ³•                 | `forwardRef` + `useImperativeHandle` |

> **åŸåˆ™**ï¼šä¼˜å…ˆç”¨ `props`ï¼Œé¿å…è¿‡æ—©å¼•å…¥å…¨å±€çŠ¶æ€ï¼›Context ä¸é€‚åˆé«˜é¢‘æ›´æ–°ï¼ˆä¼šè§¦å‘æ‰€æœ‰æ¶ˆè´¹è€…é‡æ¸²æŸ“ï¼‰ã€‚

## reactæ— çŠ¶æ€ç»„ä»¶å’Œclassç±»ç»„ä»¶çš„åŒºåˆ«

åœ¨ React ä¸­ï¼Œâ€œæ— çŠ¶æ€ç»„ä»¶â€é€šå¸¸æŒ‡ **å‡½æ•°ç»„ä»¶ï¼ˆFunctional Componentï¼‰**ï¼Œè€Œâ€œç±»ç»„ä»¶ï¼ˆClass Componentï¼‰â€æ˜¯ ES6 class å†™æ³•çš„ç»„ä»¶ã€‚å®ƒä»¬çš„æ ¸å¿ƒåŒºåˆ«å¦‚ä¸‹ï¼š

---

### ä¸€ã€åŸºæœ¬å®šä¹‰

| ç±»å‹                       | å†™æ³•                                                                   | æ˜¯å¦æœ‰çŠ¶æ€                                    |
| -------------------------- | ---------------------------------------------------------------------- | --------------------------------------------- |
| **å‡½æ•°ç»„ä»¶ï¼ˆæ— çŠ¶æ€ç»„ä»¶ï¼‰** | `function MyComp() { return <div /> }`                                 | **æœ€åˆæ— çŠ¶æ€**ï¼Œä½† **Hooks å‡ºç°åå¯ç®¡ç†çŠ¶æ€** |
| **ç±»ç»„ä»¶**                 | `class MyComp extends React.Component { render() { return <div /> } }` | **å¤©ç”Ÿæ”¯æŒçŠ¶æ€å’Œç”Ÿå‘½å‘¨æœŸ**                    |

> ğŸ“Œ æ³¨æ„ï¼š**â€œæ— çŠ¶æ€ç»„ä»¶â€è¿™ä¸ªè¯´æ³•åœ¨ Hooksï¼ˆReact 16.8+ï¼‰ä¹‹åå·²è¿‡æ—¶**ï¼Œå› ä¸ºå‡½æ•°ç»„ä»¶ç°åœ¨ä¹Ÿèƒ½æ‹¥æœ‰çŠ¶æ€ã€‚

---

### äºŒã€æ ¸å¿ƒåŒºåˆ«

| ç‰¹æ€§                | å‡½æ•°ç»„ä»¶ï¼ˆ+ Hooksï¼‰            | ç±»ç»„ä»¶                                                                |
| ------------------- | ------------------------------ | --------------------------------------------------------------------- |
| **çŠ¶æ€ç®¡ç†**        | `useState`, `useReducer`       | `this.state` + `setState`                                             |
| **å‰¯ä½œç”¨å¤„ç†**      | `useEffect`                    | `componentDidMount` / `componentDidUpdate` / `componentWillUnmount`   |
| **æ€§èƒ½**            | æ›´è½»é‡ï¼Œæ—  class å®ä¾‹å¼€é”€      | åˆ›å»ºå®ä¾‹ï¼Œå†…å­˜å ç”¨ç•¥é«˜                                                |
| **ä»£ç ç®€æ´æ€§**      | æ›´ç®€æ´ã€æ‰å¹³ï¼Œé€»è¾‘æŒ‰å…³æ³¨ç‚¹èšåˆ | é€»è¾‘åˆ†æ•£åœ¨å¤šä¸ªç”Ÿå‘½å‘¨æœŸä¸­                                              |
| **`this` é—®é¢˜**     | æ—  `this`ï¼Œé¿å…ç»‘å®šçƒ¦æ¼        | éœ€æ‰‹åŠ¨ç»‘å®šæ–¹æ³•ï¼ˆå¦‚ `this.handleClick = this.handleClick.bind(this)`ï¼‰ |
| **é€»è¾‘å¤ç”¨**        | è‡ªå®šä¹‰ Hookï¼ˆç»„åˆå¼ï¼Œæ— åµŒå¥—ï¼‰  | HOC / Render Propsï¼ˆæ˜“äº§ç”Ÿâ€œWrapper Hellâ€ï¼‰                            |
| **çƒ­æ›´æ–°ï¼ˆHMRï¼‰**   | æ”¯æŒæ›´å¥½                       | å¯èƒ½ä¸¢å¤±çŠ¶æ€                                                          |
| **TypeScript æ”¯æŒ** | ç±»å‹æ¨å¯¼æ›´è‡ªç„¶                 | éœ€å¤„ç† `this` ç±»å‹                                                    |

---

### ä¸‰ã€èƒ½åŠ›å¯¹æ¯”ï¼ˆç°ä»£ Reactï¼‰

| èƒ½åŠ›       | å‡½æ•°ç»„ä»¶                                   | ç±»ç»„ä»¶                                       |
| ---------- | ------------------------------------------ | -------------------------------------------- |
| ä½¿ç”¨ state | âœ… (`useState`)                             | âœ…                                            |
| å¤„ç†å‰¯ä½œç”¨ | âœ… (`useEffect`)                            | âœ…                                            |
| è·å– ref   | âœ… (`useRef`, `forwardRef`)                 | âœ… (`createRef`)                              |
| é”™è¯¯è¾¹ç•Œ   | âŒï¼ˆéœ€ç”¨ç±»ç»„ä»¶æˆ–ç¬¬ä¸‰æ–¹åº“ï¼‰                  | âœ…ï¼ˆ`componentDidCatch`ï¼‰                     |
| æ€§èƒ½ä¼˜åŒ–   | âœ… (`React.memo`, `useMemo`, `useCallback`) | âœ… (`PureComponent`, `shouldComponentUpdate`) |

> âš ï¸ å”¯ä¸€å‡½æ•°ç»„ä»¶**ä¸èƒ½ç›´æ¥å®ç°**çš„æ˜¯ **é”™è¯¯è¾¹ç•Œï¼ˆError Boundaryï¼‰**ï¼Œå¿…é¡»ç”¨ç±»ç»„ä»¶ï¼ˆæˆ–å°è£…å¥½çš„ç¬¬ä¸‰æ–¹ç»„ä»¶å¦‚ `react-error-boundary`ï¼‰ã€‚

---

### å››ã€å®˜æ–¹æ€åº¦ä¸è¶‹åŠ¿

- **React å®˜æ–¹å¼ºçƒˆæ¨èä½¿ç”¨å‡½æ•°ç»„ä»¶ + Hooks**ã€‚
- æ–°ç‰¹æ€§ï¼ˆå¦‚ Concurrent Modeã€Suspenseï¼‰ä¼˜å…ˆä¸ºå‡½æ•°ç»„ä»¶è®¾è®¡ã€‚
- ç±»ç»„ä»¶ä»å—æ”¯æŒï¼Œä½†**æ–°é¡¹ç›®åº”ä¼˜å…ˆä½¿ç”¨å‡½æ•°ç»„ä»¶**ã€‚

---

### âœ… æ€»ç»“

| è§’åº¦         | ç»“è®º                                                         |
| ------------ | ------------------------------------------------------------ |
| **å†å²**     | â€œæ— çŠ¶æ€ç»„ä»¶â€æ›¾æŒ‡çº¯å±•ç¤ºç»„ä»¶ï¼ŒHooks åå·²èƒ½å®Œå…¨æ›¿ä»£ç±»ç»„ä»¶       |
| **ç°çŠ¶**     | å‡½æ•°ç»„ä»¶ = å…¨èƒ½ç»„ä»¶ï¼Œç±»ç»„ä»¶ = é—ç•™æ–¹æ¡ˆ                       |
| **é€‰æ‹©å»ºè®®** | **æ–°é¡¹ç›®ä¸€å¾‹ä½¿ç”¨å‡½æ•°ç»„ä»¶ + Hooks**ï¼›ä»…ç»´æŠ¤æ—§ä»£ç æ—¶æ¥è§¦ç±»ç»„ä»¶ |

> ğŸ’¡ **è®°ä½**ï¼š  
> **â€œå‡½æ•°ç»„ä»¶ä¸æ˜¯æ— çŠ¶æ€çš„ï¼Œè€Œæ˜¯æ›´ä¼˜é›…çš„çŠ¶æ€ç®¡ç†è€…ã€‚â€**

## reactå¦‚ä½•åšåˆ°å’Œvueä¸­keep-aliveçš„ç¼“å­˜æ•ˆæœ

React **æ²¡æœ‰å†…ç½®ç±»ä¼¼ Vue `keep-alive` çš„ç»„ä»¶ç¼“å­˜æœºåˆ¶**ï¼Œä½†å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å®ç°**ç»„ä»¶çŠ¶æ€ç¼“å­˜ / ä¿ç•™ DOM / é¿å…é‡å¤æ¸²æŸ“**çš„æ•ˆæœï¼š

---

### âœ… æ–¹æ¡ˆä¸€ï¼š**çŠ¶æ€æå‡ + æ¡ä»¶æ¸²æŸ“ï¼ˆæœ€å¸¸ç”¨ï¼‰**
å°†ç»„ä»¶çš„**çŠ¶æ€æå‡åˆ°çˆ¶ç»„ä»¶**ï¼Œå³ä½¿å­ç»„ä»¶å¸è½½ï¼ŒçŠ¶æ€ä»ä¿ç•™ï¼Œé‡æ–°æŒ‚è½½æ—¶æ¢å¤ã€‚

```jsx
function Parent() {
  const [showA, setShowA] = useState(true);
  const [stateA, setStateA] = useState({ count: 0 }); // çŠ¶æ€ä¿ç•™åœ¨çˆ¶çº§

  return (
    <div>
      <button onClick={() => setShowA(!showA)}>Toggle</button>
      {showA && <ChildA state={stateA} onStateChange={setStateA} />}
    </div>
  );
}
```
> âœ… ä¼˜ç‚¹ï¼šç®€å•ã€å¯æ§  
> âŒ ç¼ºç‚¹ï¼šéœ€æ‰‹åŠ¨ç®¡ç†çŠ¶æ€ï¼Œä¸é€‚åˆå¤æ‚ç»„ä»¶æ ‘

---

### âœ… æ–¹æ¡ˆäºŒï¼š**ä½¿ç”¨ `display: none` / CSS æ§åˆ¶æ˜¾éšï¼ˆä¿ç•™ DOMï¼‰**
ä¸å¸è½½ç»„ä»¶ï¼Œä»…éšè—ï¼Œä»è€Œä¿ç•™çŠ¶æ€å’Œ DOM ç»“æ„ã€‚

```jsx
{showA ? <ChildA /> : null}          // å¸è½½ï¼ˆçŠ¶æ€ä¸¢å¤±ï¼‰
<div style={{ display: showA ? 'block' : 'none' }}><ChildA /></div> // ä¸å¸è½½ï¼ˆçŠ¶æ€ä¿ç•™ï¼‰
```
> âœ… ä¼˜ç‚¹ï¼šå®Œå…¨ä¿ç•™çŠ¶æ€ã€DOMã€å®šæ—¶å™¨ç­‰  
> âŒ ç¼ºç‚¹ï¼šéšè—çš„ç»„ä»¶ä»åœ¨å†…å­˜ä¸­ï¼Œå¯èƒ½å½±å“æ€§èƒ½ï¼ˆå¤§é‡ç»„ä»¶æ—¶ä¸æ¨èï¼‰

---

### âœ… æ–¹æ¡ˆä¸‰ï¼š**è‡ªå®šä¹‰ç¼“å­˜å®¹å™¨ï¼ˆæ¨¡æ‹Ÿ keep-aliveï¼‰**
é€šè¿‡ `Map` ç¼“å­˜ç»„ä»¶çš„ **React Element** æˆ– **çŠ¶æ€ + props**ï¼Œåˆ‡æ¢æ—¶å¤ç”¨ã€‚

#### ç¤ºä¾‹ï¼šç¼“å­˜ç»„ä»¶å®ä¾‹ï¼ˆä½¿ç”¨ `ref` + `cloneElement`ï¼‰
```jsx
const KeepAlive = ({ children, active }) => {
  const cacheRef = useRef(new Map());
  const key = children.key;

  if (active && !cacheRef.current.has(key)) {
    cacheRef.current.set(key, children); // ç¼“å­˜ element
  }

  return active ? cacheRef.current.get(key) : null;
};

// ä½¿ç”¨
<KeepAlive active={tab === 'A'} key="tabA">
  <TabA />
</KeepAlive>
```
> âš ï¸ æ³¨æ„ï¼šæ­¤æ–¹æ³•ç¼“å­˜çš„æ˜¯ **Elementï¼ˆæè¿°ï¼‰è€Œéå®ä¾‹**ï¼Œæ— æ³•ä¿ç•™å†…éƒ¨çŠ¶æ€ã€‚è‹¥éœ€ä¿ç•™çŠ¶æ€ï¼Œéœ€ç»“åˆæ–¹æ¡ˆä¸€ã€‚

---

### âœ… æ–¹æ¡ˆå››ï¼š**ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“**
- [`react-activation`](https://github.com/CJY0208/react-activation)ï¼ˆæ¨èï¼‰  
  æä¾› `<KeepAlive>` å’Œ `<AliveScope>`ï¼ŒçœŸæ­£å®ç° Vue å¼ç¼“å­˜ï¼š
  ```jsx
  import { AliveScope, KeepAlive } from 'react-activation';

  function App() {
    return (
      <AliveScope>
        <KeepAlive name="tabA">
          <TabA />
        </KeepAlive>
      </AliveScope>
    );
  }
  ```
  - âœ… æ”¯æŒçŠ¶æ€ã€DOMã€å®šæ—¶å™¨ã€å¼‚æ­¥æ“ä½œå®Œæ•´ä¿ç•™
  - âœ… æ”¯æŒè·¯ç”±çº§ç¼“å­˜
  - âŒ éœ€é¢å¤–ä¾èµ–ï¼Œä¸”ä¸ React å®˜æ–¹ç†å¿µç•¥æœ‰å†²çªï¼ˆéæ ‡å‡†æ¨¡å¼ï¼‰

---

### âœ… æ–¹æ¡ˆäº”ï¼š**ç»“åˆ React Router å®ç° Tab ç¼“å­˜**
åœ¨è·¯ç”±åˆ‡æ¢æ—¶ï¼Œç”¨ `display: none` éšè—éæ¿€æ´»è·¯ç”±ï¼š

```jsx
<Routes>
  {routes.map(route => (
    <Route
      key={route.path}
      path={route.path}
      element={
        <div style={{ display: currentPath === route.path ? 'block' : 'none' }}>
          <route.component />
        </div>
      }
    />
  ))}
</Routes>
```

---

### ğŸ“Œ æ€»ç»“ï¼šå¦‚ä½•é€‰æ‹©ï¼Ÿ

| éœ€æ±‚                           | æ¨èæ–¹æ¡ˆ                                                   |
| ------------------------------ | ---------------------------------------------------------- |
| ç®€å•çŠ¶æ€ç¼“å­˜                   | **çŠ¶æ€æå‡ï¼ˆæ–¹æ¡ˆä¸€ï¼‰**                                     |
| å®Œæ•´ä¿ç•™ç»„ä»¶ï¼ˆå« DOMã€å®šæ—¶å™¨ï¼‰ | **CSS éšè—ï¼ˆæ–¹æ¡ˆäºŒï¼‰** æˆ– **`react-activation`ï¼ˆæ–¹æ¡ˆå››ï¼‰** |
| è·¯ç”±çº§ Tab ç¼“å­˜                | **`react-activation`** æˆ– **è‡ªå®šä¹‰è·¯ç”±å®¹å™¨ + éšè—**        |
| è½»é‡çº§ã€æ— ä¾èµ–                 | **çŠ¶æ€æå‡ + åˆç†è®¾è®¡çŠ¶æ€ç²’åº¦**                            |

> ğŸ’¡ **æ ¸å¿ƒæ€æƒ³**ï¼š  
> React å“²å­¦æ˜¯â€œçŠ¶æ€é©±åŠ¨ UIâ€ï¼Œ**ç¼“å­˜æœ¬è´¨æ˜¯çŠ¶æ€ç®¡ç†é—®é¢˜**ã€‚ä¼˜å…ˆé€šè¿‡çŠ¶æ€è®¾è®¡é¿å…é¢‘ç¹å¸è½½ï¼Œè€Œéå¼ºè¡Œä¿ç•™ç»„ä»¶å®ä¾‹ã€‚

## Reactå¦‚ä½•åšè·¯ç”±ç›‘å¬

åœ¨ React ä¸­ï¼Œ**è·¯ç”±ç›‘å¬**ä¸»è¦ç”¨äºå“åº” URL å˜åŒ–ï¼ˆå¦‚é¡µé¢åˆ‡æ¢ã€å‚æ•°æ›´æ–°ï¼‰ï¼Œå¸¸è§äºåŸ‹ç‚¹ã€æƒé™æ ¡éªŒã€æ»šåŠ¨æ¢å¤ç­‰åœºæ™¯ã€‚æ ¹æ®ä½¿ç”¨çš„è·¯ç”±åº“ï¼ˆä¸»è¦æ˜¯ `react-router-dom`ï¼‰ï¼Œæœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š

---

### ä¸€ã€ä½¿ç”¨ `useLocation` + `useEffect`ï¼ˆæ¨èï¼Œé€‚ç”¨äºå‡½æ•°ç»„ä»¶ï¼‰

```jsx
import { useEffect } from 'react';
import { useLocation } from 'react-router-dom';

function App() {
  const location = useLocation();

  useEffect(() => {
    // æ¯æ¬¡è·¯ç”±å˜åŒ–éƒ½ä¼šè§¦å‘
    console.log('Route changed to:', location.pathname);
    
    // ç¤ºä¾‹ï¼šé¡µé¢åŸ‹ç‚¹
    trackPageView(location.pathname);
    
    // ç¤ºä¾‹ï¼šå›åˆ°é¡¶éƒ¨
    window.scrollTo(0, 0);
  }, [location]);

  return <Outlet />;
}
```

> âœ… **ä¼˜ç‚¹**ï¼šç®€æ´ã€å“åº”å¼ã€è‡ªåŠ¨æ¸…ç†  
> ğŸ”” æ³¨æ„ï¼šéœ€å°† `location` ä½œä¸ºä¾èµ–é¡¹

---

### äºŒã€ä½¿ç”¨ `useNavigation`ï¼ˆReact Router v6.4+ æ–°å¢ï¼‰

é€‚ç”¨äºæ•°æ®è·¯ç”±å™¨ï¼ˆ`createBrowserRouter`ï¼‰ï¼š
```js
const navigation = useNavigation();
// navigation.state: 'idle' | 'loading' | 'submitting'
```
ä½†**ä¸ç›´æ¥ç”¨äºç›‘å¬è·¯å¾„å˜åŒ–**ï¼Œæ›´å¤šç”¨äºåŠ è½½çŠ¶æ€ã€‚

---

### ä¸‰ã€é€šè¿‡ `history` å¯¹è±¡ç›‘å¬ï¼ˆé€‚ç”¨äºç±»ç»„ä»¶æˆ–å…¨å±€ç›‘å¬ï¼‰

#### React Router v5ï¼š
```js
import { useHistory } from 'react-router-dom';

// åœ¨ç»„ä»¶å†…
const history = useHistory();
useEffect(() => {
  const unlisten = history.listen((location, action) => {
    console.log('Route changed:', location.pathname);
  });
  return unlisten; // æ¸…ç†ç›‘å¬
}, []);
```

#### React Router v6ï¼ˆéœ€è‡ªå®šä¹‰ historyï¼‰ï¼š
v6 é»˜è®¤ä¸æš´éœ² `history`ï¼Œä½†å¯é€šè¿‡ä»¥ä¸‹æ–¹å¼åˆ›å»ºå¯ç›‘å¬çš„ `history`ï¼š

```js
// history.js
import { createBrowserHistory } from 'history';
export const history = createBrowserHistory();

// router.js
import { Router } from 'react-router-dom';
import { history } from './history';

function App() {
  return (
    <Router history={history}>
      {/* routes */}
    </Router>
  );
}

// å…¨å±€ç›‘å¬ï¼ˆå¦‚åœ¨ index.jsï¼‰
history.listen((location, action) => {
  console.log('Route changed:', location.pathname);
});
```

> âš ï¸ æ³¨æ„ï¼š**v6 å®˜æ–¹ä¸æ¨èæ­¤æ–¹å¼**ï¼Œä¼˜å…ˆç”¨ `useLocation`

---

### å››ã€åœ¨è·¯ç”±é…ç½®ä¸­ç»Ÿä¸€å¤„ç†ï¼ˆv6 æ•°æ®è·¯ç”±å™¨ï¼‰

ä½¿ç”¨ `createBrowserRouter` æ—¶ï¼Œå¯åœ¨ loader/action ä¸­å¤„ç†ï¼Œä½†**æ— æ³•ç›´æ¥ç›‘å¬æ‰€æœ‰è·¯ç”±å˜åŒ–**ã€‚ä»éœ€é…åˆ `useLocation`ã€‚

---

### äº”ã€ç±»ç»„ä»¶ä¸­ç›‘å¬ï¼ˆä¸æ¨èï¼Œä»…å…¼å®¹æ—§ä»£ç ï¼‰

```jsx
import { withRouter } from 'react-router-dom';

class MyComponent extends Component {
  componentDidUpdate(prevProps) {
    if (this.props.location !== prevProps.location) {
      console.log('Route changed');
    }
  }
}

export default withRouter(MyComponent);
```

> ğŸ“Œ `withRouter` åœ¨ v6 ä¸­å·²ç§»é™¤ï¼Œ**æ–°é¡¹ç›®ä¸è¦ä½¿ç”¨**

---

### âœ… æœ€ä½³å®è·µæ€»ç»“

| åœºæ™¯                 | æ¨èæ–¹å¼                                              |
| -------------------- | ----------------------------------------------------- |
| å‡½æ•°ç»„ä»¶ç›‘å¬è·¯ç”±å˜åŒ– | **`useLocation` + `useEffect`**                       |
| å…¨å±€åŸ‹ç‚¹ / æƒé™æ ¡éªŒ  | åœ¨æ ¹ç»„ä»¶ç”¨ `useLocation` ç›‘å¬                         |
| éœ€è¦å…¼å®¹ç±»ç»„ä»¶       | ä½¿ç”¨ HOC åŒ…è£… `useLocation` è‡ªå®šä¹‰ Hook               |
| å¿…é¡»ç”¨ history ç›‘å¬  | v5 ç”¨ `history.listen`ï¼Œv6 éœ€è‡ªå®šä¹‰ historyï¼ˆä¸æ¨èï¼‰ |

---

### ğŸ’¡ è¡¥å……ï¼šç›‘å¬æŸ¥è¯¢å‚æ•°å˜åŒ–
è‹¥éœ€ç›‘å¬ `?search=value` å˜åŒ–ï¼Œç»“åˆ `useSearchParams`ï¼š

```js
const [searchParams] = useSearchParams();
useEffect(() => {
  console.log('Query changed:', searchParams.get('q'));
}, [searchParams]);
```

---

âœ… **æ ¸å¿ƒåŸåˆ™**ï¼š  
**ä¼˜å…ˆä½¿ç”¨ React Router v6 æä¾›çš„ Hooksï¼ˆ`useLocation`, `useParams`, `useSearchParams`ï¼‰**ï¼Œé¿å…ç›´æ¥æ“ä½œ historyï¼Œä¿æŒä»£ç å£°æ˜å¼å’Œå¯ç»´æŠ¤æ€§ã€‚

## Reactæœ‰å“ªå‡ ç§æ–¹å¼æ”¹å˜state

åœ¨ React ä¸­ï¼Œ**æ”¹å˜ state çš„æ–¹å¼å–å†³äºç»„ä»¶ç±»å‹ï¼ˆå‡½æ•°ç»„ä»¶ vs ç±»ç»„ä»¶ï¼‰**ã€‚æ ¸å¿ƒåŸåˆ™æ˜¯ï¼š**æ°¸è¿œä¸è¦ç›´æ¥ä¿®æ”¹ stateï¼Œå¿…é¡»é€šè¿‡ React æä¾›çš„æ›´æ–°æ–¹æ³•è§¦å‘é‡æ–°æ¸²æŸ“**ã€‚

---

### ä¸€ã€å‡½æ•°ç»„ä»¶ï¼ˆä½¿ç”¨ Hooksï¼‰

#### 1. **`useState` æ›´æ–°çŠ¶æ€**
```js
const [count, setCount] = useState(0);

// æ–¹å¼1ï¼šä¼ å…¥æ–°å€¼
setCount(1);

// æ–¹å¼2ï¼šä¼ å…¥å‡½æ•°ï¼ˆæ¨èç”¨äºä¾èµ–æ—§çŠ¶æ€ï¼‰
setCount(prev => prev + 1);
```

#### 2. **`useReducer` æ›´æ–°å¤æ‚çŠ¶æ€**
```js
const [state, dispatch] = useReducer(reducer, initialState);

// é€šè¿‡ dispatch action è§¦å‘ reducer
dispatch({ type: 'INCREMENT', payload: 1 });
```

> âœ… é€‚ç”¨åœºæ™¯ï¼š  
> - `useState`ï¼šç®€å•çŠ¶æ€ï¼ˆnumberã€stringã€ç®€å•å¯¹è±¡ï¼‰  
> - `useReducer`ï¼šå¤æ‚çŠ¶æ€é€»è¾‘ã€å¤šå­çŠ¶æ€å…³è”æ›´æ–°

---

### äºŒã€ç±»ç»„ä»¶

#### 1. **`this.setState()`**
```js
// æ–¹å¼1ï¼šä¼ å…¥å¯¹è±¡ï¼ˆæµ…åˆå¹¶ï¼‰
this.setState({ count: 1 });

// æ–¹å¼2ï¼šä¼ å…¥å‡½æ•°ï¼ˆæ¨èç”¨äºä¾èµ–æ—§çŠ¶æ€ï¼‰
this.setState((prevState, props) => ({
  count: prevState.count + 1
}));
```

> âš ï¸ æ³¨æ„ï¼š  
> - `setState` æ˜¯**å¼‚æ­¥æ‰¹é‡æ›´æ–°**ï¼ˆReact æ§åˆ¶çš„ä¸Šä¸‹æ–‡ä¸­ï¼‰  
> - å¯¹è±¡æ›´æ–°éœ€æ‰‹åŠ¨å±•å¼€ï¼ˆ`setState` åªåšæµ…åˆå¹¶ï¼‰

---

### ä¸‰ã€å…¶ä»–é—´æ¥æ–¹å¼ï¼ˆä¸ç›´æ¥è°ƒç”¨ setStateï¼‰

#### 1. **çŠ¶æ€ç®¡ç†åº“ï¼ˆRedux / Zustand ç­‰ï¼‰**
```js
// Redux
dispatch({ type: 'SET_COUNT', payload: 1 });

// Zustand
useStore.getState().setCount(1);
```

#### 2. **Context API + useReducer**
```js
// åœ¨ Context Provider ä¸­ä½¿ç”¨ useReducer
const [state, dispatch] = useReducer(reducer, initialState);
return (
  <MyContext.Provider value={{ state, dispatch }}>
    {children}
  </MyContext.Provider>
);
```

---

### âŒ é”™è¯¯æ–¹å¼ï¼ˆç¦æ­¢ï¼ï¼‰
```js
// ç›´æ¥ä¿®æ”¹ stateï¼ˆä¸ä¼šè§¦å‘ re-renderï¼‰
this.state.count = 1;        // ç±»ç»„ä»¶
count = 1;                   // å‡½æ•°ç»„ä»¶ï¼ˆå³ä½¿ç”¨äº† useStateï¼‰
state.user.name = 'Alice';   // å¯¹è±¡å±æ€§ç›´æ¥èµ‹å€¼
```

---

### âœ… æœ€ä½³å®è·µæ€»ç»“

| åœºæ™¯                 | æ¨èæ–¹å¼                               |
| -------------------- | -------------------------------------- |
| ç®€å•çŠ¶æ€ï¼ˆå‡½æ•°ç»„ä»¶ï¼‰ | `useState` + å‡½æ•°å¼æ›´æ–°                |
| å¤æ‚çŠ¶æ€é€»è¾‘         | `useReducer` æˆ–çŠ¶æ€ç®¡ç†åº“              |
| ç±»ç»„ä»¶ï¼ˆé—ç•™ä»£ç ï¼‰   | `this.setState` + å‡½æ•°å¼æ›´æ–°           |
| å…¨å±€å…±äº«çŠ¶æ€         | Redux / Zustand / Context + useReducer |

> ğŸ’¡ **å…³é”®åŸåˆ™**ï¼š  
> **æ‰€æœ‰çŠ¶æ€æ›´æ–°å¿…é¡»é€šè¿‡ React çš„è°ƒåº¦æœºåˆ¶ï¼ˆsetState / setter / dispatchï¼‰**ï¼Œç¡®ä¿è™šæ‹Ÿ DOM æ­£ç¡® diff å’Œæ¸²æŸ“ã€‚

## Reactæœ‰å“ªå‡ ç§åˆ›å»ºç»„ä»¶æ–¹æ³•

åœ¨ React çš„å‘å±•å†ç¨‹ä¸­ï¼Œåˆ›å»ºç»„ä»¶çš„æ–¹å¼ç»å†äº†å¤šæ¬¡æ¼”è¿›ã€‚ç›®å‰ä¸»è¦æœ‰ä»¥ä¸‹ **ä¸‰ç§ä¸»æµæ–¹å¼**ï¼Œå…¶ä¸­å‰ä¸¤ç§æ˜¯ç°ä»£ React æ¨èçš„å†™æ³•ï¼š

---

### âœ… 1. **å‡½æ•°ç»„ä»¶ï¼ˆFunction Componentï¼‰ + Hooksï¼ˆReact 16.8+ æ¨èï¼‰**
> **å½“å‰å®˜æ–¹é¦–é€‰æ–¹å¼**ï¼Œç®€æ´ã€é«˜æ•ˆã€é€»è¾‘å¤ç”¨èƒ½åŠ›å¼ºã€‚

```jsx
// åŸºç¡€å†™æ³•
function Welcome(props) {
  return <h1>Hello, {props.name}!</h1>;
}

// ä½¿ç”¨ Hooks ç®¡ç†çŠ¶æ€å’Œå‰¯ä½œç”¨
import { useState, useEffect } from 'react';

function Counter() {
  const [count, setCount] = useState(0);
  
  useEffect(() => {
    document.title = `Count: ${count}`;
  }, [count]);

  return <button onClick={() => setCount(count + 1)}>{count}</button>;
}
```

**ç‰¹ç‚¹**ï¼š
- ä½¿ç”¨ `useState`ã€`useEffect` ç­‰ Hooks ç®¡ç†çŠ¶æ€å’Œç”Ÿå‘½å‘¨æœŸ
- æ—  `this` ç»‘å®šé—®é¢˜
- æ›´æ˜“æµ‹è¯•å’Œä¼˜åŒ–
- æ”¯æŒ TypeScript ç±»å‹æ¨å¯¼

---

### âœ… 2. **ES6 ç±»ç»„ä»¶ï¼ˆClass Componentï¼‰**
> React 16.8 ä¹‹å‰çš„ä¸»è¦æ–¹å¼ï¼Œç°ä¸»è¦ç”¨äºç»´æŠ¤æ—§ä»£ç ã€‚

```jsx
import React, { Component } from 'react';

class Welcome extends Component {
  constructor(props) {
    super(props);
    this.state = { count: 0 };
  }

  componentDidMount() {
    document.title = `Count: ${this.state.count}`;
  }

  render() {
    return (
      <button onClick={() => this.setState({ count: this.state.count + 1 })}>
        {this.state.count}
      </button>
    );
  }
}
```

**ç‰¹ç‚¹**ï¼š
- ä½¿ç”¨ `this.state` å’Œ `this.setState`
- é€šè¿‡ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼ˆ`componentDidMount` ç­‰ï¼‰å¤„ç†å‰¯ä½œç”¨
- éœ€è¦ç»‘å®šäº‹ä»¶å¤„ç†å™¨ï¼ˆæˆ–ä½¿ç”¨ç®­å¤´å‡½æ•°ï¼‰
- å®˜æ–¹å·²ä¸æ¨èæ–°é¡¹ç›®ä½¿ç”¨

---

### âš ï¸ 3. **React.createClassï¼ˆå·²åºŸå¼ƒï¼‰**
> React æ—©æœŸï¼ˆv0.14 ä¹‹å‰ï¼‰çš„æ–¹å¼ï¼Œ**ç°å·²å®Œå…¨åºŸå¼ƒ**ï¼Œä»…ç”¨äºäº†è§£å†å²ã€‚

```js
// âŒ ä¸è¦ä½¿ç”¨ï¼
var Welcome = React.createClass({
  getInitialState: function() {
    return { name: 'Alice' };
  },
  render: function() {
    return <h1>Hello, {this.state.name}!</h1>;
  }
});
```

**æ·˜æ±°åŸå› **ï¼š
- ä¾èµ– mixinsï¼ˆå·²è¢« Hooks å–ä»£ï¼‰
- è¯­æ³•å†—ä½™
- ä¸ç¬¦åˆç°ä»£ JavaScript æ ‡å‡†

---

### ğŸ” è¡¥å……ï¼šç‰¹æ®Šç»„ä»¶å½¢å¼

#### â€¢ **é«˜é˜¶ç»„ä»¶ï¼ˆHOCï¼‰**  
ä¸æ˜¯åˆ›å»ºç»„ä»¶çš„æ–¹å¼ï¼Œè€Œæ˜¯**å¤ç”¨ç»„ä»¶é€»è¾‘çš„æ¨¡å¼**ï¼š
```js
const withLoading = (WrappedComponent) => (props) =>
  props.isLoading ? <div>Loading...</div> : <WrappedComponent {...props} />;
```

#### â€¢ **Render Props**  
åŒæ ·æ˜¯é€»è¾‘å¤ç”¨æ¨¡å¼ï¼Œéç»„ä»¶åˆ›å»ºæ–¹å¼ï¼š
```jsx
<DataProvider render={data => <h1>Hello {data.target}</h1>} />
```

---

### âœ… æ€»ç»“ï¼šå¦‚ä½•é€‰æ‹©ï¼Ÿ

| åœºæ™¯           | æ¨èæ–¹å¼                             |
| -------------- | ------------------------------------ |
| **æ–°é¡¹ç›®å¼€å‘** | **å‡½æ•°ç»„ä»¶ + Hooks**ï¼ˆå®˜æ–¹å¼ºçƒˆæ¨èï¼‰ |
| **ç»´æŠ¤æ—§é¡¹ç›®** | ç±»ç»„ä»¶ï¼ˆé€æ­¥è¿ç§»åˆ°å‡½æ•°ç»„ä»¶ï¼‰         |
| **å­¦ä¹ /é¢è¯•**  | äº†è§£ç±»ç»„ä»¶ï¼Œä½†é‡ç‚¹æŒæ¡å‡½æ•°ç»„ä»¶       |

> ğŸ’¡ **æ ¸å¿ƒç»“è®º**ï¼š  
> **ç°ä»£ React å¼€å‘ = å‡½æ•°ç»„ä»¶ + Hooks**ã€‚ç±»ç»„ä»¶å·²æˆä¸ºå†å²ï¼Œ`createClass` å·²å½»åº•æ·˜æ±°ã€‚

## reactä¸­propså’Œstateæœ‰ä»€ä¹ˆåŒºåˆ«

åœ¨ React ä¸­ï¼Œ`props` å’Œ `state` éƒ½æ˜¯ç”¨äºç®¡ç†æ•°æ®çš„æœºåˆ¶ï¼Œä½†å®ƒä»¬åœ¨**æ¥æºã€å¯å˜æ€§ã€ç”¨é€”å’Œç”Ÿå‘½å‘¨æœŸ**ä¸Šæœ‰æœ¬è´¨åŒºåˆ«ï¼š

---

### âœ… æ ¸å¿ƒåŒºåˆ«å¯¹æ¯”è¡¨

| ç‰¹æ€§         | **props**                                           | **state**                                                 |
| ------------ | --------------------------------------------------- | --------------------------------------------------------- |
| **æ¥æº**     | ç”±**çˆ¶ç»„ä»¶ä¼ é€’**ï¼ˆå¤–éƒ¨è¾“å…¥ï¼‰                        | ç»„ä»¶**å†…éƒ¨å®šä¹‰å’Œç®¡ç†**ï¼ˆå†…éƒ¨çŠ¶æ€ï¼‰                        |
| **å¯å˜æ€§**   | **åªè¯»ï¼ˆimmutableï¼‰**<br>å­ç»„ä»¶ä¸èƒ½ä¿®æ”¹ props       | **å¯å˜ï¼ˆmutableï¼‰**<br>é€šè¿‡ `setState` / `useState` æ›´æ–°  |
| **ç”¨é€”**     | **é…ç½®ç»„ä»¶**ï¼ˆå¦‚æ ‡é¢˜ã€å›è°ƒå‡½æ•°ã€åˆå§‹å€¼ï¼‰            | **è®°å½•ç»„ä»¶éšæ—¶é—´å˜åŒ–çš„æ•°æ®**ï¼ˆå¦‚è¡¨å•è¾“å…¥ã€è®¡æ•°å™¨ï¼‰        |
| **æ›´æ–°æ–¹å¼** | çˆ¶ç»„ä»¶é‡æ–°æ¸²æŸ“æ—¶ä¼ å…¥æ–°å€¼                            | ç»„ä»¶è‡ªèº«è°ƒç”¨çŠ¶æ€æ›´æ–°å‡½æ•°                                  |
| **ç”Ÿå‘½å‘¨æœŸ** | æ¯æ¬¡çˆ¶ç»„ä»¶ re-render éƒ½å¯èƒ½å˜åŒ–                     | åœ¨ç»„ä»¶æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­æŒç»­å­˜åœ¨ï¼ˆç›´åˆ°å¸è½½ï¼‰                  |
| **é»˜è®¤å€¼**   | å¯é€šè¿‡ `defaultProps`ï¼ˆç±»ï¼‰æˆ–è§£æ„é»˜è®¤å€¼ï¼ˆå‡½æ•°ï¼‰è®¾ç½® | åˆå§‹åŒ–æ—¶åœ¨ `constructor`ï¼ˆç±»ï¼‰æˆ– `useState`ï¼ˆå‡½æ•°ï¼‰ä¸­è®¾å®š |

---

### ğŸ“Œ è¯¦ç»†è¯´æ˜

#### 1. **propsï¼šç»„ä»¶çš„â€œè¾“å…¥å‚æ•°â€**
- ç±»ä¼¼å‡½æ•°çš„å½¢å‚ï¼š
  ```jsx
  // çˆ¶ç»„ä»¶
  <UserCard name="Alice" age={25} onEdit={handleEdit} />

  // å­ç»„ä»¶
  function UserCard({ name, age, onEdit }) {
    return <div onClick={onEdit}>{name}, {age}</div>;
  }
  ```
- **å­ç»„ä»¶ç»ä¸èƒ½ç›´æ¥ä¿®æ”¹ props**ï¼š
  ```js
  // âŒ é”™è¯¯ï¼
  props.name = "Bob";
  ```

#### 2. **stateï¼šç»„ä»¶çš„â€œç§æœ‰è®°å¿†â€**
- ç”¨äºä¿å­˜ä¼šéšç”¨æˆ·äº¤äº’æˆ–æ—¶é—´å˜åŒ–çš„æ•°æ®ï¼š
  ```jsx
  function Counter() {
    const [count, setCount] = useState(0); // state
    
    return (
      <button onClick={() => setCount(count + 1)}>
        Clicked {count} times
      </button>
    );
  }
  ```
- **åªèƒ½é€šè¿‡ React æä¾›çš„æ–¹æ³•æ›´æ–°**ï¼ˆ`setState` / `useState` çš„ setterï¼‰

---

### ğŸ” æ•°æ®æµåŠ¨åŸåˆ™ï¼š**å•å‘æ•°æ®æµ**
```
çˆ¶ç»„ä»¶ state 
   â†“ ï¼ˆä½œä¸º props ä¼ é€’ï¼‰
å­ç»„ä»¶ props 
   â†“ ï¼ˆè§¦å‘çˆ¶ç»„ä»¶å›è°ƒï¼‰
çˆ¶ç»„ä»¶æ›´æ–°è‡ªèº« state 
   â†“ ï¼ˆé‡æ–°æ¸²æŸ“ï¼Œä¼ é€’æ–° propsï¼‰
å­ç»„ä»¶æ”¶åˆ°æ–° props
```
> âœ… æ‰€æœ‰çŠ¶æ€æœ€ç»ˆéƒ½åº”â€œæå‡â€åˆ°æœ€è¿‘çš„å…±åŒçˆ¶ç»„ä»¶ç®¡ç†ã€‚

---

### âš ï¸ å¸¸è§è¯¯åŒº

| è¯¯åŒº                          | æ­£ç¡®ç†è§£                                                                                          |
| ----------------------------- | ------------------------------------------------------------------------------------------------- |
| â€œprops æ˜¯é™æ€çš„â€              | props ä¼šéšçˆ¶ç»„ä»¶ re-render è€Œæ›´æ–°                                                                 |
| â€œstate åªèƒ½ç»„ä»¶è‡ªå·±ç”¨â€        | state å¯é€šè¿‡ props ä¼ é€’ç»™å­ç»„ä»¶ï¼ˆå˜æˆå­ç»„ä»¶çš„ propsï¼‰                                             |
| â€œprops å’Œ state ä¸èƒ½äº’ç›¸è½¬æ¢â€ | **props å¯åˆå§‹åŒ– state**ï¼ˆä½†éœ€è°¨æ…ï¼ï¼‰ï¼š<br>`const [name, setName] = useState(props.initialName)` |

> ğŸ’¡ **é‡è¦è­¦å‘Š**ï¼š  
> **ä¸è¦ç”¨ props ç›´æ¥åˆå§‹åŒ– state ååˆæœŸæœ›å®ƒéš props æ›´æ–°**ï¼ˆä¼šå¯¼è‡´çŠ¶æ€ä¸åŒæ­¥ï¼‰ã€‚æ­¤æ—¶åº”ä½¿ç”¨ **å—æ§ç»„ä»¶** æˆ– `useEffect` åŒæ­¥ã€‚

---

### âœ… æ€»ç»“ä¸€å¥è¯ï¼š
> **`props` æ˜¯ç»„ä»¶çš„â€œè¾“å…¥â€ï¼Œç”±å¤–éƒ¨æ§åˆ¶ï¼›`state` æ˜¯ç»„ä»¶çš„â€œè®°å¿†â€ï¼Œç”±è‡ªèº«ç®¡ç†ã€‚ä¸¤è€…å…±åŒé©±åŠ¨ UI å“åº”å˜åŒ–ï¼Œä½†èŒè´£åˆ†æ˜ï¼Œä¸å¯æ··æ·†ã€‚**

## React ä¸­ keys çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ

åœ¨ React ä¸­ï¼Œ**`key` æ˜¯ç”¨äºè¯†åˆ«åˆ—è¡¨ä¸­æ¯ä¸ªå…ƒç´ çš„å”¯ä¸€æ ‡è¯†ç¬¦**ï¼Œå®ƒçš„æ ¸å¿ƒä½œç”¨æ˜¯ï¼š**å¸®åŠ© React é«˜æ•ˆåœ°æ›´æ–°ï¼ˆdiffï¼‰åˆ—è¡¨ï¼Œé¿å…ä¸å¿…è¦çš„ DOM æ“ä½œï¼ŒåŒæ—¶ä¿æŒç»„ä»¶çŠ¶æ€çš„æ­£ç¡®æ€§**ã€‚

---

### âœ… ä¸€ã€`key` çš„æ ¸å¿ƒä½œç”¨

#### 1. **æå‡åˆ—è¡¨æ¸²æŸ“æ€§èƒ½ï¼ˆDiff ä¼˜åŒ–ï¼‰**
- å½“åˆ—è¡¨å˜åŒ–ï¼ˆå¢åˆ æ”¹ï¼‰æ—¶ï¼ŒReact é€šè¿‡ `key` åˆ¤æ–­å“ªäº›å…ƒç´ æ˜¯**æ–°å¢ã€åˆ é™¤æˆ–ç§»åŠ¨**çš„ã€‚
- è‹¥æ²¡æœ‰ `key`ï¼ˆæˆ–ä½¿ç”¨ `index`ï¼‰ï¼ŒReact åªèƒ½æŒ‰**ä½ç½®é¡ºåº**æ¯”è¾ƒï¼Œå¯¼è‡´å¤§é‡ DOM é‡å»ºã€‚
- æœ‰ç¨³å®šå”¯ä¸€çš„ `key`ï¼ŒReact èƒ½**å¤ç”¨å·²æœ‰ DOM èŠ‚ç‚¹å’Œç»„ä»¶å®ä¾‹**ï¼Œä»…æ›´æ–°å¿…è¦éƒ¨åˆ†ã€‚

> ğŸ“Œ ä¸¾ä¾‹ï¼š
> ```jsx
> // âŒ é”™è¯¯ï¼šç”¨ index ä½œ keyï¼ˆåˆ—è¡¨å¯å˜æ—¶ï¼‰
> {items.map((item, index) => <Item key={index} />)}
> 
> // âœ… æ­£ç¡®ï¼šç”¨å”¯ä¸€ ID
> {items.map(item => <Item key={item.id} />)}
> ```

#### 2. **ä¿æŒç»„ä»¶çŠ¶æ€ï¼ˆStateï¼‰æ­£ç¡®**
- è‹¥ `key` ä¸ç¨³å®šï¼ˆå¦‚ç”¨ `Math.random()`ï¼‰ï¼ŒReact ä¼šè®¤ä¸ºè¿™æ˜¯**å…¨æ–°å…ƒç´ **ï¼Œå¯¼è‡´ï¼š
  - ç»„ä»¶è¢«é”€æ¯é‡å»º
  - å†…éƒ¨ stateï¼ˆå¦‚è¾“å…¥æ¡†å†…å®¹ã€è®¡æ•°å™¨ï¼‰ä¸¢å¤±
- ç¨³å®šçš„ `key` èƒ½ç¡®ä¿**ç›¸åŒé€»è¾‘é¡¹å¯¹åº”ç›¸åŒç»„ä»¶å®ä¾‹**ï¼ŒçŠ¶æ€å¾—ä»¥ä¿ç•™ã€‚

---

### âš ï¸ äºŒã€ä½¿ç”¨ `key` çš„æ³¨æ„äº‹é¡¹

| åœºæ™¯                              | å»ºè®®                                   |
| --------------------------------- | -------------------------------------- |
| **åˆ—è¡¨é¡¹æœ‰å”¯ä¸€ ID**               | ä¼˜å…ˆä½¿ç”¨ `item.id`ã€`item.uuid` ç­‰     |
| **é™æ€åˆ—è¡¨ï¼ˆæ°¸ä¸æ”¹å˜é¡ºåº/æ•°é‡ï¼‰** | å¯ç”¨ `index`ï¼ˆä½†ä¸æ¨èï¼‰               |
| **åŠ¨æ€åˆ—è¡¨ï¼ˆå¯æ’åºã€å¢åˆ ï¼‰**      | **ç»å¯¹ä¸è¦ç”¨ `index`**ï¼ä¼šå¯¼è‡´çŠ¶æ€é”™ä¹± |
| **key å¿…é¡»åœ¨åŒä¸€å±‚çº§å”¯ä¸€**        | ä¸éœ€è¦å…¨å±€å”¯ä¸€ï¼Œåªéœ€åœ¨å…„å¼ŸèŠ‚ç‚¹ä¸­å”¯ä¸€   |

> ğŸ’¡ ç¤ºä¾‹ï¼šä¸ºä»€ä¹ˆ `index` åœ¨åŠ¨æ€åˆ—è¡¨ä¸­å‡ºé—®é¢˜ï¼Ÿ
> ```js
> // åˆå§‹: [A, B, C] â†’ keys: [0,1,2]
> // åˆ é™¤ A å: [B, C] â†’ keys å˜ä¸º [0,1]
> // React è®¤ä¸º B(åŸkey=1) å˜æˆäº†æ–° B(key=0)ï¼ŒC åŒç† â†’ çŠ¶æ€é”™ä½ï¼
> ```

---

### ğŸ” ä¸‰ã€`key` çš„å·¥ä½œåŸç†ï¼ˆç®€åŒ–ç‰ˆï¼‰

React åœ¨ reconcilerï¼ˆåè°ƒå™¨ï¼‰ä¸­æ‰§è¡Œä»¥ä¸‹é€»è¾‘ï¼š
1. éå†æ–°æ—§åˆ—è¡¨
2. é€šè¿‡ `key` å»ºç«‹æ˜ å°„å…³ç³»
3. å¯¹æ¯”ï¼š
   - **ç›¸åŒ key** â†’ å¤ç”¨ç»„ä»¶ï¼Œæ›´æ–° props
   - **æ–° key** â†’ åˆ›å»ºæ–°ç»„ä»¶
   - **æ—§ key æ¶ˆå¤±** â†’ å¸è½½ç»„ä»¶
4. æœ€å°åŒ– DOM æ“ä½œ

---

### âœ… å››ã€æœ€ä½³å®è·µ

- **å§‹ç»ˆç»™åˆ—è¡¨é¡¹æ˜¾å¼æŒ‡å®š `key`**
- **ä½¿ç”¨æ•°æ®æœ¬èº«çš„å”¯ä¸€ ID**ï¼ˆå¦‚æ•°æ®åº“ä¸»é”®ï¼‰
- **é¿å…ä½¿ç”¨ `index`ã€`random()`ã€`Date.now()` ç­‰ä¸ç¨³å®šå€¼**
- **ä¸è¦åœ¨ JSX ä¸­è®¡ç®—å¤æ‚ key**ï¼ˆå½±å“æ€§èƒ½ï¼‰

```jsx
// âœ… æ¨è
{users.map(user => (
  <UserCard key={user.id} user={user} />
))}

// âŒ é¿å…
{users.map((user, i) => (
  <UserCard key={i} user={user} /> // è‹¥ users å¯å¢åˆ /æ’åºï¼Œä¼šå‡º bug
))}
```

---

### ğŸ’¡ æ€»ç»“ä¸€å¥è¯ï¼š
> **`key` æ˜¯ React è¯†åˆ«åˆ—è¡¨å…ƒç´ èº«ä»½çš„â€œèº«ä»½è¯å·â€â€”â€”ç¨³å®šä¸”å”¯ä¸€ï¼Œæ‰èƒ½è®©æ›´æ–°é«˜æ•ˆã€çŠ¶æ€å¯é ã€‚**

## React ä¸­ refs çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ

åœ¨ React ä¸­ï¼Œ**`ref`ï¼ˆå¼•ç”¨ï¼‰ç”¨äºç›´æ¥è®¿é—® DOM å…ƒç´ æˆ–ç±»ç»„ä»¶å®ä¾‹**ï¼Œç»•è¿‡ React çš„å£°æ˜å¼æ•°æ®æµï¼Œå®ç°**å‘½ä»¤å¼æ“ä½œ**ã€‚å®ƒæ˜¯ React æä¾›çš„â€œé€ƒç”Ÿèˆ±â€ï¼ˆescape hatchï¼‰ï¼Œç”¨äºå¤„ç†é‚£äº›æ— æ³•é€šè¿‡ `props` å’Œ `state` è§£å†³çš„åœºæ™¯ã€‚

---

### âœ… ä¸€ã€`ref` çš„æ ¸å¿ƒä½œç”¨

#### 1. **è®¿é—® DOM å…ƒç´ **
- è·å–åŸç”Ÿ DOM èŠ‚ç‚¹ï¼Œæ‰§è¡Œå‘½ä»¤å¼æ“ä½œï¼ˆå¦‚èšç„¦ã€æ»šåŠ¨ã€æµ‹é‡å°ºå¯¸ï¼‰ï¼š
  ```jsx
  const inputRef = useRef(null);
  
  useEffect(() => {
    inputRef.current.focus(); // è‡ªåŠ¨èšç„¦
  }, []);

  return <input ref={inputRef} />;
  ```

#### 2. **è®¿é—®ç±»ç»„ä»¶å®ä¾‹**
- è°ƒç”¨å­ç»„ä»¶çš„æ–¹æ³•ï¼ˆå‡½æ•°ç»„ä»¶éœ€é…åˆ `forwardRef` + `useImperativeHandle`ï¼‰ï¼š
  ```jsx
  // å­ç»„ä»¶ï¼ˆç±»ï¼‰
  class Child extends Component {
    scrollDown = () => { /* ... */ }
    render() { return <div>...</div>; }
  }

  // çˆ¶ç»„ä»¶
  const childRef = useRef();
  const handleClick = () => childRef.current.scrollDown();
  return <Child ref={childRef} />;
  ```

#### 3. **ä¿å­˜å¯å˜å€¼ï¼ˆç±»ä¼¼å®ä¾‹å˜é‡ï¼‰**
- åœ¨ç»„ä»¶æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­**æŒä¹…å­˜å‚¨æ•°æ®**ï¼Œä¸”**ä¿®æ”¹å®ƒä¸ä¼šè§¦å‘ re-render**ï¼š
  ```jsx
  const countRef = useRef(0);
  const handleClick = () => {
    countRef.current++; // ä¸ä¼šé‡æ–°æ¸²æŸ“
    console.log(countRef.current);
  };
  ```

---

### âš ï¸ äºŒã€ä½¿ç”¨ `ref` çš„æ³¨æ„äº‹é¡¹

| åœºæ™¯                                 | è¯´æ˜                                             |
| ------------------------------------ | ------------------------------------------------ |
| **å‡½æ•°ç»„ä»¶é»˜è®¤ä¸èƒ½è¢« ref å¼•ç”¨**      | éœ€ç”¨ `forwardRef` åŒ…è£…                           |
| **é¿å…è¿‡åº¦ä½¿ç”¨**                     | ç ´å React å£°æ˜å¼ç†å¿µï¼Œåº”ä¼˜å…ˆç”¨ state/props      |
| **ä¸èƒ½ç”¨äºæ¡ä»¶æ¸²æŸ“çš„å…ƒç´ **           | è‹¥å…ƒç´ å¯èƒ½ä¸º `null`ï¼Œ`ref.current` å¯èƒ½ä¸º `null` |
| **ä¸è¦åœ¨ render ä¸­è¯»å– ref.current** | å¯èƒ½è·å–åˆ°æ—§å€¼ï¼ˆåº”åœ¨ `useEffect` ä¸­è¯»å–ï¼‰        |

---

### ğŸ”§ ä¸‰ã€å¸¸ç”¨ API

#### 1. **`useRef()`ï¼ˆå‡½æ•°ç»„ä»¶ï¼‰**
```js
const ref = useRef(initialValue);
// ref.current å¯è¯»å†™
```

#### 2. **`createRef()`ï¼ˆç±»ç»„ä»¶ï¼‰**
```js
class MyComponent extends Component {
  inputRef = createRef();
  render() {
    return <input ref={this.inputRef} />;
  }
}
```

#### 3. **`forwardRef`ï¼ˆè½¬å‘ ref åˆ°å­ç»„ä»¶ï¼‰**
```jsx
const FancyInput = forwardRef((props, ref) => (
  <input ref={ref} className="fancy" />
));
```

#### 4. **`useImperativeHandle`ï¼ˆè‡ªå®šä¹‰æš´éœ²ç»™çˆ¶ç»„ä»¶çš„æ–¹æ³•ï¼‰**
```jsx
const Child = forwardRef((props, ref) => {
  const inputRef = useRef();
  
  useImperativeHandle(ref, () => ({
    focus: () => inputRef.current.focus(),
    getValue: () => inputRef.current.value
  }));

  return <input ref={inputRef} />;
});
```

---

### ğŸš« å››ã€ä»€ä¹ˆæƒ…å†µä¸‹**ä¸åº”è¯¥**ç”¨ `ref`ï¼Ÿ

- **å¯ä»¥é€šè¿‡ `props` æˆ– `state` å®ç°çš„é€»è¾‘**  
  ï¼ˆä¾‹å¦‚ï¼šæ§åˆ¶æ˜¾ç¤º/éšè— â†’ ç”¨ `state`ï¼›ä¼ é€’æ•°æ® â†’ ç”¨ `props`ï¼‰
- **è¯•å›¾â€œå¼ºåˆ¶æ›´æ–°â€ç»„ä»¶**  
  ï¼ˆåº”æ£€æŸ¥ state/props ä¾èµ–æ˜¯å¦æ­£ç¡®ï¼‰

---

### âœ… äº”ã€å…¸å‹ä½¿ç”¨åœºæ™¯

| åœºæ™¯           | ç¤ºä¾‹                       |
| -------------- | -------------------------- |
| è‡ªåŠ¨èšç„¦è¾“å…¥æ¡† | ç™»å½•é¡µç”¨æˆ·åè¾“å…¥æ¡†         |
| è§¦å‘ç¬¬ä¸‰æ–¹åº“   | åˆå§‹åŒ–åœ°å›¾ã€è§†é¢‘æ’­æ”¾å™¨     |
| æµ‹é‡ DOM å°ºå¯¸  | åŠ¨æ€è®¡ç®—å®¹å™¨é«˜åº¦           |
| ç®¡ç†ç„¦ç‚¹/æ»šåŠ¨  | èŠå¤©çª—å£è‡ªåŠ¨æ»šåˆ°åº•éƒ¨       |
| æš´éœ²å­ç»„ä»¶æ–¹æ³• | çˆ¶ç»„ä»¶è°ƒç”¨å­ç»„ä»¶çš„éªŒè¯æ–¹æ³• |

---

### ğŸ’¡ æ€»ç»“ä¸€å¥è¯ï¼š
> **`ref` æ˜¯ React ä¸­ç”¨äºå‘½ä»¤å¼æ“ä½œçš„å·¥å…·â€”â€”å½“ä½ éœ€è¦â€œç›´æ¥åŠ¨æ‰‹â€è€Œä¸æ˜¯â€œå£°æ˜æ„å›¾â€æ—¶æ‰ä½¿ç”¨å®ƒï¼Œä¸”åº”å°½é‡é™åˆ¶å…¶ä½¿ç”¨èŒƒå›´ã€‚**

## React diff åŸç†

React çš„ **Diff ç®—æ³•**ï¼ˆä¹Ÿç§°ä¸º **Reconciliation åè°ƒç®—æ³•**ï¼‰æ˜¯ React é«˜æ€§èƒ½çš„æ ¸å¿ƒæœºåˆ¶ä¹‹ä¸€ã€‚å®ƒçš„ç›®æ ‡æ˜¯ï¼š**åœ¨çŠ¶æ€æ›´æ–°æ—¶ï¼Œä»¥æœ€å°çš„ä»£ä»·è®¡ç®—å‡ºéœ€è¦å¯¹çœŸå® DOM åšå“ªäº›ä¿®æ”¹**ã€‚

> ğŸ’¡ æ³¨æ„ï¼šReact å¹¶æ²¡æœ‰ä½¿ç”¨ä¼ ç»Ÿçš„â€œå…¨é‡ diffâ€ï¼ˆå¦‚ Gitï¼‰ï¼Œè€Œæ˜¯åŸºäº**ä¸¤ä¸ªæ ¸å¿ƒå‡è®¾**è®¾è®¡äº†ä¸€å¥—**å¯å‘å¼ O(n) ç®—æ³•**ã€‚

---

### ä¸€ã€React Diff çš„ä¸‰å¤§æ ¸å¿ƒç­–ç•¥

#### âœ… 1. **å±‚çº§ä¼˜å…ˆï¼ˆTree Diffï¼‰**
- **åªå¯¹åŒå±‚çº§çš„èŠ‚ç‚¹è¿›è¡Œæ¯”è¾ƒ**ï¼Œå¿½ç•¥è·¨å±‚çº§ç§»åŠ¨ã€‚
- å¦‚æœæŸèŠ‚ç‚¹ç±»å‹ä¸åŒï¼ˆå¦‚ `<div>` â†’ `<span>`ï¼‰ï¼Œ**ç›´æ¥é”€æ¯æ•´æ£µå­æ ‘å¹¶é‡å»º**ã€‚
  ```jsx
  // æ›´æ–°å‰
  <div><span>Hi</span></div>
  // æ›´æ–°å
  <p><span>Hi</span></p>
  // â†’ div è¢«é”€æ¯ï¼Œæ–°å»º p + span
  ```

> ğŸ“Œ **åŸå› **ï¼šè·¨å±‚çº§ç§»åŠ¨åœ¨å®é™…å¼€å‘ä¸­æå°‘å‘ç”Ÿï¼Œæ­¤å‡è®¾å¯å°†å¤æ‚åº¦ä» O(nÂ³) é™è‡³ O(n)ã€‚

---

#### âœ… 2. **ç»„ä»¶ç±»å‹å†³å®šæ˜¯å¦å¤ç”¨ï¼ˆComponent Diffï¼‰**
- å¦‚æœç»„ä»¶ç±»å‹ç›¸åŒï¼ˆå¦‚ `MyButton` â†’ `MyButton`ï¼‰ï¼Œ**å¤ç”¨ç»„ä»¶å®ä¾‹**ï¼Œä»…æ›´æ–° propsã€‚
- å¦‚æœç»„ä»¶ç±»å‹ä¸åŒï¼ˆå¦‚ `MyButton` â†’ `YourButton`ï¼‰ï¼Œ**é”€æ¯æ—§ç»„ä»¶åŠå…¶å­æ ‘ï¼Œåˆ›å»ºæ–°ç»„ä»¶**ã€‚

> ğŸ’¡ è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ**è‡ªå®šä¹‰ç»„ä»¶é¦–å­—æ¯å¿…é¡»å¤§å†™**â€”â€”é¿å…ä¸ HTML æ ‡ç­¾æ··æ·†å¯¼è‡´æ„å¤–é‡å»ºã€‚

---

#### âœ… 3. **åˆ—è¡¨é€šè¿‡ key ä¼˜åŒ–ï¼ˆElement Diffï¼‰**
- å¯¹äºå…„å¼ŸèŠ‚ç‚¹åˆ—è¡¨ï¼ŒReact é»˜è®¤æŒ‰**é¡ºåºé€ä¸ªå¯¹æ¯”**ã€‚
- è‹¥æœªæä¾› `key`ï¼Œæ’å…¥/åˆ é™¤ä¸­é—´é¡¹ä¼šå¯¼è‡´åç»­æ‰€æœ‰èŠ‚ç‚¹è¢«é‡å»ºã€‚
- **æä¾›å”¯ä¸€ç¨³å®šçš„ `key` å**ï¼ŒReact èƒ½ï¼š
  - è¯†åˆ«å“ªäº›å…ƒç´ æ˜¯æ–°å¢ã€åˆ é™¤æˆ–ç§»åŠ¨çš„
  - **å¤ç”¨å·²æœ‰ DOM èŠ‚ç‚¹å’Œç»„ä»¶å®ä¾‹**
  - ä¿æŒå†…éƒ¨çŠ¶æ€ï¼ˆå¦‚è¾“å…¥æ¡†å†…å®¹ï¼‰

```jsx
// âŒ æ—  keyï¼šåˆ—è¡¨å˜åŒ–æ—¶å…¨éƒ¨é‡å»º
{items.map(item => <li>{item}</li>)}

// âœ… æœ‰ keyï¼šç²¾å‡†å¤ç”¨
{items.map(item => <li key={item.id}>{item.text}</li>)}
```

---

### äºŒã€Diff è¿‡ç¨‹è¯¦è§£ï¼ˆFiber æ¶æ„ä¸‹ï¼‰

React 16+ ä½¿ç”¨ **Fiber Reconciler**ï¼Œå°† Diff è¿‡ç¨‹æ‹†åˆ†ä¸ºå¯ä¸­æ–­çš„å•å…ƒï¼š

1. **ç”Ÿæˆ Fiber æ ‘**  
   - æ¯ä¸ªç»„ä»¶/å…ƒç´ å¯¹åº”ä¸€ä¸ª Fiber èŠ‚ç‚¹
   - å½¢æˆé“¾è¡¨ç»“æ„ï¼ˆchild/sibling/return æŒ‡é’ˆï¼‰ï¼Œæ›¿ä»£é€’å½’

2. **åŒç¼“å†²æœºåˆ¶ï¼ˆDouble Bufferingï¼‰**  
   - ç»´æŠ¤ä¸¤æ£µæ ‘ï¼š`current`ï¼ˆå·²æ¸²æŸ“ï¼‰å’Œ `workInProgress`ï¼ˆæ­£åœ¨æ„å»ºï¼‰
   - æ›´æ–°åœ¨ `workInProgress` ä¸Šè¿›è¡Œï¼Œå®ŒæˆååŸå­åˆ‡æ¢

3. **å¯ä¸­æ–­ & ä¼˜å…ˆçº§è°ƒåº¦**  
   - æ¯å¤„ç†ä¸€ä¸ª Fiber èŠ‚ç‚¹ï¼Œæ£€æŸ¥æ˜¯å¦éœ€è®©å‡ºä¸»çº¿ç¨‹
   - é«˜ä¼˜å…ˆçº§æ›´æ–°ï¼ˆå¦‚ç”¨æˆ·è¾“å…¥ï¼‰å¯æ‰“æ–­ä½ä¼˜å…ˆçº§æ›´æ–°

---

### ä¸‰ã€å…³é”®ä¼˜åŒ–ç‚¹æ€»ç»“

| é—®é¢˜           | React çš„è§£å†³æ–¹æ¡ˆ              |
| -------------- | ----------------------------- |
| å…¨é‡ diff å¤ªæ…¢ | **åª diff åŒå±‚çº§**            |
| ç»„ä»¶çŠ¶æ€ä¸¢å¤±   | **ç±»å‹ç›¸åŒåˆ™å¤ç”¨å®ä¾‹**        |
| åˆ—è¡¨æ›´æ–°ä½æ•ˆ   | **ä¾èµ– `key` ç²¾å‡†åŒ¹é…**       |
| é•¿ä»»åŠ¡é˜»å¡ UI  | **Fiber å¯ä¸­æ–­ + ä¼˜å…ˆçº§è°ƒåº¦** |

---

### âš ï¸ å¼€å‘è€…æ³¨æ„äº‹é¡¹

1. **æ°¸è¿œä¸ºåˆ—è¡¨æä¾›ç¨³å®šå”¯ä¸€çš„ `key`**ï¼ˆä¸ç”¨ indexï¼ï¼‰
2. **é¿å…ä¸å¿…è¦çš„ç»„ä»¶ç±»å‹å˜åŒ–**ï¼ˆå¦‚æ¡ä»¶æ¸²æŸ“ç”¨ CSS è€Œéåˆ‡æ¢ç»„ä»¶ï¼‰
3. **ä¸è¦ä¾èµ– Diff è¡Œä¸ºåšå‰¯ä½œç”¨**ï¼ˆå¦‚æ‰‹åŠ¨æ“ä½œ DOMï¼‰

---

### ğŸ’¡ ä¸€å¥è¯æ€»ç»“ï¼š
> React Diff ä¸æ˜¯â€œå®Œç¾ç®—æ³•â€ï¼Œè€Œæ˜¯**åŸºäºåˆç†å‡è®¾çš„é«˜æ•ˆå¯å‘å¼ç­–ç•¥**â€”â€”é€šè¿‡**å±‚çº§é™åˆ¶ + ç±»å‹å¤ç”¨ + key ä¼˜åŒ–**ï¼Œåœ¨ O(n) æ—¶é—´å†…å®Œæˆæ›´æ–°ï¼Œå…¼é¡¾æ€§èƒ½ä¸å¼€å‘ä½“éªŒã€‚

## å—æ§ç»„ä»¶å’Œéå—æ§ç»„ä»¶æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

åœ¨ React ä¸­ï¼Œ**å—æ§ç»„ä»¶ï¼ˆControlled Componentï¼‰** å’Œ **éå—æ§ç»„ä»¶ï¼ˆUncontrolled Componentï¼‰** æ˜¯å¤„ç†è¡¨å•è¾“å…¥ï¼ˆå¦‚ `<input>`ã€`<textarea>`ã€`<select>`ï¼‰çš„ä¸¤ç§ä¸åŒæ¨¡å¼ï¼Œæ ¸å¿ƒåŒºåˆ«åœ¨äºï¼š**è°â€œæŒæ§â€è¡¨å•å…ƒç´ çš„å€¼**ã€‚

---

### âœ… ä¸€ã€å—æ§ç»„ä»¶ï¼ˆControlled Componentï¼‰

#### ğŸ”¹ å®šä¹‰ï¼š
- è¡¨å•å…ƒç´ çš„ **å€¼ç”± React çš„ state æ§åˆ¶**
- æ¯æ¬¡ç”¨æˆ·è¾“å…¥ï¼Œéƒ½é€šè¿‡ `onChange` æ›´æ–° stateï¼Œä»è€Œé©±åŠ¨ UI

#### ğŸ”¹ ç‰¹ç‚¹ï¼š
- **å€¼ = state**
- **å˜æ›´ = setState**
- **å®Œå…¨å— React ç®¡ç†**

#### ğŸ”¹ ç¤ºä¾‹ï¼š
```jsx
function ControlledInput() {
  const [value, setValue] = useState('');

  return (
    <input
      value={value}          // å€¼æ¥è‡ª state
      onChange={e => setValue(e.target.value)} // å—æ§æ›´æ–°
    />
  );
}
```

#### ğŸ”¹ ä¼˜ç‚¹ï¼š
- **çŠ¶æ€é›†ä¸­ç®¡ç†**ï¼Œä¾¿äºæ ¡éªŒã€æ ¼å¼åŒ–ã€åŒæ­¥
- æ”¯æŒ**å³æ—¶åé¦ˆ**ï¼ˆå¦‚è¾“å…¥æ—¶å®æ—¶æœç´¢ï¼‰
- ç¬¦åˆ React **å•å‘æ•°æ®æµ**ç†å¿µ

#### ğŸ”¹ ç¼ºç‚¹ï¼š
- ä»£ç ç¨å¤šï¼ˆéœ€å†™ `onChange` å¤„ç†å™¨ï¼‰

---

### âœ… äºŒã€éå—æ§ç»„ä»¶ï¼ˆUncontrolled Componentï¼‰

#### ğŸ”¹ å®šä¹‰ï¼š
- è¡¨å•å…ƒç´ çš„ **å€¼ç”± DOM è‡ªèº«ç®¡ç†**
- React é€šè¿‡ `ref` åœ¨éœ€è¦æ—¶è¯»å–å½“å‰å€¼

#### ğŸ”¹ ç‰¹ç‚¹ï¼š
- **å€¼ = DOM å…ƒç´ çš„ value å±æ€§**
- **å˜æ›´ = ç”¨æˆ·ç›´æ¥æ“ä½œ DOM**
- React **ä¸ç›‘å¬æ¯æ¬¡å˜åŒ–**

#### ğŸ”¹ ç¤ºä¾‹ï¼š
```jsx
function UncontrolledInput() {
  const inputRef = useRef();

  const handleSubmit = () => {
    console.log(inputRef.current.value); // æäº¤æ—¶è¯»å–å€¼
  };

  return (
    <input
      ref={inputRef}
      defaultValue="åˆå§‹å€¼" // æ³¨æ„ï¼šç”¨ defaultValue è€Œé value
    />
  );
}
```

#### ğŸ”¹ ä¼˜ç‚¹ï¼š
- ä»£ç ç®€æ´ï¼ˆæ— éœ€ `onChange`ï¼‰
- é€‚åˆ**ä¸€æ¬¡æ€§è¯»å–**ï¼ˆå¦‚ç™»å½•è¡¨å•æäº¤ï¼‰

#### ğŸ”¹ ç¼ºç‚¹ï¼š
- æ— æ³•å®æ—¶å“åº”è¾“å…¥å˜åŒ–
- éš¾ä»¥å®ç°å¤æ‚äº¤äº’ï¼ˆå¦‚è¾“å…¥æ ¼å¼åŒ–ã€è”åŠ¨æ ¡éªŒï¼‰

---

### ğŸ†š ä¸‰ã€æ ¸å¿ƒåŒºåˆ«å¯¹æ¯”è¡¨

| ç‰¹æ€§                    | å—æ§ç»„ä»¶                | éå—æ§ç»„ä»¶                        |
| ----------------------- | ----------------------- | --------------------------------- |
| **å€¼çš„æ¥æº**            | React state             | DOM è‡ªèº«                          |
| **æ›´æ–°æ–¹å¼**            | `onChange` + `setState` | ç”¨æˆ·ç›´æ¥è¾“å…¥                      |
| **è·å–å€¼æ—¶æœº**          | å®æ—¶ï¼ˆstate å³æœ€æ–°å€¼ï¼‰  | éœ€é€šè¿‡ `ref` ä¸»åŠ¨è¯»å–             |
| **åˆå§‹å€¼å±æ€§**          | `value`                 | `defaultValue` / `defaultChecked` |
| **é€‚ç”¨åœºæ™¯**            | éœ€è¦å®æ—¶æ§åˆ¶/æ ¡éªŒçš„è¡¨å• | ç®€å•è¡¨å•ã€é›†æˆç¬¬ä¸‰æ–¹åº“            |
| **æ˜¯å¦ç¬¦åˆ React å“²å­¦** | âœ… æ˜¯                    | âš ï¸ â€œé€ƒç”Ÿèˆ±â€ï¼ˆescape hatchï¼‰        |

---

### âš ï¸ å››ã€å¸¸è§è¯¯åŒº

1. **æ··æ·† `value` å’Œ `defaultValue`**  
   - å—æ§ï¼šå¿…é¡»ç”¨ `value`
   - éå—æ§ï¼šç”¨ `defaultValue`ï¼ˆå¦åˆ™ä¼šå˜æˆåªè¯»ï¼‰

2. **åœ¨éå—æ§ç»„ä»¶ä¸­ä½¿ç”¨ `value`**  
   ```jsx
   // âŒ é”™è¯¯ï¼švalue å›ºå®šä¸º "hello"ï¼Œè¾“å…¥æ— æ•ˆï¼
   <input value="hello" />
   ```

3. **æ··åˆä½¿ç”¨**  
   - åŒä¸€ä¸ªè¡¨å•å­—æ®µä¸è¦åŒæ—¶ç”¨ `value` + `ref` æ§åˆ¶

---

### âœ… äº”ã€å¦‚ä½•é€‰æ‹©ï¼Ÿ

| åœºæ™¯                           | æ¨èæ–¹å¼                     |
| ------------------------------ | ---------------------------- |
| è¡¨å•éœ€å®æ—¶æ ¡éªŒ/æ ¼å¼åŒ–          | **å—æ§ç»„ä»¶**                 |
| ç®€å•ç™»å½•/æ³¨å†Œè¡¨å•              | éå—æ§ï¼ˆæˆ–å—æ§å‡å¯ï¼‰         |
| é›†æˆ jQuery æ’ä»¶ç­‰ç¬¬ä¸‰æ–¹åº“     | **éå—æ§ç»„ä»¶**ï¼ˆé¿å…å†²çªï¼‰   |
| æ–‡ä»¶ä¸Šä¼  `<input type="file">` | **å¿…é¡»éå—æ§**ï¼ˆvalue åªè¯»ï¼‰ |

---

### ğŸ’¡ æ€»ç»“ä¸€å¥è¯ï¼š
> **å—æ§ç»„ä»¶ = React ä¸»å¯¼ä¸€åˆ‡ï¼›éå—æ§ç»„ä»¶ = DOM è‡ªä¸»ç®¡ç†ï¼ŒReact æŒ‰éœ€è¯»å–ã€‚ä¼˜å…ˆä½¿ç”¨å—æ§ç»„ä»¶ï¼Œéå—æ§ä»…ä½œè¡¥å……ã€‚**

## ä¸ºä»€ä¹ˆè™šæ‹Ÿ dom ä¼šæé«˜æ€§èƒ½?

è™šæ‹Ÿ DOMï¼ˆVirtual DOMï¼‰ä¹‹æ‰€ä»¥èƒ½æé«˜æ€§èƒ½ï¼Œ**æ ¸å¿ƒåŸå› ä¸æ˜¯å®ƒæœ¬èº«â€œå¿«â€ï¼Œè€Œæ˜¯å®ƒé€šè¿‡â€œæ‰¹é‡ã€æœ€å°åŒ–ã€å¯ä¼˜åŒ–â€çš„æ–¹å¼å‡å°‘æ˜‚è´µçš„çœŸå® DOM æ“ä½œ**ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†è§£æï¼š

---

### ä¸€ã€çœŸå® DOM æ“ä½œä¸ºä»€ä¹ˆæ…¢ï¼Ÿ

1. **æµè§ˆå™¨æ¸²æŸ“æµç¨‹å¤æ‚**  
   ä¿®æ”¹çœŸå® DOM ä¼šè§¦å‘ï¼š
   - **Reflowï¼ˆå›æµï¼‰**ï¼šé‡æ–°è®¡ç®—å…ƒç´ å‡ ä½•ä½ç½®ï¼ˆå¦‚å®½é«˜ã€å¸ƒå±€ï¼‰
   - **Repaintï¼ˆé‡ç»˜ï¼‰**ï¼šé‡æ–°ç»˜åˆ¶åƒç´ ï¼ˆå¦‚é¢œè‰²ã€èƒŒæ™¯ï¼‰
   > âš ï¸ è¿™ä¸¤ä¸ªè¿‡ç¨‹éå¸¸è€—æ—¶ï¼Œå°¤å…¶åœ¨å¤æ‚é¡µé¢ä¸­ã€‚

2. **é¢‘ç¹æ“ä½œå¯¼è‡´æ€§èƒ½ç“¶é¢ˆ**  
   è‹¥ç›´æ¥æ“ä½œ DOMï¼ˆå¦‚å¾ªç¯ä¸­å¤šæ¬¡ `appendChild`ï¼‰ï¼Œæµè§ˆå™¨ä¼šåå¤è§¦å‘ Reflow/Repaintã€‚

---

### äºŒã€è™šæ‹Ÿ DOM å¦‚ä½•ä¼˜åŒ–ï¼Ÿ

#### âœ… 1. **æ‰¹é‡æ›´æ–°ï¼ˆBatchingï¼‰**
- React å°†å¤šæ¬¡ `setState` åˆå¹¶ä¸º**ä¸€æ¬¡æ›´æ–°**ï¼Œé¿å…é‡å¤æ¸²æŸ“ã€‚
- è™šæ‹Ÿ DOM å…ˆåœ¨å†…å­˜ä¸­å®Œæˆæ‰€æœ‰å˜æ›´ï¼Œ**æœ€åä¸€æ¬¡æ€§åŒæ­¥åˆ°çœŸå® DOM**ã€‚

#### âœ… 2. **Diff ç®—æ³•ï¼ˆåè°ƒç®—æ³•ï¼‰**
- é€šè¿‡é«˜æ•ˆçš„ **O(n) å¯å‘å¼ Diff**ï¼ˆåŸºäºå±‚çº§ã€ç»„ä»¶ç±»å‹ã€keyï¼‰ï¼Œ**ç²¾å‡†æ‰¾å‡ºæœ€å°å˜æ›´é›†**ã€‚
- åªæ›´æ–°**çœŸæ­£å˜åŒ–çš„èŠ‚ç‚¹**ï¼Œé¿å…å…¨é‡æ›¿æ¢ã€‚

> ğŸ“Œ å¯¹æ¯”ï¼š  
> ç›´æ¥æ“ä½œ DOM â†’ æ¯æ¬¡ä¿®æ”¹éƒ½è§¦å‘å¸ƒå±€è®¡ç®—  
> è™šæ‹Ÿ DOM â†’ å†…å­˜ä¸­è®¡ç®—å·®å¼‚ â†’ ä»…æäº¤å¿…è¦ä¿®æ”¹

#### âœ… 3. **è·¨å¹³å°æŠ½è±¡**
- è™šæ‹Ÿ DOM æ˜¯**çº¯ JavaScript å¯¹è±¡**ï¼Œä¸å¹³å°æ— å…³ã€‚
- åŒä¸€å¥— diff é€»è¾‘å¯ç”¨äº Webï¼ˆReactDOMï¼‰ã€ç§»åŠ¨ç«¯ï¼ˆReact Nativeï¼‰ã€ç”šè‡³ VRã€‚

#### âœ… 4. **å¼€å‘ä½“éªŒä¸æ€§èƒ½å¹³è¡¡**
- å¼€å‘è€…åªéœ€å£°æ˜â€œUI åº”è¯¥æ˜¯ä»€ä¹ˆæ ·å­â€ï¼ˆå£°æ˜å¼ï¼‰ï¼Œæ— éœ€æ‰‹åŠ¨ä¼˜åŒ– DOM æ“ä½œã€‚
- React åœ¨åº•å±‚è‡ªåŠ¨å¤„ç†æ€§èƒ½é—®é¢˜ã€‚

---

### ä¸‰ã€è™šæ‹Ÿ DOM å¹¶éæ€»æ˜¯æ›´å¿«ï¼

| åœºæ™¯                       | è™šæ‹Ÿ DOM               | ç›´æ¥æ“ä½œ DOM     |
| -------------------------- | ---------------------- | ---------------- |
| **ç®€å•é™æ€é¡µé¢**           | âŒ æœ‰é¢å¤–å†…å­˜å’Œè®¡ç®—å¼€é”€ | âœ… æ›´å¿«           |
| **é«˜é¢‘åŠ¨æ€æ›´æ–°**           | âœ… æ‰¹é‡ + Diff ä¼˜åŠ¿æ˜æ˜¾ | âŒ æ˜“å†™å‡ºä½æ•ˆä»£ç  |
| **æè‡´æ€§èƒ½åœºæ™¯**ï¼ˆå¦‚æ¸¸æˆï¼‰ | âš ï¸ å¯èƒ½æˆä¸ºç“¶é¢ˆ         | âœ… æ‰‹åŠ¨ä¼˜åŒ–æ›´é«˜æ•ˆ |

> ğŸ’¡ **å…³é”®ç»“è®º**ï¼š  
> è™šæ‹Ÿ DOM çš„ä»·å€¼ä¸åœ¨äºâ€œç»å¯¹é€Ÿåº¦â€ï¼Œè€Œåœ¨äº **â€œä»¥åˆç†çš„æ€§èƒ½ä»£ä»·ï¼Œæ¢å–å¼€å‘æ•ˆç‡å’Œå¯ç»´æŠ¤æ€§â€**ã€‚

---

### å››ã€ç°ä»£ä¼˜åŒ–ï¼šFiber æ¶æ„è¿›ä¸€æ­¥æå‡

React 16+ çš„ **Fiber Reconciler** è®©è™šæ‹Ÿ DOM æ›´æ™ºèƒ½ï¼š
- **å¯ä¸­æ–­æ¸²æŸ“**ï¼šé«˜ä¼˜å…ˆçº§ä»»åŠ¡ï¼ˆå¦‚ç”¨æˆ·è¾“å…¥ï¼‰å¯æ‰“æ–­ä½ä¼˜å…ˆçº§æ›´æ–°
- **å¢é‡æ›´æ–°**ï¼šå°† Diff æ‹†åˆ†ä¸ºå°ä»»åŠ¡ï¼Œé¿å…ä¸»çº¿ç¨‹é•¿æ—¶é—´é˜»å¡

---

### âœ… æ€»ç»“ä¸€å¥è¯ï¼š
> **è™šæ‹Ÿ DOM é€šè¿‡â€œå†…å­˜ä¸­è®¡ç®—å·®å¼‚ + æ‰¹é‡æœ€å°åŒ–æ›´æ–°â€ï¼Œé¿å…äº†å¼€å‘è€…æ‰‹åŠ¨ä¼˜åŒ– DOM çš„å¤æ‚æ€§ï¼Œåœ¨å¤§å¤šæ•°åº”ç”¨ä¸­å®ç°äº†æ€§èƒ½ä¸å¼€å‘æ•ˆç‡çš„æœ€ä½³å¹³è¡¡ã€‚**
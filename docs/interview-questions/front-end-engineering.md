# å‰ç«¯å·¥ç¨‹åŒ–

## webpack é…ç½®æœ‰å“ªäº›?

Webpack æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å‰ç«¯æ¨¡å—æ‰“åŒ…å·¥å…·ï¼Œå…¶æ ¸å¿ƒèƒ½åŠ›é€šè¿‡ **é…ç½®æ–‡ä»¶ `webpack.config.js`** è¿›è¡Œå®šåˆ¶ã€‚ä»¥ä¸‹æ˜¯ **å¸¸ç”¨ä¸”å…³é”®çš„ Webpack é…ç½®é¡¹è¯¦è§£**ï¼ˆåŸºäº Webpack 5ï¼‰ï¼š

---

### ä¸€ã€åŸºç¡€ç»“æ„
```js
// webpack.config.js
module.exports = {
  mode: 'development', // 'production' | 'none'
  entry: './src/index.js',
  output: { /* ... */ },
  module: { /* ... */ },
  plugins: [ /* ... */ ],
  resolve: { /* ... */ },
  devServer: { /* ... */ },
  optimization: { /* ... */ }
};
```

---

### äºŒã€æ ¸å¿ƒé…ç½®é¡¹è¯¦è§£

#### 1. **`mode`ï¼ˆæ¨¡å¼ï¼‰**
- **ä½œç”¨**ï¼šè®¾ç½®æ‰“åŒ…ç¯å¢ƒï¼Œè‡ªåŠ¨å¯ç”¨å†…ç½®ä¼˜åŒ–ã€‚
- **é€‰é¡¹**ï¼š
  - `'development'`ï¼šå¯ç”¨ `NamedChunksPlugin`ã€`EvalSourceMapDevToolPlugin`ï¼ˆå¿«é€Ÿæ„å»º + source mapï¼‰
  - `'production'`ï¼šå¯ç”¨ä»£ç å‹ç¼©ã€ä½œç”¨åŸŸæå‡ã€Tree Shaking ç­‰
- **å»ºè®®**ï¼šå§‹ç»ˆæ˜¾å¼æŒ‡å®šã€‚

#### 2. **`entry`ï¼ˆå…¥å£ï¼‰**
- **ä½œç”¨**ï¼šæŒ‡å®šæ‰“åŒ…èµ·ç‚¹ã€‚
- **ç”¨æ³•**ï¼š
  ```js
  entry: './src/index.js', // å•å…¥å£
  entry: {
    app: './src/app.js',
    vendor: './src/vendor.js' // å¤šå…¥å£ï¼ˆç”¨äºä»£ç åˆ†å‰²ï¼‰
  }
  ```

#### 3. **`output`ï¼ˆè¾“å‡ºï¼‰**
- **ä½œç”¨**ï¼šé…ç½®æ‰“åŒ…ç»“æœã€‚
- **å…³é”®å±æ€§**ï¼š
  ```js
  output: {
    path: path.resolve(__dirname, 'dist'), // è¾“å‡ºç›®å½•
    filename: '[name].[contenthash].js',   // æ–‡ä»¶åï¼ˆ[name]=å…¥å£åï¼Œ[contenthash]=å†…å®¹å“ˆå¸Œï¼‰
    publicPath: '/',                       // èµ„æºå¼•ç”¨å‰ç¼€ï¼ˆCDN åœºæ™¯ï¼‰
    clean: true                            // æ„å»ºå‰æ¸…ç©º output ç›®å½•ï¼ˆWebpack 5+ï¼‰
  }
  ```

#### 4. **`module.rules`ï¼ˆæ¨¡å—è§„åˆ™ï¼‰**
- **ä½œç”¨**ï¼šå®šä¹‰å¦‚ä½•å¤„ç†ä¸åŒç±»å‹çš„æ¨¡å—ï¼ˆå¦‚ JSã€CSSã€å›¾ç‰‡ï¼‰ã€‚
- **æ ¸å¿ƒæ¦‚å¿µ**ï¼š**Loader**ï¼ˆè½¬æ¢å™¨ï¼‰
- **å¸¸ç”¨è§„åˆ™**ï¼š
  ```js
  module: {
    rules: [
      // å¤„ç† JS/JSXï¼ˆBabelï¼‰
      {
        test: /\.jsx?$/,
        exclude: /node_modules/,
        use: {
          loader: 'babel-loader',
          options: { presets: ['@babel/preset-env'] }
        }
      },
      // å¤„ç† CSS
      {
        test: /\.css$/,
        use: ['style-loader', 'css-loader', 'postcss-loader']
      },
      // å¤„ç†å›¾ç‰‡/å­—ä½“
      {
        test: /\.(png|jpg|gif|woff2)$/,
        type: 'asset', // Webpack 5 å†…ç½®èµ„æºæ¨¡å—
        parser: {
          dataUrlCondition: { maxSize: 8 * 1024 } // å°äº 8KB è½¬ base64
        },
        generator: {
          filename: 'assets/[name].[hash][ext]'
        }
      }
    ]
  }
  ```

#### 5. **`plugins`ï¼ˆæ’ä»¶ï¼‰**
- **ä½œç”¨**ï¼šæ‰§è¡ŒèŒƒå›´æ›´å¹¿çš„ä»»åŠ¡ï¼ˆå¦‚ä¼˜åŒ–ã€å‹ç¼©ã€æ³¨å…¥å˜é‡ï¼‰ã€‚
- **å¸¸ç”¨æ’ä»¶**ï¼š
  ```js
  const HtmlWebpackPlugin = require('html-webpack-plugin');
  const MiniCssExtractPlugin = require('mini-css-extract-plugin');
  const DefinePlugin = require('webpack').DefinePlugin;

  plugins: [
    // è‡ªåŠ¨ç”Ÿæˆ HTML å¹¶æ³¨å…¥ bundle
    new HtmlWebpackPlugin({ template: './public/index.html' }),
    
    // æå– CSS åˆ°å•ç‹¬æ–‡ä»¶
    new MiniCssExtractPlugin({ filename: '[name].[contenthash].css' }),
    
    // å®šä¹‰å…¨å±€å¸¸é‡ï¼ˆå¦‚ process.env.NODE_ENVï¼‰
    new DefinePlugin({
      'process.env.API_URL': JSON.stringify('https://api.example.com')
    })
  ]
  ```

#### 6. **`resolve`ï¼ˆè§£æï¼‰**
- **ä½œç”¨**ï¼šé…ç½®æ¨¡å—è§£æè§„åˆ™ã€‚
- **å¸¸ç”¨é…ç½®**ï¼š
  ```js
  resolve: {
    extensions: ['.js', '.jsx', '.json'], // å¯¼å…¥æ—¶çœç•¥åç¼€
    alias: {
      '@': path.resolve(__dirname, 'src'), // è·¯å¾„åˆ«å
      'react': 'preact/compat' // æ›¿æ¢ä¾èµ–ï¼ˆPreact ä»£æ›¿ Reactï¼‰
    },
    modules: ['node_modules', 'src'] // æ¨¡å—æŸ¥æ‰¾ç›®å½•
  }
  ```

#### 7. **`devServer`ï¼ˆå¼€å‘æœåŠ¡å™¨ï¼‰**
- **ä½œç”¨**ï¼šæœ¬åœ°å¼€å‘æœåŠ¡ï¼ˆä»…å¼€å‘ç¯å¢ƒæœ‰æ•ˆï¼‰ã€‚
- **å…³é”®é…ç½®**ï¼š
  ```js
  devServer: {
    static: './public',       // é™æ€èµ„æºç›®å½•
    hot: true,                // æ¨¡å—çƒ­æ›¿æ¢ï¼ˆHMRï¼‰
    open: true,               // å¯åŠ¨åè‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨
    port: 3000,
    proxy: {                  // ä»£ç† API è¯·æ±‚
      '/api': 'http://localhost:8080'
    }
  }
  ```

#### 8. **`optimization`ï¼ˆä¼˜åŒ–ï¼‰**
- **ä½œç”¨**ï¼šç”Ÿäº§ç¯å¢ƒæ€§èƒ½ä¼˜åŒ–ã€‚
- **å…³é”®é…ç½®**ï¼š
  ```js
  optimization: {
    splitChunks: {
      chunks: 'all', // ä»£ç åˆ†å‰²ï¼ˆæå–å…¬å…±ä»£ç ï¼‰
      cacheGroups: {
        vendor: {
          test: /[\\/]node_modules[\\/]/,
          name: 'vendors',
          chunks: 'all'
        }
      }
    },
    minimize: true, // æ˜¯å¦å‹ç¼©ï¼ˆproduction æ¨¡å¼é»˜è®¤ trueï¼‰
    minimizer: [new CssMinimizerPlugin(), '...'] // è‡ªå®šä¹‰å‹ç¼©å™¨
  }
  ```

---

### ä¸‰ã€ç¯å¢ƒåŒºåˆ†é…ç½®
é¿å…åœ¨å•ä¸ªé…ç½®æ–‡ä»¶ä¸­æ··æ‚å¼€å‘/ç”Ÿäº§é€»è¾‘ï¼š
```js
// webpack.config.js
module.exports = (env, argv) => {
  const isProd = argv.mode === 'production';
  
  return {
    mode: argv.mode,
    devtool: isProd ? 'source-map' : 'eval-cheap-module-source-map',
    plugins: [
      new HtmlWebpackPlugin({
        template: './public/index.html',
        minify: isProd // ç”Ÿäº§ç¯å¢ƒå‹ç¼© HTML
      })
    ]
  };
};
```

> âœ… **æ›´ä½³å®è·µ**ï¼šä½¿ç”¨ `webpack-merge` æ‹†åˆ†é…ç½®æ–‡ä»¶ï¼š
> ```
> config/
>   â”œâ”€â”€ webpack.common.js
>   â”œâ”€â”€ webpack.dev.js
>   â””â”€â”€ webpack.prod.js
> ```

---

### å››ã€å¸¸ç”¨ Loader & Plugin é€ŸæŸ¥è¡¨

| ç±»å‹     | åç§°                                                         | ç”¨é€”                      |
| -------- | ------------------------------------------------------------ | ------------------------- |
| **JS**   | `babel-loader`                                               | è½¬è¯‘ ES6+ / JSX           |
| **CSS**  | `css-loader` + `MiniCssExtractPlugin`                        | å¤„ç† CSS æ¨¡å—åŒ– & æå–    |
| **èµ„æº** | `file-loader` / `url-loader`ï¼ˆWebpack 5 ç”¨ `asset modules`ï¼‰ | å¤„ç†å›¾ç‰‡/å­—ä½“             |
| **HTML** | `html-webpack-plugin`                                        | ç”Ÿæˆ HTML æ¨¡æ¿            |
| **ä¼˜åŒ–** | `terser-webpack-plugin`                                      | JS å‹ç¼©ï¼ˆWebpack 5 å†…ç½®ï¼‰ |
| **åˆ†æ** | `webpack-bundle-analyzer`                                    | å¯è§†åŒ– bundle ä½“ç§¯        |

---

### äº”ã€ä¸€å¥è¯æ€»ç»“
> **Webpack é…ç½® = å…¥å£ â†’ åŠ è½½å™¨ï¼ˆLoaderï¼‰å¤„ç†æ¨¡å— â†’ æ’ä»¶ï¼ˆPluginï¼‰å¢å¼ºåŠŸèƒ½ â†’ è¾“å‡ºä¼˜åŒ–ç»“æœ**ã€‚  
> æŒæ¡ `module.rules`ã€`plugins`ã€`optimization.splitChunks` ä¸‰å¤§æ ¸å¿ƒï¼Œå³å¯åº”å¯¹ 90% åœºæ™¯ã€‚

## æœ‰å“ªäº›å¸¸è§çš„ Loader å’Œ Pluginï¼Ÿ

åœ¨ Webpack ç”Ÿæ€ä¸­ï¼Œ**Loader** ç”¨äº**è½¬æ¢æ¨¡å—å†…å®¹**ï¼ˆå¦‚å°† TypeScript ç¼–è¯‘ä¸º JavaScriptï¼‰ï¼Œ**Plugin** ç”¨äº**æ‰©å±•æ„å»ºæµç¨‹èƒ½åŠ›**ï¼ˆå¦‚å‹ç¼©ä»£ç ã€ç”Ÿæˆ HTMLï¼‰ã€‚ä»¥ä¸‹æ˜¯ **æœ€å¸¸ç”¨ä¸”å®ç”¨çš„ Loader å’Œ Plugin åˆ—è¡¨**ï¼ˆåŸºäº Webpack 5ï¼‰ï¼š

---

### ä¸€ã€å¸¸è§ Loaderï¼ˆæŒ‰åŠŸèƒ½åˆ†ç±»ï¼‰

#### âœ… **JavaScript / TypeScript**
| Loader         | ä½œç”¨                                               | å®‰è£…å‘½ä»¤                                  |
| -------------- | -------------------------------------------------- | ----------------------------------------- |
| `babel-loader` | è½¬è¯‘ ES6+/JSX/TypeScriptï¼ˆéœ€é…åˆ Babel é…ç½®ï¼‰      | `npm install -D babel-loader @babel/core` |
| `ts-loader`    | ç›´æ¥ç¼–è¯‘ TypeScriptï¼ˆæ¯” Babel æ›´å®Œæ•´æ”¯æŒ TS ç±»å‹ï¼‰ | `npm install -D ts-loader typescript`     |

> ğŸ’¡ æ¨èï¼šç”¨ `babel-loader` + `@babel/preset-typescript` å¤„ç† TSï¼ˆæ›´å¿«ï¼Œé€‚åˆ React é¡¹ç›®ï¼‰ã€‚

---

#### âœ… **CSS / é¢„å¤„ç†å™¨**
| Loader                        | ä½œç”¨                                      | è¯´æ˜                             |
| ----------------------------- | ----------------------------------------- | -------------------------------- |
| `css-loader`                  | è§£æ CSS ä¸­çš„ `@import` å’Œ `url()`        | å¿…é¡»é…åˆå…¶ä»– loader ä½¿ç”¨         |
| `style-loader`                | å°† CSS æ³¨å…¥ `<style>` æ ‡ç­¾ï¼ˆå¼€å‘ç¯å¢ƒï¼‰    | ä¸é€‚åˆç”Ÿäº§ç¯å¢ƒ                   |
| `MiniCssExtractPlugin.loader` | **æå– CSS ä¸ºç‹¬ç«‹æ–‡ä»¶**ï¼ˆç”Ÿäº§ç¯å¢ƒå¿…å¤‡ï¼‰   | éœ€æ­é… `mini-css-extract-plugin` |
| `sass-loader`                 | ç¼–è¯‘ Sass/SCSS                            | ä¾èµ– `node-sass` æˆ– `sass`       |
| `less-loader`                 | ç¼–è¯‘ Less                                 | ä¾èµ– `less`                      |
| `postcss-loader`              | è‡ªåŠ¨æ·»åŠ æµè§ˆå™¨å‰ç¼€ï¼ˆé…åˆ `autoprefixer`ï¼‰ | éœ€é…ç½® `postcss.config.js`       |

> ğŸ“Œ **å…¸å‹ CSS é“¾**ï¼š  
> ```js
> // å¼€å‘ç¯å¢ƒ
> use: ['style-loader', 'css-loader', 'postcss-loader']
> // ç”Ÿäº§ç¯å¢ƒ
> use: [MiniCssExtractPlugin.loader, 'css-loader', 'postcss-loader']
> ```

---

#### âœ… **èµ„æºæ–‡ä»¶ï¼ˆå›¾ç‰‡/å­—ä½“/åª’ä½“ï¼‰**
Webpack 5 **å†…ç½® Asset Modules**ï¼Œæ— éœ€é¢å¤– loaderï¼š
```js
// webpack.config.js
module.exports = {
  module: {
    rules: [
      {
        test: /\.(png|jpg|gif|svg)$/,
        type: 'asset', // è‡ªåŠ¨é€‰æ‹© asset/resource æˆ– asset/inline
        parser: {
          dataUrlCondition: { maxSize: 8 * 1024 } // <8KB è½¬ base64
        },
        generator: {
          filename: 'images/[name].[hash][ext]'
        }
      },
      {
        test: /\.(woff|woff2|eot|ttf|otf)$/,
        type: 'asset/resource', // å¼ºåˆ¶è¾“å‡ºä¸ºæ–‡ä»¶
        generator: { filename: 'fonts/[name][ext]' }
      }
    ]
  }
};
```

> âš ï¸ Webpack 4 ç”¨æˆ·éœ€ç”¨ `file-loader` / `url-loader`ã€‚

---

#### âœ… **å…¶ä»–**
| Loader          | ä½œç”¨                                        |
| --------------- | ------------------------------------------- |
| `html-loader`   | å¤„ç† HTML ä¸­çš„ `<img src="...">` ç­‰èµ„æºå¼•ç”¨ |
| `vue-loader`    | ç¼–è¯‘ Vue å•æ–‡ä»¶ç»„ä»¶ï¼ˆ`.vue`ï¼‰               |
| `worker-loader` | å°† JS æ–‡ä»¶ä½œä¸º Web Worker åŠ è½½              |

---

### äºŒã€å¸¸è§ Pluginï¼ˆæŒ‰åŠŸèƒ½åˆ†ç±»ï¼‰

#### âœ… **æ ¸å¿ƒåŠŸèƒ½**
| Plugin              | ä½œç”¨                                      | å®‰è£…å‘½ä»¤                             |
| ------------------- | ----------------------------------------- | ------------------------------------ |
| `HtmlWebpackPlugin` | è‡ªåŠ¨ç”Ÿæˆ HTML å¹¶è‡ªåŠ¨æ³¨å…¥ bundle           | `npm install -D html-webpack-plugin` |
| `DefinePlugin`      | å®šä¹‰å…¨å±€å¸¸é‡ï¼ˆå¦‚ `process.env.NODE_ENV`ï¼‰ | **Webpack å†…ç½®**                     |
| `ProvidePlugin`     | è‡ªåŠ¨åŠ è½½æ¨¡å—ï¼ˆå¦‚ `$` â†’ `jquery`ï¼‰         | **Webpack å†…ç½®**                     |

> **HtmlWebpackPlugin ç¤ºä¾‹**ï¼š
> ```js
> new HtmlWebpackPlugin({
>   template: './public/index.html',
>   minify: true // ç”Ÿäº§ç¯å¢ƒå‹ç¼© HTML
> })
> ```

---

#### âœ… **ä»£ç ä¼˜åŒ–**
| Plugin                 | ä½œç”¨                                           |
| ---------------------- | ---------------------------------------------- |
| `MiniCssExtractPlugin` | **æå– CSS åˆ°ç‹¬ç«‹æ–‡ä»¶**ï¼ˆæ›¿ä»£ `style-loader`ï¼‰ |
| `CssMinimizerPlugin`   | å‹ç¼© CSSï¼ˆWebpack 5 éœ€æ‰‹åŠ¨é…ç½®ï¼‰               |
| `TerserWebpackPlugin`  | å‹ç¼© JSï¼ˆWebpack 5 ç”Ÿäº§æ¨¡å¼é»˜è®¤å¯ç”¨ï¼‰          |
| `CompressionPlugin`    | ç”Ÿæˆ gzip/brotli å‹ç¼©æ–‡ä»¶                      |

> **MiniCssExtractPlugin ç¤ºä¾‹**ï¼š
> ```js
> const MiniCssExtractPlugin = require('mini-css-extract-plugin');
> 
> plugins: [new MiniCssExtractAssistantPlugin()],
> module: {
>   rules: [{
>     use: [MiniCssExtractPlugin.loader, 'css-loader']
>   }]
> }
> ```

---

#### âœ… **æ€§èƒ½åˆ†æ & è°ƒè¯•**
| Plugin                    | ä½œç”¨                               |
| ------------------------- | ---------------------------------- |
| `webpack-bundle-analyzer` | å¯è§†åŒ– bundle ä½“ç§¯ï¼ˆæ’æŸ¥è¿‡å¤§ä¾èµ–ï¼‰ |
| `SpeedMeasurePlugin`      | åˆ†æå„ loader/plugin è€—æ—¶          |

> **Bundle Analyzer ä½¿ç”¨**ï¼š
> ```js
> const BundleAnalyzerPlugin = require('webpack-bundle-analyzer').BundleAnalyzerPlugin;
> 
> plugins: [new BundleAnalyzerPlugin()] // æ„å»ºåè‡ªåŠ¨æ‰“å¼€åˆ†æé¡µé¢
> ```

---

#### âœ… **é«˜çº§åŠŸèƒ½**
| Plugin                       | ä½œç”¨                                                     |
| ---------------------------- | -------------------------------------------------------- |
| `CopyWebpackPlugin`          | å¤åˆ¶é™æ€èµ„æºåˆ°è¾“å‡ºç›®å½•ï¼ˆå¦‚ `public` æ–‡ä»¶å¤¹ï¼‰             |
| `CleanWebpackPlugin`         | æ¸…ç©ºè¾“å‡ºç›®å½•ï¼ˆWebpack 5 å¯ç”¨ `output.clean: true` æ›¿ä»£ï¼‰ |
| `HotModuleReplacementPlugin` | å¯ç”¨æ¨¡å—çƒ­æ›´æ–°ï¼ˆHMRï¼‰ï¼ˆWebpack 5 å¼€å‘æœåŠ¡å™¨é»˜è®¤å¯ç”¨ï¼‰    |

---

### ä¸‰ã€å¿«é€Ÿå‚è€ƒè¡¨

| åœºæ™¯                | æ¨èç»„åˆ                                                                     |
| ------------------- | ---------------------------------------------------------------------------- |
| **React é¡¹ç›®**      | `babel-loader` + `HtmlWebpackPlugin` + `MiniCssExtractPlugin`                |
| **Vue é¡¹ç›®**        | `vue-loader` + `vue-style-loader`                                            |
| **TypeScript é¡¹ç›®** | `ts-loader` æˆ– `babel-loader` + `fork-ts-checker-webpack-plugin`ï¼ˆç±»å‹æ£€æŸ¥ï¼‰ |
| **ç”Ÿäº§ç¯å¢ƒ CSS**    | `MiniCssExtractPlugin.loader` + `CssMinimizerPlugin`                         |
| **æ€§èƒ½åˆ†æ**        | `webpack-bundle-analyzer`                                                    |

---

### ä¸€å¥è¯æ€»ç»“ï¼š
> **Loader è´Ÿè´£â€œç¿»è¯‘â€æ–‡ä»¶ï¼ˆå¦‚ JSâ†’JSã€Sassâ†’CSSï¼‰ï¼ŒPlugin è´Ÿè´£â€œåŠ å·¥â€æ„å»ºæµç¨‹ï¼ˆå¦‚å‹ç¼©ã€ç”Ÿæˆæ–‡ä»¶ï¼‰â€”â€”äºŒè€…ååŒå®Œæˆä»æºç åˆ°ç”Ÿäº§åŒ…çš„è½¬åŒ–ã€‚**

## Loaderå’ŒPluginçš„åŒºåˆ«

`Loader` å’Œ `Plugin` æ˜¯ Webpack ä¸­ä¸¤ä¸ªæ ¸å¿ƒæ‰©å±•æœºåˆ¶ï¼Œ**èŒè´£ä¸åŒã€è¿è¡Œæ—¶æœºä¸åŒã€ä½¿ç”¨æ–¹å¼ä¹Ÿä¸åŒ**ã€‚ç†è§£å®ƒä»¬çš„åŒºåˆ«æ˜¯æŒæ¡ Webpack é…ç½®çš„å…³é”®ã€‚

---

### ä¸€ã€æ ¸å¿ƒåŒºåˆ«æ¦‚è§ˆ

| ç‰¹æ€§          | **Loader**                                           | **Plugin**                                                   |
| ------------- | ---------------------------------------------------- | ------------------------------------------------------------ |
| **ä½œç”¨**      | **è½¬æ¢æ¨¡å—å†…å®¹**ï¼ˆå¦‚æŠŠ Sass ç¼–è¯‘æˆ CSSï¼‰             | **æ‰©å±• Webpack æ„å»ºæµç¨‹èƒ½åŠ›**ï¼ˆå¦‚å‹ç¼©ä»£ç ã€ç”Ÿæˆ HTMLï¼‰       |
| **å·¥ä½œé˜¶æ®µ**  | **æ¨¡å—åŠ è½½æ—¶**ï¼ˆmodule resolution & transformationï¼‰ | **æ•´ä¸ªæ„å»ºç”Ÿå‘½å‘¨æœŸ**ï¼ˆä»å¼€å§‹åˆ°ç»“æŸçš„ä»»æ„é’©å­ï¼‰               |
| **é…ç½®ä½ç½®**  | `module.rules` æ•°ç»„ä¸­                                | `plugins` æ•°ç»„ä¸­                                             |
| **è¾“å…¥/è¾“å‡º** | æ¥æ”¶**æ–‡ä»¶å†…å®¹**ï¼ˆå­—ç¬¦ä¸²/Bufferï¼‰ï¼Œè¿”å›**æ–°å†…å®¹**    | æ¥æ”¶ **Webpack ç¼–è¯‘å™¨ï¼ˆcompilerï¼‰æˆ–ç¼–è¯‘å¯¹è±¡ï¼ˆcompilationï¼‰** |
| **ç²’åº¦**      | **å•ä¸ªæ¨¡å—çº§åˆ«**                                     | **æ•´ä¸ªæ„å»ºè¿‡ç¨‹çº§åˆ«**                                         |

---

### äºŒã€å½¢è±¡æ¯”å–»

- **Loader åƒâ€œç¿»è¯‘å®˜â€**ï¼š  
  å½“ Webpack é‡åˆ°ä¸€ä¸ªå®ƒä¸è®¤è¯†çš„æ–‡ä»¶ï¼ˆæ¯”å¦‚ `.scss`ï¼‰ï¼Œå°±æ‰¾å¯¹åº”çš„ Loaderï¼ˆ`sass-loader`ï¼‰æŠŠå®ƒâ€œç¿»è¯‘â€æˆ Webpack èƒ½å¤„ç†çš„ JavaScript æ¨¡å—ã€‚

- **Plugin åƒâ€œé¡¹ç›®ç»ç†â€**ï¼š  
  å®ƒä¸å…³å¿ƒå…·ä½“æŸä¸ªæ–‡ä»¶æ€ä¹ˆå¤„ç†ï¼Œè€Œæ˜¯ç›‘æ§æ•´ä¸ªæ‰“åŒ…æµç¨‹ï¼Œåœ¨åˆé€‚æ—¶æœºä»‹å…¥â€”â€”æ¯”å¦‚æ‰“åŒ…å®Œæˆåè‡ªåŠ¨ç”Ÿæˆ HTML æ–‡ä»¶ï¼ˆ`HtmlWebpackPlugin`ï¼‰ï¼Œæˆ–åœ¨ä»£ç å‹ç¼©å‰åšæ€§èƒ½åˆ†æã€‚

---

### ä¸‰ã€ä»£ç ç¤ºä¾‹å¯¹æ¯”

#### âœ… Loader ç¤ºä¾‹ï¼šå¤„ç† CSS
```js
// webpack.config.js
module.exports = {
  module: {
    rules: [
      {
        test: /\.css$/,
        use: ['style-loader', 'css-loader'] // â† è¿™æ˜¯ Loader
      }
    ]
  }
};
```
- **ä½œç”¨**ï¼šå°† `import './style.css'` è½¬æ¢ä¸º JS ä»£ç ï¼ŒåŠ¨æ€æ’å…¥ `<style>` æ ‡ç­¾ã€‚

#### âœ… Plugin ç¤ºä¾‹ï¼šç”Ÿæˆ HTML
```js
// webpack.config.js
const HtmlWebpackPlugin = require('html-webpack-plugin');

module.exports = {
  plugins: [
    new HtmlWebpackPlugin({ template: './src/index.html' }) // â† è¿™æ˜¯ Plugin
  ]
};
```
- **ä½œç”¨**ï¼šåœ¨æ‰“åŒ…ç»“æŸåï¼Œè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªå¼•ç”¨äº† bundle çš„ `index.html`ã€‚

---

### å››ã€è¿è¡Œæ—¶æœºå·®å¼‚ï¼ˆå…³é”®ï¼ï¼‰

Webpack æ„å»ºæµç¨‹ç®€åŒ–å¦‚ä¸‹ï¼š

```
å¯åŠ¨ â†’ è§£æå…¥å£ â†’ 
  â”Œâ”€ é‡åˆ° import æ¨¡å— â†’ è°ƒç”¨å¯¹åº” Loader è½¬æ¢å†…å®¹ â†’ 
  â””â”€ æ‰€æœ‰æ¨¡å—å¤„ç†å®Œ â†’ è§¦å‘ Plugin çš„å„ç§é’©å­ï¼ˆemit, done...ï¼‰â†’ è¾“å‡ºæ–‡ä»¶
```

- **Loader** åªåœ¨ **æ¨¡å—è¢«åŠ è½½æ—¶è§¦å‘**ï¼ˆæ¯ä¸ªåŒ¹é…çš„æ–‡ä»¶éƒ½ä¼šè°ƒç”¨ï¼‰ï¼›
- **Plugin** å¯ä»¥åœ¨ **ä»»ä½•ç”Ÿå‘½å‘¨æœŸé’©å­** ä¸­æ‰§è¡Œï¼ˆå¦‚ `compile`, `emit`, `done`ï¼‰ã€‚

> ğŸ’¡ ä¾‹å¦‚ï¼š`HtmlWebpackPlugin` åœ¨ `emit` é˜¶æ®µç”Ÿæˆ HTMLï¼›`TerserWebpackPlugin` åœ¨ `optimize-chunk-assets` é˜¶æ®µå‹ç¼©ä»£ç ã€‚

---

### äº”ã€å¸¸è§è¯¯åŒº

#### âŒ è¯¯åŒº1ï¼šPlugin ä¹Ÿèƒ½å¤„ç†æ–‡ä»¶ï¼Ÿ
- **éƒ¨åˆ†æ­£ç¡®**ï¼šæœ‰äº› Plugin ä¼šæ“ä½œæ–‡ä»¶ï¼ˆå¦‚ `CopyWebpackPlugin`ï¼‰ï¼Œä½†å®ƒ**ä¸æ˜¯è½¬æ¢æ¨¡å—å†…å®¹**ï¼Œè€Œæ˜¯**åœ¨æ„å»ºåå¤åˆ¶é™æ€èµ„æº**ï¼Œå’Œ Loader çš„â€œæŒ‰éœ€è½¬æ¢â€æœ¬è´¨ä¸åŒã€‚

#### âŒ è¯¯åŒº2ï¼šLoader èƒ½åšä¼˜åŒ–ï¼Ÿ
- **ä¸èƒ½**ï¼šLoader åªè´Ÿè´£â€œç¿»è¯‘â€ï¼Œä»£ç å‹ç¼©ã€Tree Shaking ç­‰ä¼˜åŒ–å¿…é¡»ç”± Plugin æˆ– Webpack å†…ç½®æœºåˆ¶å®Œæˆã€‚

---

### å…­ã€ä¸€å¥è¯æ€»ç»“
> **Loader è´Ÿè´£â€œè¯»æ‡‚â€å„ç§æ–‡ä»¶ï¼ˆè½¬æ¢æ¨¡å—ï¼‰ï¼ŒPlugin è´Ÿè´£â€œæŒæ§â€æ•´ä¸ªæ‰“åŒ…æµç¨‹ï¼ˆå¢å¼ºåŠŸèƒ½ï¼‰â€”â€”å‰è€…æ˜¯â€œç¿»è¯‘å™¨â€ï¼Œåè€…æ˜¯â€œæŒ‡æŒ¥å®˜â€ã€‚**

## webpack çš„æ„å»ºæµç¨‹

Webpack çš„æ„å»ºæµç¨‹æ˜¯ä¸€ä¸ªé«˜åº¦æ¨¡å—åŒ–ã€åŸºäºäº‹ä»¶é©±åŠ¨çš„ç¼–è¯‘è¿‡ç¨‹ã€‚ç†è§£å…¶å†…éƒ¨æœºåˆ¶ï¼Œæœ‰åŠ©äºä¼˜åŒ–é…ç½®ã€è°ƒè¯•é—®é¢˜å’Œå¼€å‘è‡ªå®šä¹‰æ’ä»¶ã€‚ä»¥ä¸‹æ˜¯ **Webpack 5 çš„å®Œæ•´æ„å»ºæµç¨‹è¯¦è§£**ï¼š

---

### ä¸€ã€æ•´ä½“æµç¨‹æ¦‚è§ˆï¼ˆ7 ä¸ªæ ¸å¿ƒé˜¶æ®µï¼‰

![An Image](../public/assets/tongyi-mermaid-2026-01-05-134002.png)

---

### äºŒã€è¯¦ç»†é˜¶æ®µè§£æ

#### 1. **åˆå§‹åŒ–å‚æ•°ï¼ˆInitializationï¼‰**
- åˆå¹¶å‘½ä»¤è¡Œå‚æ•°ï¼ˆ`webpack --mode production`ï¼‰ä¸é…ç½®æ–‡ä»¶ï¼ˆ`webpack.config.js`ï¼‰ï¼›
- å¾—åˆ°æœ€ç»ˆé…ç½®å¯¹è±¡ã€‚

#### 2. **åˆ›å»º Compiler å¯¹è±¡**
- `Compiler` æ˜¯ Webpack çš„**å…¨å±€å•ä¾‹**ï¼Œè´Ÿè´£ï¼š
  - ç®¡ç†é…ç½®ï¼›
  - æ³¨å†Œæ’ä»¶ï¼ˆé€šè¿‡ `compiler.hooks`ï¼‰ï¼›
  - æ§åˆ¶æ•´ä¸ªç”Ÿå‘½å‘¨æœŸã€‚
- æ­¤æ—¶è§¦å‘ `compiler.hooks.initialize` é’©å­ã€‚

#### 3. **ç¡®å®šå…¥å£ï¼ˆEntryï¼‰**
- æ ¹æ® `entry` é…ç½®æ‰¾åˆ°æ‰€æœ‰å…¥å£æ–‡ä»¶ï¼ˆå¦‚ `./src/index.js`ï¼‰ï¼›
- ä¸ºæ¯ä¸ªå…¥å£åˆ›å»ºä¸€ä¸ª **ä¾èµ–ï¼ˆDependencyï¼‰** å¯¹è±¡ã€‚

#### 4. **ç¼–è¯‘æ¨¡å—ï¼ˆCompilationï¼‰**
> âš ï¸ **æ ¸å¿ƒé˜¶æ®µï¼** æ¯æ¬¡æ„å»ºéƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ `Compilation` å¯¹è±¡ï¼ˆåŒ…å«å½“å‰æ„å»ºçš„æ‰€æœ‰æ¨¡å—ä¿¡æ¯ï¼‰ã€‚

##### å­æµç¨‹ï¼š
1. **å¼€å§‹ç¼–è¯‘**  
   - è§¦å‘ `compiler.hooks.make` é’©å­ï¼›
   - ä»å…¥å£å¼€å§‹é€’å½’è§£æä¾èµ–ã€‚

2. **æ¨¡å—è§£æï¼ˆResolveï¼‰**  
   - è°ƒç”¨ `enhanced-resolve` åº“ï¼Œæ ¹æ® `resolve` é…ç½®æŸ¥æ‰¾æ–‡ä»¶ï¼›
   - ä¾‹å¦‚ï¼š`import _ from 'lodash'` â†’ å®šä½åˆ° `node_modules/lodash/index.js`ã€‚

3. **æ¨¡å—åŠ è½½ï¼ˆLoadï¼‰**  
   - æ ¹æ®æ–‡ä»¶ç±»å‹åŒ¹é… `module.rules` ä¸­çš„ Loaderï¼›
   - **Loader é“¾å¼è°ƒç”¨**ï¼ˆä»å³åˆ°å·¦ï¼‰ï¼š
     ```js
     use: ['style-loader', 'css-loader'] 
     // å®é™…æ‰§è¡Œï¼šcss-loader â†’ style-loader
     ```

4. **æ¨¡å—æ„å»ºï¼ˆBuildï¼‰**  
   - å°† Loader å¤„ç†åçš„å†…å®¹è½¬æ¢ä¸º **ASTï¼ˆæŠ½è±¡è¯­æ³•æ ‘ï¼‰**ï¼›
   - åˆ†æ `import`/`require` è¯­å¥ï¼Œæ”¶é›†ä¾èµ–ã€‚

5. **ä¾èµ–æ”¶é›†ï¼ˆDependencyï¼‰**  
   - é€’å½’å¤„ç†æ‰€æœ‰ä¾èµ–æ¨¡å—ï¼ˆæ·±åº¦ä¼˜å…ˆï¼‰ï¼›
   - æ„å»ºå®Œæ•´çš„ **æ¨¡å—ä¾èµ–å›¾ï¼ˆModule Graphï¼‰**ã€‚

#### 5. **å®Œæˆæ¨¡å—ä¾èµ–å›¾**
- æ‰€æœ‰æ¨¡å—æ„å»ºå®Œæˆåï¼Œè§¦å‘ `compilation.hooks.finishModules`ï¼›
- æ‰§è¡Œ **ä»£ç åˆ†å‰²ï¼ˆSplitChunksï¼‰** å’Œ **Tree Shaking**ï¼ˆåŸºäº ES Module é™æ€åˆ†æï¼‰ã€‚

#### 6. **ä¼˜åŒ–ä¸ç”Ÿæˆèµ„æºï¼ˆSeal & Optimizeï¼‰**
- **Sealï¼ˆå°è£…ï¼‰**ï¼š  
  - å°†æ¨¡å—æŒ‰ Chunk åˆ†ç»„ï¼ˆå¦‚ `main.js`, `vendor.js`ï¼‰ï¼›
  - è§¦å‘ `compilation.hooks.seal`ã€‚
- **ä¼˜åŒ–é˜¶æ®µ**ï¼š  
  - å‹ç¼©ä»£ç ï¼ˆ`TerserPlugin`ï¼‰ï¼›
  - æå– CSSï¼ˆ`MiniCssExtractPlugin`ï¼‰ï¼›
  - ç”Ÿæˆå“ˆå¸Œå€¼ï¼ˆ`[contenthash]`ï¼‰ã€‚
- **ç”Ÿæˆèµ„æº**ï¼š  
  - å°† Chunk è½¬æ¢ä¸ºæœ€ç»ˆ assetsï¼ˆå¦‚ `main.a1b2c3.js`ï¼‰ï¼›
  - è§¦å‘ `compilation.hooks.processAssets`ã€‚

#### 7. **è¾“å‡ºæ–‡ä»¶ï¼ˆEmitï¼‰**
- è§¦å‘ `compiler.hhooks.emit` é’©å­ï¼ˆ**Plugin å¸¸åœ¨æ­¤é˜¶æ®µç”Ÿæˆé¢å¤–æ–‡ä»¶**ï¼Œå¦‚ `HtmlWebpackPlugin`ï¼‰ï¼›
- å°† assets å†™å…¥ `output.path` ç›®å½•ï¼›
- è§¦å‘ `compiler.hooks.done`ï¼Œæ„å»ºç»“æŸã€‚

---

### ä¸‰ã€å…³é”®å¯¹è±¡å…³ç³»

| å¯¹è±¡              | ä½œç”¨                               | ç”Ÿå‘½å‘¨æœŸ                                |
| ----------------- | ---------------------------------- | --------------------------------------- |
| **`Compiler`**    | å…¨å±€æ„å»ºç®¡ç†å™¨                     | **å•ä¾‹**ï¼Œè´¯ç©¿æ•´ä¸ª Webpack è¿è¡Œæ—¶       |
| **`Compilation`** | å•æ¬¡æ„å»ºçš„ä¸Šä¸‹æ–‡                   | **æ¯æ¬¡æ„å»ºæ–°å»º**ï¼ŒåŒ…å«æ¨¡å—/Chunk/assets |
| **`Module`**      | è¡¨ç¤ºä¸€ä¸ªæºæ–‡ä»¶ï¼ˆå¦‚ JS/CSSï¼‰        | åœ¨ Compilation ä¸­åˆ›å»º                   |
| **`Chunk`**       | ä»£ç åˆ†å‰²åçš„ä»£ç å—                 | ç”±å¤šä¸ª Module ç»„æˆ                      |
| **`Asset`**       | æœ€ç»ˆè¾“å‡ºçš„æ–‡ä»¶ï¼ˆå¦‚ `.js`, `.css`ï¼‰ | ç”± Chunk ç”Ÿæˆ                           |

---

### å››ã€Plugin å¦‚ä½•ä»‹å…¥æµç¨‹ï¼Ÿ
Plugin é€šè¿‡ **Tapable é’©å­** ç›‘å¬ Compiler/Compilation äº‹ä»¶ï¼š

```js
class MyPlugin {
  apply(compiler) {
    // ç›‘å¬ç¼–è¯‘å¼€å§‹
    compiler.hooks.run.tap('MyPlugin', () => {
      console.log('æ„å»ºå¼€å§‹');
    });
    
    // ç›‘å¬æ–‡ä»¶è¾“å‡ºå‰
    compiler.hooks.emit.tapAsync('MyPlugin', (compilation, callback) => {
      compilation.assets['hello.txt'] = { // æ·»åŠ æ–°æ–‡ä»¶
        source: () => 'Hello World',
        size: () => 11
      };
      callback();
    });
  }
}
```

> ğŸ”‘ **æ ¸å¿ƒé’©å­**ï¼š  
> - `make`ï¼šå¼€å§‹è§£ææ¨¡å—ï¼›  
> - `emit`ï¼šè¾“å‡ºæ–‡ä»¶å‰ï¼›  
> - `done`ï¼šæ„å»ºå®Œæˆã€‚

---

### äº”ã€Loader çš„æ‰§è¡Œæ—¶æœº
- **ä»…åœ¨æ¨¡å—æ„å»ºé˜¶æ®µï¼ˆStep 4.3ï¼‰è§¦å‘**ï¼›
- æ¯ä¸ªåŒ¹é…çš„æ–‡ä»¶ç‹¬ç«‹è°ƒç”¨ Loader é“¾ï¼›
- Loader æœ¬è´¨æ˜¯ **åŒæ­¥/å¼‚æ­¥å‡½æ•°**ï¼Œæ¥æ”¶æ–‡ä»¶å†…å®¹å¹¶è¿”å›æ–°å†…å®¹ã€‚

---

### å…­ã€ä¸€å¥è¯æ€»ç»“
> **Webpack æ„å»º = åˆå§‹åŒ– â†’ åˆ›å»º Compiler â†’ é€’å½’è§£ææ¨¡å—ï¼ˆLoader è½¬æ¢ï¼‰â†’ ç”Ÿæˆä¾èµ–å›¾ â†’ ä¼˜åŒ–åˆ†å—ï¼ˆPlugin ä»‹å…¥ï¼‰â†’ è¾“å‡ºæ–‡ä»¶**ï¼Œ  
> å…¶ä¸­ **Compiler ç®¡å…¨å±€ï¼ŒCompilation ç®¡å•æ¬¡æ„å»ºï¼ŒLoader è½¬æ¨¡å—ï¼ŒPlugin æ§æµç¨‹**ã€‚

## ä»€ä¹ˆæ˜¯Webpackçš„çƒ­æ›´æ–°ï¼ˆHot Module Replacementï¼‰ï¼ŸåŸç†æ˜¯ä»€ä¹ˆï¼Ÿ

Webpack çš„ **çƒ­æ›´æ–°ï¼ˆHot Module Replacement, HMRï¼‰** æ˜¯ä¸€ç§åœ¨**ä¸åˆ·æ–°æ•´ä¸ªé¡µé¢**çš„æƒ…å†µä¸‹ï¼Œ**å®æ—¶æ›¿æ¢ã€æ·»åŠ æˆ–åˆ é™¤æ¨¡å—**çš„å¼€å‘åŠŸèƒ½ã€‚å®ƒæå¤§æå‡äº†å¼€å‘ä½“éªŒâ€”â€”ä¿®æ”¹ä»£ç åï¼Œåªæ›´æ–°å—å½±å“çš„éƒ¨åˆ†ï¼ŒçŠ¶æ€ï¼ˆå¦‚ React ç»„ä»¶ stateã€Vuex æ•°æ®ï¼‰å¾—ä»¥ä¿ç•™ã€‚

---

### ä¸€ã€HMR vs Live Reload
| ç‰¹æ€§         | Live Reload    | HMR                    |
| ------------ | -------------- | ---------------------- |
| **é¡µé¢åˆ·æ–°** | âœ… æ•´é¡µåˆ·æ–°     | âŒ ä¸åˆ·æ–°               |
| **çŠ¶æ€ä¿ç•™** | âŒ ä¸¢å¤±æ‰€æœ‰çŠ¶æ€ | âœ… ä¿ç•™è¿è¡Œæ—¶çŠ¶æ€       |
| **æ›´æ–°ç²’åº¦** | æ•´ä¸ªé¡µé¢       | å•ä¸ªæ¨¡å—ï¼ˆå¦‚ä¸€ä¸ªç»„ä»¶ï¼‰ |
| **é€‚ç”¨åœºæ™¯** | ç®€å•é™æ€é¡µ     | å¤æ‚ SPAï¼ˆReact/Vueï¼‰  |

> ğŸ’¡ **HMR æ˜¯ Live Reload çš„è¶…é›†**ï¼šå½“ HMR æ— æ³•å¤„ç†æ—¶ï¼Œä¼šé™çº§ä¸ºé¡µé¢åˆ·æ–°ã€‚

---

### äºŒã€HMR å·¥ä½œåŸç†ï¼ˆæ ¸å¿ƒæµç¨‹ï¼‰

![An Image](../public/assets/tongyi-mermaid-2026-01-05-134344.png)

#### è¯¦ç»†æ­¥éª¤ï¼š
1. **å»ºç«‹è¿æ¥**  
   - å¯åŠ¨ `webpack-dev-server` æ—¶ï¼Œè‡ªåŠ¨æ³¨å…¥ HMR å®¢æˆ·ç«¯ä»£ç ï¼›
   - æµè§ˆå™¨ä¸ Dev Server é€šè¿‡ **WebSocket** å»ºç«‹é•¿è¿æ¥ã€‚

2. **æ–‡ä»¶å˜æ›´æ£€æµ‹**  
   - Dev Server ç›‘å¬æ–‡ä»¶ç³»ç»Ÿå˜åŒ–ï¼ˆå¦‚ä¿å­˜ `Button.jsx`ï¼‰ï¼›
   - è§¦å‘ Webpack **å¢é‡ç¼–è¯‘**ï¼Œç”Ÿæˆï¼š
     - `hash.hot-update.json`ï¼šæè¿°å˜æ›´çš„æ¨¡å—åˆ—è¡¨ï¼›
     - `hash.hot-update.js`ï¼šåŒ…å«æ–°æ¨¡å—ä»£ç çš„ JS æ–‡ä»¶ã€‚

3. **æ¨é€æ›´æ–°**  
   - Dev Server é€šè¿‡ WebSocket å°† **hash å€¼** æ¨é€ç»™æµè§ˆå™¨ï¼›
   - æµè§ˆå™¨å‘èµ· AJAX è¯·æ±‚è·å– `hot-update.json` å’Œ `hot-update.js`ã€‚

4. **åº”ç”¨æ›´æ–°**  
   - Webpack è¿è¡Œæ—¶ï¼ˆRuntimeï¼‰æ¥æ”¶æ–°æ¨¡å—ï¼›
   - **å…³é”®**ï¼šæ£€æŸ¥æ¨¡å—æ˜¯å¦å£°æ˜äº† `module.hot.accept()`ï¼š
     - âœ… è‹¥æœ‰ï¼šæ‰§è¡Œè‡ªå®šä¹‰æ›´æ–°é€»è¾‘ï¼ˆå¦‚ React æ›¿æ¢ç»„ä»¶ï¼‰ï¼›
     - âŒ è‹¥æ— ï¼šè§¦å‘ **é¡µé¢åˆ·æ–°**ï¼ˆé™çº§è¡Œä¸ºï¼‰ã€‚

---

### ä¸‰ã€HMR çš„ä¸¤ç§å®ç°æ–¹å¼

#### 1. **æ‰‹åŠ¨ç¼–å†™ `accept` é€»è¾‘ï¼ˆåº•å±‚ï¼‰**
```js
// button.js
export const Button = () => <button>Click me</button>;

// index.js
import { Button } from './button';

// å£°æ˜æ¥å— button æ¨¡å—çš„æ›´æ–°
if (module.hot) {
  module.hot.accept('./button', () => {
    // é‡æ–°æ¸²æŸ“æŒ‰é’®ï¼ˆä¿ç•™çˆ¶ç»„ä»¶çŠ¶æ€ï¼‰
    render(<App newButton={Button} />);
  });
}
```

#### 2. **æ¡†æ¶é›†æˆï¼ˆæ¨èï¼‰**
- **React**ï¼šé€šè¿‡ `react-refresh` + `@pmmmwh/react-refresh-webpack-plugin`  
  â†’ è‡ªåŠ¨ patch ç»„ä»¶ï¼Œæ— éœ€æ‰‹åŠ¨å†™ `accept`ã€‚
- **Vue**ï¼šVue Loader å†…ç½® HMR æ”¯æŒ  
  â†’ å•æ–‡ä»¶ç»„ä»¶ä¿®æ”¹åè‡ªåŠ¨æ›´æ–°ã€‚
- **å…¶ä»–**ï¼šSvelteã€Angular ç­‰å‡æœ‰å®˜æ–¹ HMR æ–¹æ¡ˆã€‚

> âœ… **ç°ä»£å¼€å‘ä¸­ï¼Œ99% åœºæ™¯æ— éœ€æ‰‹åŠ¨é…ç½® HMR**ï¼Œæ¡†æ¶è„šæ‰‹æ¶å·²é›†æˆã€‚

---

### å››ã€HMR çš„å±€é™æ€§
- **ä»…é™å¼€å‘ç¯å¢ƒ**ï¼šç”Ÿäº§ç¯å¢ƒéœ€å…³é—­ï¼ˆ`hot: false`ï¼‰ï¼›
- **çŠ¶æ€ä¿ç•™æœ‰æ¡ä»¶**ï¼š
  - Reactï¼šå‡½æ•°ç»„ä»¶çŠ¶æ€å¯ä¿ç•™ï¼Œç±»ç»„ä»¶éœ€é…åˆ `react-hot-loader`ï¼ˆå·²åºŸå¼ƒï¼Œæ”¹ç”¨ Fast Refreshï¼‰ï¼›
  - å…¨å±€å˜é‡/æ¨¡å—çº§çŠ¶æ€ï¼ˆå¦‚ Redux storeï¼‰éœ€é¢å¤–é…ç½®ï¼ˆå¦‚ `redux-hmr`ï¼‰ï¼›
- **æ— æ³•å¤„ç†**ï¼š
  - å…¥å£æ–‡ä»¶ï¼ˆentryï¼‰ä¿®æ”¹ï¼›
  - ä¾èµ–æ ‘æ ¹èŠ‚ç‚¹å˜æ›´ï¼›
  - CSS é»˜è®¤æ”¯æŒ HMRï¼ˆæ— éœ€é…ç½®ï¼‰ï¼Œä½† JS éœ€æ¡†æ¶æ”¯æŒã€‚

---

### äº”ã€å¦‚ä½•å¯ç”¨ HMRï¼Ÿ
#### æ–¹æ³• 1ï¼š`webpack-dev-server`ï¼ˆæœ€å¸¸ç”¨ï¼‰
```js
// webpack.config.js
module.exports = {
  devServer: {
    hot: true // å¯ç”¨ HMR
  }
};
```

#### æ–¹æ³• 2ï¼šNode.js API
```js
const webpack = require('webpack');
const compiler = webpack(config);
const server = new WebpackDevServer(compiler, { hot: true });
```

> âš ï¸ **æ³¨æ„**ï¼š  
> - Webpack 5 ä¸­ `HotModuleReplacementPlugin` **é»˜è®¤å¯ç”¨**ï¼ˆå½“ `hot: true` æ—¶ï¼‰ï¼›  
> - æ— éœ€æ‰‹åŠ¨æ·»åŠ è¯¥æ’ä»¶ï¼

---

### å…­ã€ä¸€å¥è¯æ€»ç»“
> **HMR é€šè¿‡ WebSocket ç›‘å¬æ–‡ä»¶å˜åŒ–ï¼Œå¢é‡ç¼–è¯‘å¹¶æ¨é€æ–°æ¨¡å—ï¼Œç»“åˆ `module.hot.accept()` å®ç°é¡µé¢å±€éƒ¨æ›´æ–°â€”â€”å®ƒæ˜¯ç°ä»£å‰ç«¯å¼€å‘â€œç§’çº§åé¦ˆâ€ä½“éªŒçš„æ ¸å¿ƒæŠ€æœ¯ã€‚**

## ä»€ä¹ˆæ˜¯Code Splitting

**Code Splittingï¼ˆä»£ç åˆ†å‰²ï¼‰** æ˜¯ Webpack æä¾›çš„ä¸€ç§ä¼˜åŒ–æŠ€æœ¯ï¼Œç”¨äºå°†**åºå¤§çš„ JavaScript bundle æ‹†åˆ†æˆå¤šä¸ªè¾ƒå°çš„ chunkï¼ˆä»£ç å—ï¼‰**ï¼Œå®ç°**æŒ‰éœ€åŠ è½½ï¼ˆLazy Loadingï¼‰** æˆ– **å¹¶è¡ŒåŠ è½½**ï¼Œä»è€Œæ˜¾è‘—æå‡åº”ç”¨çš„**é¦–å±åŠ è½½é€Ÿåº¦**å’Œ**è¿è¡Œæ—¶æ€§èƒ½**ã€‚

---

### ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦ Code Splittingï¼Ÿ

- **é—®é¢˜**ï¼šå•ä¸ª bundle æ–‡ä»¶è¿‡å¤§ï¼ˆå¦‚ 2MBï¼‰ï¼Œç”¨æˆ·éœ€ç­‰å¾…å…¨éƒ¨ä¸‹è½½ã€è§£æåæ‰èƒ½äº¤äº’ï¼›
- **è§£å†³æ–¹æ¡ˆ**ï¼š
  - é¦–å±åªåŠ è½½å¿…è¦ä»£ç ï¼›
  - å…¶ä»–åŠŸèƒ½ä»£ç åœ¨éœ€è¦æ—¶å†åŠ è½½ï¼ˆå¦‚è·¯ç”±åˆ‡æ¢ã€æ¨¡æ€æ¡†æ‰“å¼€ï¼‰ï¼›
  - åˆ©ç”¨æµè§ˆå™¨ç¼“å­˜ï¼šå…¬å…±ä»£ç å•ç‹¬æ‰“åŒ…ï¼Œæ›´æ–°æ—¶ä»…å˜åŠ¨ä¸šåŠ¡ä»£ç ã€‚

> âœ… **æ ¸å¿ƒç›®æ ‡**ï¼šå‡å°‘åˆå§‹åŠ è½½ä½“ç§¯ï¼Œæå‡ç”¨æˆ·ä½“éªŒï¼ˆå°¤å…¶ç§»åŠ¨ç«¯/å¼±ç½‘ç¯å¢ƒï¼‰ã€‚

---

### äºŒã€Code Splitting çš„ä¸‰ç§ä¸»è¦æ–¹å¼

#### 1. **å…¥å£èµ·ç‚¹ï¼ˆEntry Pointsï¼‰** â€”â€” æ‰‹åŠ¨åˆ†å‰²
- **åŸç†**ï¼šé…ç½®å¤šä¸ª `entry`ï¼Œç”Ÿæˆå¤šä¸ª bundleã€‚
- **ç¼ºç‚¹**ï¼šæ— æ³•è‡ªåŠ¨æå–å…¬å…±ä¾èµ–ï¼Œæ˜“å¯¼è‡´é‡å¤ä»£ç ã€‚
```js
// webpack.config.js
module.exports = {
  entry: {
    app: './src/app.js',
    vendor: './src/vendor.js' // æ‰‹åŠ¨åˆ†ç¦»ç¬¬ä¸‰æ–¹åº“
  }
};
```

#### 2. **SplitChunksPluginï¼ˆæ¨èï¼‰** â€”â€” è‡ªåŠ¨åˆ†å‰²
- **åŸç†**ï¼šWebpack 5 å†…ç½®æ’ä»¶ï¼Œ**è‡ªåŠ¨æå–å…¬å…±ä»£ç **ï¼ˆå¦‚ node_modulesï¼‰ã€‚
- **é»˜è®¤è¡Œä¸º**ï¼ˆ`optimization.splitChunks`ï¼‰ï¼š
  - åˆ†ç¦» `node_modules` ä¸­çš„ä»£ç ï¼›
  - å¤§äº 20KB çš„ chunkï¼›
  - å¹¶è¡Œè¯·æ±‚ â‰¤ 30 ä¸ªã€‚
- **è‡ªå®šä¹‰é…ç½®**ï¼š
```js
// webpack.config.js
module.exports = {
  optimization: {
    splitChunks: {
      chunks: 'all', // å¯¹æ‰€æœ‰ chunk ç”Ÿæ•ˆï¼ˆasync / initialï¼‰
      cacheGroups: {
        // æå–ç¬¬ä¸‰æ–¹åº“
        vendor: {
          test: /[\\/]node_modules[\\/]/,
          name: 'vendors',
          chunks: 'all'
        },
        // æå–å…¬å…±ä¸šåŠ¡ä»£ç 
        common: {
          minChunks: 2, // è¢«è‡³å°‘ 2 ä¸ª chunk å¼•ç”¨
          name: 'common',
          chunks: 'all'
        }
      }
    }
  }
};
```
> ğŸ’¡ **ç»“æœ**ï¼šç”Ÿæˆ `app.js` + `vendors.js` + `common.js`ï¼Œé¿å…é‡å¤æ‰“åŒ…ã€‚

#### 3. **åŠ¨æ€å¯¼å…¥ï¼ˆDynamic Importsï¼‰** â€”â€” æŒ‰éœ€åŠ è½½
- **åŸç†**ï¼šä½¿ç”¨ `import()` è¯­æ³•ï¼ˆç¬¦åˆ ECMAScript ææ¡ˆï¼‰ï¼Œ**è¿è¡Œæ—¶åŠ¨æ€åŠ è½½æ¨¡å—**ã€‚
- **é€‚ç”¨åœºæ™¯**ï¼š
  - è·¯ç”±æ‡’åŠ è½½ï¼ˆReact/Vueï¼‰ï¼›
  - åŠŸèƒ½æ€§ç»„ä»¶ï¼ˆå¦‚â€œå¯¼å‡ºä¸º PDFâ€æŒ‰é’®ç‚¹å‡»ååŠ è½½åº“ï¼‰ã€‚
- **ç¤ºä¾‹**ï¼š
```js
// è·¯ç”±æ‡’åŠ è½½ï¼ˆReactï¼‰
const Home = React.lazy(() => import('./Home'));
const About = React.lazy(() => import('./About'));

// åŠŸèƒ½æ€§æ¨¡å—
document.getElementById('btn').addEventListener('click', async () => {
  const { exportPDF } = await import('./pdfUtils');
  exportPDF();
});
```
> âœ… **Webpack è‡ªåŠ¨ä¸ºæ¯ä¸ª `import()` åˆ›å»ºç‹¬ç«‹ chunk**ï¼Œå‘½åé»˜è®¤ä¸º `[id].[contenthash].js`ã€‚

---

### ä¸‰ã€å®é™…æ•ˆæœå¯¹æ¯”

| æ–¹æ¡ˆ           | åˆå§‹åŠ è½½ä½“ç§¯             | é¦–å±é€Ÿåº¦ | ç¼“å­˜æ•ˆç‡                  |
| -------------- | ------------------------ | -------- | ------------------------- |
| å• Bundle      | 2.0 MB                   | æ…¢       | ä½ï¼ˆä»»ä½•æ”¹åŠ¨å…¨å¤±æ•ˆï¼‰      |
| Code Splitting | 400 KB (é¦–å±) + æŒ‰éœ€åŠ è½½ | å¿«       | é«˜ï¼ˆvendors.js é•¿æœŸç¼“å­˜ï¼‰ |

---

### å››ã€æœ€ä½³å®è·µ

1. **ä¼˜å…ˆä½¿ç”¨ `SplitChunksPlugin`**  
   â†’ è‡ªåŠ¨ä¼˜åŒ–å…¬å…±ä»£ç ï¼Œæ— éœ€æ‰‹åŠ¨ç»´æŠ¤ã€‚

2. **è·¯ç”±çº§æ‡’åŠ è½½**  
   ```js
   // Vue 3
   const Home = () => import('./views/Home.vue');
   
   // React + Suspense
   const Profile = React.lazy(() => import('./Profile'));
   ```

3. **é¿å…è¿‡åº¦åˆ†å‰²**  
   - è¿‡å¤šå° chunk ä¼šå¢åŠ  HTTP è¯·æ±‚ï¼ˆHTTP/1.1 ä¸‹å½±å“å¤§ï¼ŒHTTP/2 å½±å“å°ï¼‰ï¼›
   - Webpack é»˜è®¤é™åˆ¶ï¼šæœ€å° chunk 20KBï¼Œæœ€å¤šå¹¶è¡Œè¯·æ±‚ 30 ä¸ªã€‚

4. **é¢„åŠ è½½å…³é”®èµ„æºï¼ˆå¯é€‰ï¼‰**  
   ```js
   // é¢„åŠ è½½ï¼ˆæµè§ˆå™¨ç©ºé—²æ—¶åŠ è½½ï¼‰
   import(/* webpackPreload: true */ './critical-component');
   ```

---

### äº”ã€ä¸€å¥è¯æ€»ç»“
> **Code Splitting é€šè¿‡â€œæ‹†åŒ… + æŒ‰éœ€åŠ è½½â€ï¼Œè®©åº”ç”¨é¦–å±æ›´å¿«ã€ç¼“å­˜æ›´é«˜æ•ˆâ€”â€”å®ƒæ˜¯ç°ä»£å‰ç«¯æ€§èƒ½ä¼˜åŒ–çš„åŸºçŸ³æŠ€æœ¯ã€‚**

## Webpackçš„Source Mapæ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•é…ç½®ç”ŸæˆSource Mapï¼Ÿ

**Source Mapï¼ˆæºæ˜ å°„ï¼‰** æ˜¯ Webpack æä¾›çš„ä¸€ç§è°ƒè¯•å·¥å…·ï¼Œç”¨äºå°†**å‹ç¼©/ç¼–è¯‘åçš„ä»£ç **ï¼ˆå¦‚ bundle.jsï¼‰**æ˜ å°„å›åŸå§‹æºä»£ç **ï¼ˆå¦‚ src/index.jsï¼‰ï¼Œä½¿å¼€å‘è€…èƒ½åœ¨æµè§ˆå™¨ä¸­ç›´æ¥è°ƒè¯•æœªå‹ç¼©ã€æœªè½¬æ¢çš„æºç ã€‚

---

### ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦ Source Mapï¼Ÿ

- **é—®é¢˜**ï¼šWebpack æ‰“åŒ…åä»£ç è¢«å‹ç¼©ã€æ··æ·†ã€åˆå¹¶ï¼ˆå¦‚ ES6 â†’ ES5ã€TypeScript â†’ JSï¼‰ï¼Œé”™è¯¯å †æ ˆéš¾ä»¥å®šä½ï¼›
- **è§£å†³æ–¹æ¡ˆ**ï¼šSource Map ç”Ÿæˆä¸€ä¸ª `.map` æ–‡ä»¶ï¼Œè®°å½•**è½¬æ¢åä»£ç  â†” åŸå§‹ä»£ç **çš„æ˜ å°„å…³ç³»ï¼›
- **æ•ˆæœ**ï¼šåœ¨æµè§ˆå™¨ DevTools ä¸­ï¼š
  - æ–­ç‚¹å¯æ‰“åœ¨åŸå§‹ `.ts`/`.jsx` æ–‡ä»¶ä¸Šï¼›
  - é”™è¯¯å †æ ˆæ˜¾ç¤ºåŸå§‹æ–‡ä»¶è¡Œå·ã€‚

> âœ… **æ ¸å¿ƒä»·å€¼**ï¼šæå‡å¼€å‘è°ƒè¯•æ•ˆç‡ï¼Œå°¤å…¶åœ¨ç”Ÿäº§ç¯å¢ƒæ’æŸ¥é—®é¢˜æ—¶è‡³å…³é‡è¦ã€‚

---

### äºŒã€å¦‚ä½•é…ç½® Source Mapï¼Ÿ

é€šè¿‡ `devtool` é…ç½®é¡¹æ§åˆ¶ç”Ÿæˆæ–¹å¼ï¼ˆ**ä¸åŒå€¼å½±å“æ„å»ºé€Ÿåº¦ & è°ƒè¯•ä½“éªŒ**ï¼‰ï¼š

#### 1. **å¼€å‘ç¯å¢ƒæ¨è**
| é…ç½®å€¼                           | ç‰¹ç‚¹                                         | é€‚ç”¨åœºæ™¯                 |
| -------------------------------- | -------------------------------------------- | ------------------------ |
| `'eval'`                         | æ¯ä¸ªæ¨¡å—ç”¨ `eval()` æ‰§è¡Œï¼Œæœ€å¿«ä½†åŠŸèƒ½å¼±       | å¿«é€Ÿè¿­ä»£ï¼ˆä¸æ”¯æŒåˆ—æ˜ å°„ï¼‰ |
| `'cheap-module-eval-source-map'` | **æœ€ä½³å¹³è¡¡**ï¼šåŒ…å« loader è½¬æ¢å‰çš„æºç ï¼Œè¾ƒå¿« | React/Vue å¼€å‘           |
| `'eval-cheap-module-source-map'` | åŒä¸Šï¼Œä½†ä»…è¡Œæ˜ å°„ï¼ˆæ— åˆ—æ˜ å°„ï¼‰                 | å¯¹é€Ÿåº¦è¦æ±‚æé«˜           |

```js
// webpack.config.js (å¼€å‘ç¯å¢ƒ)
module.exports = {
  mode: 'development',
  devtool: 'cheap-module-eval-source-map', // æ¨è
};
```

#### 2. **ç”Ÿäº§ç¯å¢ƒæ¨è**
| é…ç½®å€¼                | ç‰¹ç‚¹                                      | é€‚ç”¨åœºæ™¯               |
| --------------------- | ----------------------------------------- | ---------------------- |
| `'source-map'`        | ç”Ÿæˆç‹¬ç«‹ `.map` æ–‡ä»¶ï¼Œæœ€å®Œæ•´ä½†æœ€æ…¢        | éœ€è¦ç²¾ç¡®é”™è¯¯è¿½è¸ª       |
| `'hidden-source-map'` | ç”Ÿæˆ `.map` ä½†ä¸å…³è” bundleï¼ˆéœ€æ‰‹åŠ¨åŠ è½½ï¼‰ | å®‰å…¨æ•æ„Ÿé¡¹ç›®           |
| **ä¸ç”Ÿæˆ**            | æ—  `.map` æ–‡ä»¶                            | è¿½æ±‚æè‡´ä½“ç§¯ï¼ˆä¸æ¨èï¼‰ |

```js
// webpack.config.js (ç”Ÿäº§ç¯å¢ƒ)
module.exports = {
  mode: 'production',
  devtool: 'source-map', // æ¨èï¼ˆé…åˆé”™è¯¯ç›‘æ§ç³»ç»Ÿï¼‰
};
```

> âš ï¸ **ç”Ÿäº§ç¯å¢ƒæ³¨æ„**ï¼š  
> - é¿å…ä½¿ç”¨ `inline`ï¼ˆå¦‚ `inline-source-map`ï¼‰ï¼Œä¼šå¢å¤§ bundle ä½“ç§¯ï¼›  
> - æ•æ„Ÿé¡¹ç›®å¯ä¸Šä¼  `.map` åˆ°ç§æœ‰æœåŠ¡å™¨ï¼Œä¸å…¬å¼€æš´éœ²ã€‚

---

### ä¸‰ã€Source Map ç±»å‹è¯¦è§£

| é…ç½®å€¼                    | æ˜¯å¦ç”Ÿæˆ `.map` æ–‡ä»¶ | æ˜¯å¦å†…è”åˆ° bundle | åŒ…å« loader è½¬æ¢å‰æºç  | æ€§èƒ½          |
| ------------------------- | -------------------- | ----------------- | ---------------------- | ------------- |
| `eval`                    | âŒ                    | âœ…ï¼ˆ`eval` ä¸­ï¼‰    | âŒ                      | âš¡ï¸ æå¿«        |
| `cheap-source-map`        | âœ…                    | âŒ                 | âŒ                      | å¿«            |
| `cheap-module-source-map` | âœ…                    | âŒ                 | âœ…                      | ä¸­            |
| `source-map`              | âœ…                    | âŒ                 | âœ…                      | ğŸ¢ æ…¢          |
| `inline-source-map`       | âŒ                    | âœ…ï¼ˆBase64ï¼‰       | âœ…                      | æ…¢ + å¢å¤§ä½“ç§¯ |

> ğŸ”‘ **å…³é”®æœ¯è¯­**ï¼š  
> - **`cheap`**ï¼šåªæ˜ å°„**è¡Œå·**ï¼ˆæ— åˆ—å·ï¼‰ï¼Œé€Ÿåº¦æ›´å¿«ï¼›  
> - **`module`**ï¼šåŒ…å« **loader è½¬æ¢å‰çš„æºç **ï¼ˆå¦‚ TypeScript/JSX åŸå§‹ä»£ç ï¼‰ï¼›  
> - **`eval`**ï¼šç”¨ `eval()` æ‰§è¡Œä»£ç ï¼Œé™„åŠ  `//# sourceURL` å®ç°æ˜ å°„ã€‚

---

### å››ã€å®é™…æ•ˆæœæ¼”ç¤º

#### 1. **æœªå¯ç”¨ Source Map**
- é”™è¯¯å †æ ˆï¼š
  ```js
  bundle.js:1 Uncaught ReferenceError: x is not defined
  ```
- DevTools åªèƒ½æŸ¥çœ‹å‹ç¼©åçš„ `bundle.js`ã€‚

#### 2. **å¯ç”¨ Source Map å**
- é”™è¯¯å †æ ˆï¼š
  ```js
  src/utils.js:15 Uncaught ReferenceError: x is not defined
  ```
- DevTools ç›´æ¥æ˜¾ç¤º `src/utils.js` åŸå§‹ä»£ç ï¼Œå¯æ‰“æ–­ç‚¹è°ƒè¯•ã€‚

---

### äº”ã€é«˜çº§é…ç½®ï¼ˆæŒ‰éœ€ç”Ÿæˆï¼‰

#### 1. **ä»…å¯¹ç‰¹å®šæ–‡ä»¶ç”Ÿæˆ Source Map**
```js
// åœ¨ loader ä¸­è¦†ç›–å…¨å±€ devtool
module.exports = {
  module: {
    rules: [
      {
        test: /\.js$/,
        use: [
          {
            loader: 'babel-loader',
            options: {
              sourceMaps: true // å¼ºåˆ¶ Babel ç”Ÿæˆ Source Map
            }
          }
        ]
      }
    ]
  }
};
```

#### 2. **Nginx é…ç½®ç”Ÿäº§ç¯å¢ƒ Source Map**
```nginx
# ä»…å…è®¸å†…éƒ¨ IP è®¿é—® .map æ–‡ä»¶
location ~ \.map$ {
  allow 192.168.0.0/16;
  deny all;
}
```

---

### å…­ã€ä¸€å¥è¯æ€»ç»“
> **Source Map æ˜¯å¼€å‘è€…çš„â€œæ—¶å…‰æœºâ€â€”â€”å®ƒè®©å‹ç¼©æ··æ·†çš„ç”Ÿäº§ä»£ç â€œè¿˜åŸâ€ä¸ºå¯è¯»çš„æºç ã€‚å¼€å‘ç¯å¢ƒç”¨ `cheap-module-eval-source-map` å¹³è¡¡é€Ÿåº¦ä¸ä½“éªŒï¼Œç”Ÿäº§ç¯å¢ƒç”¨ `source-map` ç²¾å‡†å®šä½é”™è¯¯ã€‚**

## Webpackçš„Tree ShakingåŸç†

**Tree Shakingï¼ˆæ‘‡æ ‘ä¼˜åŒ–ï¼‰** æ˜¯ Webpack æä¾›çš„ä¸€ç§**æ­»ä»£ç æ¶ˆé™¤ï¼ˆDead Code Eliminationï¼‰** æŠ€æœ¯ï¼Œç”¨äºåœ¨æ„å»ºè¿‡ç¨‹ä¸­**è‡ªåŠ¨ç§»é™¤æœªè¢«ä½¿ç”¨çš„ JavaScript ä»£ç **ï¼Œä»è€Œå‡å°æœ€ç»ˆ bundle ä½“ç§¯ã€‚å®ƒçš„åå­—æ¥æºäºâ€œæ‘‡æ™ƒä¸€æ£µæ ‘ï¼Œæ¯å¶ï¼ˆæ— ç”¨ä»£ç ï¼‰è‡ªç„¶æ‰è½â€ã€‚

---

### ä¸€ã€æ ¸å¿ƒå‰æï¼šå¿…é¡»ä½¿ç”¨ ES Moduleï¼ˆESMï¼‰

Tree Shaking **ä»…å¯¹ ES6 æ¨¡å—ï¼ˆ`import`/`export`ï¼‰ç”Ÿæ•ˆ**ï¼ŒåŸå› å¦‚ä¸‹ï¼š

| æ¨¡å—ç³»ç»Ÿ             | ç‰¹æ€§                       | æ˜¯å¦æ”¯æŒ Tree Shaking |
| -------------------- | -------------------------- | --------------------- |
| **ES Module (ESM)**  | é™æ€ç»“æ„ï¼ˆç¼–è¯‘æ—¶ç¡®å®šä¾èµ–ï¼‰ | âœ… æ”¯æŒ                |
| CommonJS (`require`) | åŠ¨æ€ç»“æ„ï¼ˆè¿è¡Œæ—¶ç¡®å®šä¾èµ–ï¼‰ | âŒ ä¸æ”¯æŒ              |

> ğŸ’¡ **å…³é”®åŒºåˆ«**ï¼š  
> - ESM çš„ `import` å¿…é¡»åœ¨é¡¶å±‚é™æ€å£°æ˜ï¼ŒWebpack èƒ½åœ¨**ç¼–è¯‘æ—¶åˆ†æä¾èµ–å…³ç³»**ï¼›  
> - CommonJS çš„ `require()` å¯åœ¨å‡½æ•°å†…åŠ¨æ€è°ƒç”¨ï¼ŒWebpack æ— æ³•ç¡®å®šæ˜¯å¦ä¼šè¢«æ‰§è¡Œã€‚

#### ç¤ºä¾‹ï¼šå¯è¢« Tree Shaking çš„ä»£ç 
```js
// math.js
export const add = (a, b) => a + b;
export const multiply = (a, b) => a * b;

// index.js
import { add } from './math.js'; // åªå¼•å…¥ add
console.log(add(1, 2)); // multiply ä¼šè¢«ç§»é™¤ï¼
```

#### åä¾‹ï¼šæ— æ³• Tree Shaking
```js
// ä½¿ç”¨ CommonJS
const { add } = require('./math.js'); // Webpack æ— æ³•ç¡®å®šæ˜¯å¦ç”¨åˆ° multiply

// åŠ¨æ€å¯¼å…¥
if (condition) {
  import('./math.js').then(...); // è¿è¡Œæ—¶åŠ è½½ï¼Œæ— æ³•åˆ†æ
}
```

---

### äºŒã€Tree Shaking å·¥ä½œåŸç†ï¼ˆWebpack 5ï¼‰

#### æ­¥éª¤ 1ï¼šæ„å»ºæ¨¡å—ä¾èµ–å›¾ï¼ˆModule Graphï¼‰
- Webpack è§£ææ‰€æœ‰ `import`/`export`ï¼Œå»ºç«‹æ¨¡å—é—´çš„å¼•ç”¨å…³ç³»ï¼›
- æ ‡è®°æ¯ä¸ªå¯¼å‡ºé¡¹ï¼ˆå¦‚ `add`, `multiply`ï¼‰çš„**ä½¿ç”¨æƒ…å†µ**ã€‚

#### æ­¥éª¤ 2ï¼šæ ‡è®°æœªä½¿ç”¨å¯¼å‡ºï¼ˆUnused Exportsï¼‰
- ä»å…¥å£æ–‡ä»¶å¼€å§‹ï¼Œé€’å½’éå†æ‰€æœ‰**è¢«å¼•ç”¨çš„å¯¼å‡º**ï¼›
- æœªè¢«ä»»ä½•æ¨¡å—å¼•ç”¨çš„å¯¼å‡ºæ ‡è®°ä¸º **"unused harmony export"**ã€‚

#### æ­¥éª¤ 3ï¼šå‹ç¼©é˜¶æ®µç§»é™¤æ­»ä»£ç 
- Webpack æœ¬èº«åªåš**æ ‡è®°**ï¼Œå®é™…åˆ é™¤ç”± **Terserï¼ˆJS å‹ç¼©å™¨ï¼‰** å®Œæˆï¼›
- Terser æ ¹æ®æ ‡è®°ç§»é™¤æœªä½¿ç”¨çš„å‡½æ•°/å˜é‡ã€‚

> ğŸ”‘ **å…³é”®ç‚¹**ï¼š  
> - Webpack è´Ÿè´£**ä¾èµ–åˆ†æ**ï¼›  
> - Terser è´Ÿè´£**ä»£ç åˆ é™¤**ï¼ˆéœ€å¯ç”¨ `minimize: true`ï¼‰ã€‚

---

### ä¸‰ã€å¦‚ä½•ç¡®ä¿ Tree Shaking ç”Ÿæ•ˆï¼Ÿ

#### 1. **ä½¿ç”¨ ES6 æ¨¡å—è¯­æ³•**
```js
// âœ… æ­£ç¡®
import { debounce } from 'lodash-es'; // æ³¨æ„æ˜¯ lodash-esï¼

// âŒ é”™è¯¯ï¼ˆCommonJSï¼‰
const { debounce } = require('lodash');
```

> âš ï¸ **ç¬¬ä¸‰æ–¹åº“æ³¨æ„**ï¼š  
> - ä¼˜å…ˆé€‰æ‹©æä¾› ESM ç‰ˆæœ¬çš„åº“ï¼ˆå¦‚ `lodash-es` è€Œé `lodash`ï¼‰ï¼›  
> - è‹¥åº“åªæœ‰ CommonJSï¼Œå¯é€šè¿‡ `babel-plugin-transform-imports` è½¬æ¢ã€‚

#### 2. **é¿å…å‰¯ä½œç”¨ï¼ˆSide Effectsï¼‰**
- å¦‚æœæ¨¡å—æœ‰**å‰¯ä½œç”¨**ï¼ˆå¦‚ç›´æ¥ä¿®æ”¹å…¨å±€å˜é‡ï¼‰ï¼ŒWebpack ä¼šä¿å®ˆä¿ç•™æ•´ä¸ªæ¨¡å—ï¼›
- **è§£å†³æ–¹æ¡ˆ**ï¼šåœ¨ `package.json` ä¸­å£°æ˜æ— å‰¯ä½œç”¨ï¼š
  ```json
  {
    "name": "my-lib",
    "sideEffects": false
  }
  ```
  æˆ–æŒ‡å®šæœ‰å‰¯ä½œç”¨çš„æ–‡ä»¶ï¼š
  ```json
  {
    "sideEffects": [
      "./src/polyfill.js", // ä¿ç•™æ­¤æ–‡ä»¶
      "*.css"              // ä¿ç•™ CSS æ–‡ä»¶
    ]
  }
  ```

#### 3. **ç”Ÿäº§æ¨¡å¼è‡ªåŠ¨å¯ç”¨**
- Webpack çš„ `mode: 'production'` ä¼šè‡ªåŠ¨ï¼š
  - å¯ç”¨ `optimization.usedExports`ï¼ˆæ ‡è®°æœªä½¿ç”¨å¯¼å‡ºï¼‰ï¼›
  - å¯ç”¨ Terser å‹ç¼©ï¼ˆåˆ é™¤æ­»ä»£ç ï¼‰ã€‚

> âœ… **æ— éœ€é¢å¤–é…ç½®**ï¼Œä½†éœ€ç¡®ä¿ä»£ç ç¬¦åˆ ESM è§„èŒƒã€‚

---

### å››ã€éªŒè¯ Tree Shaking æ˜¯å¦ç”Ÿæ•ˆ

#### æ–¹æ³• 1ï¼šæŸ¥çœ‹æ‰“åŒ…åçš„ä»£ç 
- æœªè¢«ä½¿ç”¨çš„å‡½æ•°**å®Œå…¨æ¶ˆå¤±**ï¼ˆè€Œéæ³¨é‡Šæ‰ï¼‰ã€‚

#### æ–¹æ³• 2ï¼šä½¿ç”¨ `webpack-bundle-analyzer`
```bash
npx webpack-bundle-analyzer dist/main.js
```
- å¯¹æ¯”å¼€å¯/å…³é—­ Tree Shaking çš„ bundle ä½“ç§¯ã€‚

#### æ–¹æ³• 3ï¼šWebpack æ—¥å¿—
- æ·»åŠ  `--stats-verbose` æŸ¥çœ‹æ ‡è®°ä¿¡æ¯ï¼š
  ```bash
  webpack --mode=production --stats-verbose
  ```
  è¾“å‡ºç¤ºä¾‹ï¼š
  ```
  [./src/math.js] 120 bytes {0} [built]
      harmony export [used] add
      harmony export [unused] multiply  // â† æ˜ç¡®æ ‡è®° unused
  ```

---

### äº”ã€å¸¸è§é™·é˜±ä¸è§£å†³æ–¹æ¡ˆ

| é—®é¢˜                 | åŸå›                 | è§£å†³æ–¹æ¡ˆ                                      |
| -------------------- | ------------------- | --------------------------------------------- |
| **æ•´ä¸ªåº“è¢«æ‰“åŒ…**     | åº“ä½¿ç”¨ CommonJS     | æ”¹ç”¨ ESM ç‰ˆæœ¬ï¼ˆå¦‚ `lodash-es`ï¼‰               |
| **æœªä½¿ç”¨å‡½æ•°ä»å­˜åœ¨** | æ¨¡å—æœ‰å‰¯ä½œç”¨        | åœ¨ `package.json` è®¾ç½® `"sideEffects": false` |
| **å¼€å‘ç¯å¢ƒæœªç”Ÿæ•ˆ**   | æœªå‹ç¼©ä»£ç           | Tree Shaking ä»…åœ¨ç”Ÿäº§æ¨¡å¼ç”Ÿæ•ˆï¼ˆéœ€ Terserï¼‰    |
| **åŠ¨æ€è®¿é—®å¯¼å‡º**     | `obj[methodName]()` | é¿å…åŠ¨æ€è°ƒç”¨ï¼Œæ”¹ç”¨é™æ€å¼•ç”¨                    |

---

### å…­ã€ä¸€å¥è¯æ€»ç»“
> **Tree Shaking ä¾èµ– ES Module çš„é™æ€åˆ†æèƒ½åŠ›ï¼Œåœ¨ç”Ÿäº§æ„å»ºä¸­è‡ªåŠ¨ç§»é™¤æœªå¼•ç”¨çš„ä»£ç â€”â€”å®ƒæ˜¯ç°ä»£å‰ç«¯åº”ç”¨â€œç˜¦èº«â€çš„å…³é”®æŠ€æœ¯ï¼Œä½†éœ€å¼€å‘è€…è§„èŒƒä½¿ç”¨ ESM å¹¶å£°æ˜æ— å‰¯ä½œç”¨ã€‚**

## å¦‚ä½•æé«˜webpackçš„æ‰“åŒ…é€Ÿåº¦

æé«˜ Webpack æ‰“åŒ…é€Ÿåº¦æ˜¯å‰ç«¯å·¥ç¨‹åŒ–ä¸­çš„æ ¸å¿ƒä¼˜åŒ–ç‚¹ã€‚ä»¥ä¸‹ä» **é…ç½®ä¼˜åŒ–ã€å·¥å…·å‡çº§ã€ç¼“å­˜ç­–ç•¥ã€æ¶æ„è°ƒæ•´** å››ä¸ªç»´åº¦ï¼Œæä¾› **10+ é¡¹å®æˆ˜æœ‰æ•ˆçš„æé€Ÿæ–¹æ¡ˆ**ï¼ˆåŸºäº Webpack 5ï¼‰ï¼š

---

### ä¸€ã€åŸºç¡€é…ç½®ä¼˜åŒ–ï¼ˆç«‹ç«¿è§å½±ï¼‰

#### 1. **å‡çº§åˆ° Webpack 5 + Node.js 16+**
- Webpack 5 å†…ç½®ï¼š
  - **æŒä¹…åŒ–ç¼“å­˜**ï¼ˆ`cache: { type: 'filesystem' }`ï¼‰ï¼›
  - **æ›´å¥½çš„ Tree Shaking**ï¼›
  - **Asset Modules** æ›¿ä»£ `file-loader` ç­‰ã€‚
- Node.js 16+ V8 å¼•æ“æ€§èƒ½æå‡æ˜¾è‘—ã€‚

#### 2. **å¯ç”¨æŒä¹…åŒ–ç¼“å­˜**
```js
// webpack.config.js
module.exports = {
  cache: {
    type: 'filesystem', // å°†ç¼“å­˜å­˜å‚¨åˆ° node_modules/.cache/webpack
    buildDependencies: {
      config: [__filename] // é…ç½®å˜æ›´æ—¶å¤±æ•ˆç¼“å­˜
    }
  }
};
```
> âœ… **æ•ˆæœ**ï¼šäºŒæ¬¡æ„å»ºé€Ÿåº¦æå‡ **50%~90%**ï¼ˆå°¤å…¶å¤§å‹é¡¹ç›®ï¼‰ã€‚

#### 3. **ç¼©å°æ–‡ä»¶æœç´¢èŒƒå›´**
```js
module.exports = {
  resolve: {
    modules: [path.resolve(__dirname, 'src'), 'node_modules'], // ä¼˜å…ˆæŸ¥ src
    extensions: ['.js', '.jsx'] // å‡å°‘åç¼€å°è¯•
  },
  module: {
    rules: [
      {
        test: /\.js$/,
        include: path.resolve(__dirname, 'src'), // åªç¼–è¯‘ src
        exclude: /node_modules/ // è·³è¿‡ node_modules
      }
    ]
  }
};
```

#### 4. **ä½¿ç”¨æ›´å¿«çš„ Source Mapï¼ˆå¼€å‘ç¯å¢ƒï¼‰**
```js
// å¼€å‘ç¯å¢ƒ
devtool: 'eval-cheap-module-source-map' // æ¯” source-map å¿« 60%
```

---

### äºŒã€Loader ä¸ Plugin ä¼˜åŒ–

#### 5. **å¤šè¿›ç¨‹å¤„ç† JSï¼ˆThread Loaderï¼‰**
```bash
npm install -D thread-loader
```
```js
module.exports = {
  module: {
    rules: [
      {
        test: /\.js$/,
        use: [
          'thread-loader', // å¼€å¯å¤šè¿›ç¨‹
          'babel-loader'
        ]
      }
    ]
  }
};
```
> âš ï¸ **æ³¨æ„**ï¼šå°é¡¹ç›®å¯èƒ½å› è¿›ç¨‹å¼€é”€åè€Œå˜æ…¢ï¼Œå»ºè®® > 50 ä¸ªæ–‡ä»¶å†å¯ç”¨ã€‚

#### 6. **ä¼˜åŒ– Babel ç¼–è¯‘**
- **ä»…ç¼–è¯‘å¿…è¦ä»£ç **ï¼š
  ```js
  // babel.config.js
  module.exports = {
    presets: [
      ['@babel/preset-env', {
        targets: '> 0.25%, not dead', // æŒ‰éœ€ polyfill
        useBuiltIns: 'usage',
        corejs: 3
      }]
    ]
  };
  ```
- **å¯ç”¨ç¼“å­˜**ï¼š
  ```js
  // webpack.config.js
  {
    loader: 'babel-loader',
    options: { cacheDirectory: true } // ç¼“å­˜ç¼–è¯‘ç»“æœ
  }
  ```

#### 7. **é¿å…é‡å¤ Plugin**
- ç§»é™¤ `HotModuleReplacementPlugin`ï¼ˆWebpack 5 Dev Server å·²å†…ç½®ï¼‰ï¼›
- åˆå¹¶åŠŸèƒ½é‡å çš„æ’ä»¶ï¼ˆå¦‚ `MiniCssExtractPlugin` å·²åŒ…å« CSS æå–ï¼‰ã€‚

---

### ä¸‰ã€é«˜çº§ä¼˜åŒ–ç­–ç•¥

#### 8. **DLLï¼ˆåŠ¨æ€é“¾æ¥åº“ï¼‰é¢„æ„å»ºï¼ˆé€‚ç”¨äºç¨³å®šä¾èµ–ï¼‰**
- **åŸç†**ï¼šå°† `react`, `lodash` ç­‰ä¸å¸¸å˜åŠ¨çš„åº“**æå‰æ‰“åŒ…**ï¼Œåç»­æ„å»ºè·³è¿‡ã€‚
- **æ­¥éª¤**ï¼š
  1. åˆ›å»º `webpack.dll.js` é¢„æ„å»º vendorï¼›
  2. ä¸»é…ç½®é€šè¿‡ `DllReferencePlugin` å¼•ç”¨ã€‚
- **æ•ˆæœ**ï¼šå¤§å‹é¡¹ç›®æ„å»ºæ—¶é—´å‡å°‘ **30%~50%**ã€‚
> ğŸ’¡ **ç°ä»£æ›¿ä»£æ–¹æ¡ˆ**ï¼šWebpack 5 çš„ `cache` + `SplitChunks` å·²å¤§å¹…é™ä½ DLL å¿…è¦æ€§ã€‚

#### 9. **æŒ‰éœ€åŠ è½½ç¬¬ä¸‰æ–¹åº“**
- **é—®é¢˜**ï¼š`import _ from 'lodash'` ä¼šæ‰“åŒ…æ•´ä¸ªåº“ï¼›
- **è§£å†³æ–¹æ¡ˆ**ï¼š
  ```js
  // æ”¹ä¸ºæŒ‰éœ€å¼•å…¥
  import debounce from 'lodash/debounce';
  
  // æˆ–ä½¿ç”¨ babel-plugin-lodash è‡ªåŠ¨è½¬æ¢
  ```

#### 10. **ç›‘æ§ä¸åˆ†æ**
- **å®šä½ç“¶é¢ˆ**ï¼š
  ```bash
  # è¾“å‡ºå„é˜¶æ®µè€—æ—¶
  webpack --profile --json > stats.json
  
  # å¯è§†åŒ–åˆ†æ
  npx webpack-bundle-analyzer stats.json
  npx speed-measure-webpack-plugin
  ```
- **å…³é”®æŒ‡æ ‡**ï¼š
  - `resolve` è€—æ—¶ â†’ ä¼˜åŒ– `resolve.modules`ï¼›
  - `build` è€—æ—¶ â†’ ä¼˜åŒ– Loaderï¼›
  - `seal` è€¶æ—¶ â†’ ä¼˜åŒ– SplitChunksã€‚

---

### å››ã€æ¶æ„çº§ä¼˜åŒ–ï¼ˆé•¿æœŸæ”¶ç›Šï¼‰

| æ–¹æ¡ˆ                        | è¯´æ˜                                              |
| --------------------------- | ------------------------------------------------- |
| **å¾®å‰ç«¯æ‹†åˆ†**              | å°†å·¨å‹åº”ç”¨æ‹†åˆ†ä¸ºç‹¬ç«‹å­åº”ç”¨ï¼Œå„è‡ªæ„å»º              |
| **Monorepo + Nx/Turborepo** | åˆ©ç”¨ä»»åŠ¡ç®¡é“å’Œç¼“å­˜åŠ é€Ÿå¤šåŒ…é¡¹ç›®                    |
| **Vite/Rollup æ›¿ä»£**        | å¼€å‘ç¯å¢ƒç”¨ Viteï¼ˆESM åŸç”ŸåŠ è½½ï¼‰ï¼Œç”Ÿäº§ä»ç”¨ Webpack |

---

### äº”ã€é¿å‘æŒ‡å—

- âŒ **ä¸è¦è¿‡åº¦åˆ†å‰² Chunk**ï¼šHTTP/2 ä¸‹è¿‡å¤šå°æ–‡ä»¶åè€Œå¢åŠ è°ƒåº¦å¼€é”€ï¼›
- âŒ **é¿å… inline Source Map**ï¼š`inline-source-map` ä¼šå¢å¤§ bundle ä½“ç§¯ï¼›
- âœ… **å¼€å‘/ç”Ÿäº§é…ç½®åˆ†ç¦»**ï¼šç”¨ `webpack-merge` æ‹†åˆ†é…ç½®ï¼Œé¿å…å†—ä½™é€»è¾‘ã€‚

---

### å…­ã€æ•ˆæœå¯¹æ¯”ï¼ˆå…¸å‹é¡¹ç›®ï¼‰

| ä¼˜åŒ–å‰        | ä¼˜åŒ–å        | æå‡  |
| ------------- | ------------- | ----- |
| é¦–æ¬¡æ„å»ºï¼š45s | é¦–æ¬¡æ„å»ºï¼š30s | â†“ 33% |
| äºŒæ¬¡æ„å»ºï¼š22s | äºŒæ¬¡æ„å»ºï¼š3s  | â†“ 86% |

---

### ä¸€å¥è¯æ€»ç»“
> **æé€Ÿæ ¸å¿ƒ = ç¼“å­˜ï¼ˆæŒä¹…åŒ–ï¼‰ + å¹¶è¡Œï¼ˆå¤šè¿›ç¨‹ï¼‰ + ç²¾ç®€ï¼ˆç¼©å°èŒƒå›´ï¼‰ + ç›‘æ§ï¼ˆç²¾å‡†ä¼˜åŒ–ï¼‰â€”â€”ä¼˜å…ˆå¯ç”¨ Webpack 5 ç¼“å­˜ï¼Œå†é’ˆå¯¹æ€§ä¼˜åŒ– Loader å’Œä¾èµ–ã€‚**

## å¦‚ä½•å‡å°‘æ‰“åŒ…åçš„ä»£ç ä½“ç§¯

å‡å°‘ Webpack æ‰“åŒ…åçš„ä»£ç ä½“ç§¯ï¼ˆBundle Sizeï¼‰æ˜¯æå‡ Web åº”ç”¨**åŠ è½½é€Ÿåº¦ã€ç”¨æˆ·ä½“éªŒå’Œ SEO è¡¨ç°**çš„å…³é”®ã€‚ä»¥ä¸‹æ˜¯ **ç³»ç»ŸåŒ–ã€å¯è½åœ°çš„ä¼˜åŒ–ç­–ç•¥**ï¼Œæ¶µç›–é…ç½®ã€ä»£ç ã€ä¾èµ–å’Œæ¶æ„å±‚é¢ï¼š

---

### ä¸€ã€å¯ç”¨ç”Ÿäº§æ¨¡å¼ï¼ˆåŸºç¡€ä½†å…³é”®ï¼‰
```js
// webpack.config.js
module.exports = {
  mode: 'production' // è‡ªåŠ¨å¯ç”¨ï¼šä»£ç å‹ç¼©ã€Tree Shakingã€ä½œç”¨åŸŸæå‡
};
```
> âœ… **æ•ˆæœ**ï¼šé»˜è®¤å¼€å¯ Terser å‹ç¼© + ç§»é™¤ `process.env.NODE_ENV !== 'production'` çš„ä»£ç ã€‚

---

### äºŒã€ä»£ç åˆ†å‰²ï¼ˆCode Splittingï¼‰

#### 1. **è‡ªåŠ¨åˆ†å‰²å…¬å…±ä»£ç **
```js
// webpack.config.js
optimization: {
  splitChunks: {
    chunks: 'all',
    cacheGroups: {
      vendor: {
        test: /[\\/]node_modules[\\/]/,
        name: 'vendors',
        chunks: 'all'
      }
    }
  }
}
```
> âœ… **æ•ˆæœ**ï¼šåˆ†ç¦»ç¬¬ä¸‰æ–¹åº“ï¼ˆå¦‚ Reactï¼‰ï¼Œåˆ©ç”¨é•¿æœŸç¼“å­˜ã€‚

#### 2. **è·¯ç”±/ç»„ä»¶æ‡’åŠ è½½**
```js
// React
const Home = React.lazy(() => import('./Home'));

// Vue
const About = () => import('./About.vue');
```
> âœ… **æ•ˆæœ**ï¼šé¦–å±ä»…åŠ è½½å¿…è¦ä»£ç ï¼Œä½“ç§¯å‡å°‘ 30%~70%ã€‚

---

### ä¸‰ã€Tree Shakingï¼ˆç§»é™¤æ­»ä»£ç ï¼‰

#### å…³é”®å‰æï¼š
- ä½¿ç”¨ **ES6 æ¨¡å—**ï¼ˆ`import`/`export`ï¼‰ï¼›
- ç¬¬ä¸‰æ–¹åº“æä¾› **ESM ç‰ˆæœ¬**ï¼ˆå¦‚ `lodash-es` è€Œé `lodash`ï¼‰ï¼›
- åœ¨ `package.json` å£°æ˜æ— å‰¯ä½œç”¨ï¼š
  ```json
  {
    "sideEffects": false
  }
  ```

> âœ… **æ•ˆæœ**ï¼šæœªä½¿ç”¨çš„å‡½æ•°/ç»„ä»¶å½»åº•ä» bundle ä¸­ç§»é™¤ã€‚

---

### å››ã€ä¼˜åŒ–ç¬¬ä¸‰æ–¹ä¾èµ–

#### 1. **æŒ‰éœ€å¼•å…¥**
```js
// âŒ å…¨é‡å¼•å…¥ï¼ˆæ‰“åŒ…æ•´ä¸ªåº“ï¼‰
import { debounce } from 'lodash';

// âœ… æŒ‰éœ€å¼•å…¥ï¼ˆä»…æ‰“åŒ… debounceï¼‰
import debounce from 'lodash/debounce';
```

#### 2. **æ›¿æ¢è½»é‡çº§æ›¿ä»£å“**
| åŸåº“               | è½»é‡æ›¿ä»£                            |
| ------------------ | ----------------------------------- |
| `moment.js` (70KB) | `date-fns` (æ¨¡å—åŒ–) / `dayjs` (2KB) |
| `lodash` (24KB)    | `lodash-es` + æŒ‰éœ€å¼•å…¥ / `radash`   |
| `axios` (13KB)     | åŸç”Ÿ `fetch` + å°è£…                 |

#### 3. **åˆ†æä¾èµ–ä½“ç§¯**
```bash
# å®‰è£…åˆ†æå·¥å…·
npm install -D webpack-bundle-analyzer

# ç”Ÿæˆå¯è§†åŒ–æŠ¥å‘Š
npx webpack-bundle-analyzer dist/main.js
```
> ğŸ” **å®šä½é—®é¢˜**ï¼šå‘ç°æ„å¤–æ‰“åŒ…çš„å¤§ä¾èµ–ï¼ˆå¦‚ `@babel/polyfill`ï¼‰ã€‚

---

### äº”ã€èµ„æºä¼˜åŒ–

#### 1. **å‹ç¼©å›¾ç‰‡/å­—ä½“**
```js
// webpack.config.js
module.exports = {
  module: {
    rules: [
      {
        test: /\.(png|jpg|svg)$/,
        type: 'asset',
        parser: {
          dataUrlCondition: { maxSize: 8 * 1024 } // <8KB è½¬ base64
        }
      }
    ]
  }
};
```
> âœ… **é…åˆå·¥å…·**ï¼š`imagemin-webpack-plugin` è¿›ä¸€æ­¥å‹ç¼©å›¾ç‰‡ã€‚

#### 2. **ç§»é™¤æœªä½¿ç”¨ CSS**
- ä½¿ç”¨ `PurgeCSS`ï¼ˆé…åˆ `mini-css-extract-plugin`ï¼‰ï¼š
  ```js
  // postcss.config.js
  module.exports = {
    plugins: [
      require('purgecss')({
        content: ['./src/**/*.html', './src/**/*.{js,jsx}']
      })
    ]
  };
  ```
> âœ… **æ•ˆæœ**ï¼šTailwind CSS é¡¹ç›®ä½“ç§¯å‡å°‘ 90%ã€‚

---

### å…­ã€é«˜çº§æŠ€å·§

#### 1. **åŠ¨æ€ Polyfill**
- é¿å…å…¨é‡å¼•å…¥ `core-js`ï¼š
  ```js
  // babel.config.js
  presets: [
    ['@babel/preset-env', {
      useBuiltIns: 'usage', // æŒ‰éœ€æ³¨å…¥ polyfill
      corejs: 3
    }]
  ]
  ```
- æˆ–ä½¿ç”¨ [Polyfill.io](https://polyfill.io/) æŒ‰æµè§ˆå™¨éœ€æ±‚åŠ è½½ã€‚

#### 2. **Gzip/Brotli å‹ç¼©**
- Webpack ç”Ÿæˆæ–‡ä»¶åï¼Œé€šè¿‡æœåŠ¡å™¨æˆ–æ’ä»¶å‹ç¼©ï¼š
  ```js
  // webpack.config.js
  const CompressionPlugin = require('compression-webpack-plugin');
  
  plugins: [
    new CompressionPlugin({ algorithm: 'gzip' })
  ]
  ```
> âœ… **æ•ˆæœ**ï¼šæ–‡æœ¬èµ„æºä½“ç§¯å‡å°‘ 70%ï¼ˆéœ€ Nginx/Apache å¯ç”¨ gzipï¼‰ã€‚

#### 3. **ä»£ç æ‹†åˆ† + é¢„åŠ è½½**
```js
// å…³é”®è·¯ç”±é¢„åŠ è½½ï¼ˆç©ºé—²æ—¶åŠ è½½ï¼‰
const Profile = React.lazy(() => 
  import(/* webpackPreload: true */ './Profile')
);
```

---

### ä¸ƒã€é¿å‘æŒ‡å—

| é™·é˜±                        | è§£å†³æ–¹æ¡ˆ                                             |
| --------------------------- | ---------------------------------------------------- |
| **å¼€å‘ç¯å¢ƒæœª Tree Shaking** | ç¡®ä¿ç”Ÿäº§æ„å»ºï¼ˆ`mode: 'production'`ï¼‰                 |
| **CSS æœªæå–**              | ç”¨ `MiniCssExtractPlugin` æ›¿ä»£ `style-loader`        |
| **Source Map æ³„éœ²**         | ç”Ÿäº§ç¯å¢ƒç§»é™¤ `.map` æ–‡ä»¶æˆ–è®¾ä¸º `hidden-source-map`   |
| **é‡å¤ä¾èµ–**                | ç”¨ `npm ls lodash` æ£€æŸ¥å¤šç‰ˆæœ¬ï¼Œç”¨ `resolutions` é”å®š |

---

### å…«ã€æ•ˆæœéªŒè¯
1. **é‡åŒ–æŒ‡æ ‡**ï¼š
   - é¦–å± JS ä½“ç§¯ < 200KBï¼ˆå‹ç¼©åï¼‰ï¼›
   - Lighthouse Performance Score > 90ã€‚
2. **ç›‘æ§å·¥å…·**ï¼š
   - Webpack Bundle Analyzerï¼›
   - Chrome DevTools Coverage Tabï¼ˆæ£€æµ‹æœªæ‰§è¡Œä»£ç ï¼‰ã€‚

---

### ä¸€å¥è¯æ€»ç»“
> **å‡å° bundle ä½“ç§¯ = åˆ†å‰²ï¼ˆCode Splittingï¼‰ + æ¸…ç†ï¼ˆTree Shaking + PurgeCSSï¼‰ + æ›¿æ¢ï¼ˆè½»é‡ä¾èµ–ï¼‰ + å‹ç¼©ï¼ˆTerser + Gzipï¼‰â€”â€”å…ˆåˆ†æï¼Œå†ç²¾å‡†ä¼˜åŒ–ã€‚**

## vite æ¯” webpack å¿«åœ¨å“ªé‡Œ

Vite ä¹‹æ‰€ä»¥æ¯” Webpack **å¿«ä¸€ä¸ªæ•°é‡çº§**ï¼ˆå°¤å…¶åœ¨å¤§å‹é¡¹ç›®ä¸­ï¼‰ï¼Œæ ¸å¿ƒåœ¨äºå®ƒ**å½»åº•é‡æ„äº†å¼€å‘æœåŠ¡å™¨çš„æ„å»ºæ¨¡å‹**ï¼Œä»â€œæ‰“åŒ…åè¿è¡Œâ€å˜ä¸ºâ€œæŒ‰éœ€ç¼–è¯‘ + åŸç”Ÿ ESM åŠ è½½â€ã€‚ä»¥ä¸‹æ˜¯å…³é”®å·®å¼‚å’ŒåŸç†è¯¦è§£ï¼š

---

### ä¸€ã€æ ¹æœ¬åŒºåˆ«ï¼šå¼€å‘æ¨¡å¼æ¶æ„

| ç‰¹æ€§               | **Webpack (ä¼ ç»Ÿ)**                   | **Vite (ç°ä»£)**                                |
| ------------------ | ------------------------------------ | ---------------------------------------------- |
| **å¼€å‘æœåŠ¡å™¨å¯åŠ¨** | å…ˆå…¨é‡æ‰“åŒ… â†’ å†å¯åŠ¨æœåŠ¡              | **ç§’çº§å¯åŠ¨**ï¼ˆæ— éœ€æ‰“åŒ…ï¼‰                       |
| **æ¨¡å—åŠ è½½æ–¹å¼**   | æ‰“åŒ…æˆå•ä¸ª/å¤šä¸ª bundle               | **åŸç”Ÿæµè§ˆå™¨ ESM**ï¼ˆ`<script type="module">`ï¼‰ |
| **ä»£ç æ›´æ–°**       | æ•´ä½“é‡ç¼–è¯‘ + HMR                     | **æŒ‰éœ€ç¼–è¯‘ + ç²¾å‡† HMR**                        |
| **ä¾èµ–å¤„ç†**       | æ‰€æœ‰ä»£ç ï¼ˆå« node_modulesï¼‰èµ° Loader | **é¢„æ„å»ºä¾èµ–**ï¼ˆESM å…¼å®¹åŒ–ï¼‰                   |

> âœ… **Vite çš„æ ¸å¿ƒæ€æƒ³**ï¼š  
> **â€œå¼€å‘ç¯å¢ƒä¸æ‰“åŒ…ï¼Œåˆ©ç”¨æµè§ˆå™¨åŸç”Ÿ ESM èƒ½åŠ›ï¼›ä»…å¯¹æºç åšæŒ‰éœ€è½¬æ¢ã€‚â€**

---

### äºŒã€Vite å¿«çš„ä¸‰å¤§æ ¸å¿ƒæŠ€æœ¯

#### 1. **ç§’çº§å†·å¯åŠ¨ï¼šè·³è¿‡æ‰“åŒ…**
- **Webpack**ï¼š  
  å¯åŠ¨æ—¶éœ€é€’å½’è§£ææ‰€æœ‰æ¨¡å— â†’ è°ƒç”¨ Babel/TypeScript ç¼–è¯‘ â†’ ç”Ÿæˆ bundle â†’ å¯åŠ¨ Dev Serverï¼ˆå¤§å‹é¡¹ç›®è€—æ—¶ 30s+ï¼‰ã€‚
  
- **Vite**ï¼š  
  - å¯åŠ¨æ—¶**åªæ‰«æ `index.html` å’Œç›´æ¥ä¾èµ–**ï¼›
  - æµè§ˆå™¨è¯·æ±‚ `/src/main.js` æ—¶ï¼ŒVite **å®æ—¶ç¼–è¯‘è¯¥æ–‡ä»¶**å¹¶è¿”å›ï¼›
  - **æ— å…¨é‡æ„å»ºè¿‡ç¨‹** â†’ å¯åŠ¨é€Ÿåº¦ä¸é¡¹ç›®å¤§å°**å‡ ä¹æ— å…³**ï¼ˆé€šå¸¸ < 500msï¼‰ã€‚

#### 2. **åŸç”Ÿ ESMï¼šé›¶æ‰“åŒ…ä¾èµ–**
- **æµè§ˆå™¨ç›´æ¥åŠ è½½**ï¼š
  ```html
  <!-- Vite ç”Ÿæˆçš„ index.html -->
  <script type="module" src="/src/main.js"></script>
  ```
- å½“æµè§ˆå™¨é‡åˆ° `import { foo } from './utils.js'`ï¼š
  - è‡ªåŠ¨å‘èµ· HTTP è¯·æ±‚ `/src/utils.js`ï¼›
  - Vite æ‹¦æˆªè¯·æ±‚ â†’ å®æ—¶ç¼–è¯‘ TS/JSX â†’ è¿”å›åˆæ³• ESMã€‚
- **ä¼˜åŠ¿**ï¼š  
  - æ— éœ€åˆå¹¶æ¨¡å—ï¼›
  - æ— ä½œç”¨åŸŸæå‡ã€æ¨¡å—åŒ…è£…ç­‰å¼€é”€ã€‚

#### 3. **æ™ºèƒ½ä¾èµ–é¢„æ„å»ºï¼ˆPre-bundlingï¼‰**
- **é—®é¢˜**ï¼š  
  `node_modules` ä¸­çš„åº“å¤šä¸º CommonJS æˆ–é ESM æ ¼å¼ï¼Œæµè§ˆå™¨æ— æ³•ç›´æ¥è¿è¡Œã€‚
  
- **Vite è§£å†³æ–¹æ¡ˆ**ï¼š  
  1. å¯åŠ¨æ—¶ç”¨ **esbuild**ï¼ˆGo ç¼–å†™ï¼Œæ¯” JS å¿« 10~100 å€ï¼‰æ‰«æä¾èµ–ï¼›
  2. å°† CommonJS / UMD åº“è½¬æ¢ä¸º **å•ä¸ª ESM æ–‡ä»¶**ï¼ˆå¦‚ `vue.js` â†’ `vue.esm-browser.js`ï¼‰ï¼›
  3. ç¼“å­˜ç»“æœï¼ˆ`node_modules/.vite/deps`ï¼‰ï¼Œåç»­å¯åŠ¨ç›´æ¥å¤ç”¨ã€‚
  
- **æ•ˆæœ**ï¼š  
  - é¦–æ¬¡å¯åŠ¨ç¨æ…¢ï¼ˆå› é¢„æ„å»ºï¼‰ï¼Œä½†åç»­å¯åŠ¨æå¿«ï¼›
  - è¿è¡Œæ—¶ä¾èµ–é€šè¿‡å•ä¸ª HTTP è¯·æ±‚åŠ è½½ï¼ˆè€Œéæ•°ç™¾ä¸ªï¼‰ã€‚

> ğŸ”‘ **esbuild çš„å¨åŠ›**ï¼š  
> Vite ç”¨ esbuild é¢„æ„å»ºä¾èµ–ï¼ˆå¿«ï¼‰ï¼Œè€Œ Webpack ç”¨ JS ç¼–å†™çš„ Babel/Terser å¤„ç†æ‰€æœ‰ä»£ç ï¼ˆæ…¢ï¼‰ã€‚

---

### ä¸‰ã€HMRï¼ˆçƒ­æ›´æ–°ï¼‰æ€§èƒ½ç¢¾å‹

| åœºæ™¯             | Webpack                                        | Vite                                              |
| ---------------- | ---------------------------------------------- | ------------------------------------------------- |
| **æ›´æ–°ä¸€ä¸ªç»„ä»¶** | 1. é‡æ–°ç¼–è¯‘æ•´ä¸ªä¾èµ–é“¾<br>2. é€šçŸ¥å®¢æˆ·ç«¯é‡è½½æ¨¡å— | 1. **ä»…ç¼–è¯‘è¯¥æ–‡ä»¶**<br>2. é€šè¿‡ WebSocket ç²¾å‡†æ›´æ–° |
| **æ›´æ–°æ—¶é—´**     | 500ms ~ 2sï¼ˆéšé¡¹ç›®å¢å¤§ï¼‰                       | **< 50ms**ï¼ˆæ’å®šï¼‰                                |
| **çŠ¶æ€ä¿ç•™**     | éœ€æ¡†æ¶æ’ä»¶æ”¯æŒ                                 | åŸç”Ÿæ”¯æŒï¼ˆESM æ¨¡å—å¯ç²¾ç¡®æ›¿æ¢ï¼‰                    |

> ğŸ’¡ **åŸå› **ï¼š  
> Webpack çš„ HMR éœ€éå†æ¨¡å—ä¾èµ–å›¾ç¡®å®šå½±å“èŒƒå›´ï¼›  
> Vite ç›´æ¥æ˜ å°„æ–‡ä»¶è·¯å¾„åˆ°æµè§ˆå™¨æ¨¡å—ï¼Œæ›´æ–°è·¯å¾„å”¯ä¸€ã€‚

---

### å››ã€ç”Ÿäº§æ„å»ºï¼šVite ä¹Ÿä¸å¼±

- **å¼€å‘ç”¨ Viteï¼Œç”Ÿäº§ç”¨ Rollup**ï¼š  
  Vite ç”Ÿäº§æ„å»ºåŸºäº **Rollup**ï¼ˆæ›´ç®€æ´çš„æ‰“åŒ…å™¨ï¼‰ï¼Œé»˜è®¤å¼€å¯ï¼š
  - Code Splitting
  - Tree Shaking
  - å‹ç¼©ï¼ˆterserï¼‰
- **ç»“æœ**ï¼šç”Ÿäº§åŒ…ä½“ç§¯ä¸ Webpack ç›¸å½“ï¼Œç”šè‡³æ›´ä¼˜ï¼ˆRollup çš„ Tree Shaking æ›´æ¿€è¿›ï¼‰ã€‚

---

### äº”ã€å¯¹æ¯”æ€»ç»“è¡¨

| ç»´åº¦             | Webpack                  | Vite                         |
| ---------------- | ------------------------ | ---------------------------- |
| **å¼€å‘å¯åŠ¨é€Ÿåº¦** | æ…¢ï¼ˆO(n)ï¼‰               | æå¿«ï¼ˆO(1)ï¼‰                 |
| **HMR é€Ÿåº¦**     | éšé¡¹ç›®å¢å¤§å˜æ…¢           | æ’å®šå¿«é€Ÿ                     |
| **é…ç½®å¤æ‚åº¦**   | é«˜ï¼ˆLoader/Plugin ä½“ç³»ï¼‰ | ä½ï¼ˆçº¦å®šä¼˜äºé…ç½®ï¼‰           |
| **é€‚ç”¨åœºæ™¯**     | å¤æ‚å®šåˆ¶éœ€æ±‚ã€æ—§é¡¹ç›®     | æ–°é¡¹ç›®ã€è¿½æ±‚å¼€å‘ä½“éªŒ         |
| **ç”Ÿæ€**         | æ’ä»¶ä¸°å¯Œï¼ˆ10å¹´ç§¯ç´¯ï¼‰     | å¿«é€Ÿè¿½èµ¶ï¼ˆå…¼å®¹ Rollup æ’ä»¶ï¼‰ |

---

### å…­ã€ä½•æ—¶ä»é€‰ Webpackï¼Ÿ
- éœ€è¦æ·±åº¦å®šåˆ¶æ„å»ºæµç¨‹ï¼ˆå¦‚å¾®å‰ç«¯æ²™ç®±ï¼‰ï¼›
- é¡¹ç›®é‡åº¦ä¾èµ– Webpack ç‰¹æœ‰æ’ä»¶ï¼ˆå¦‚ `Module Federation`ï¼‰ï¼›
- å¿…é¡»æ”¯æŒ IE11ï¼ˆVite ä¸æ”¯æŒï¼‰ã€‚

---

### ä¸€å¥è¯æ€»ç»“
> **Vite å¿«åœ¨â€œä¸æ‰“åŒ…â€â€”â€”åˆ©ç”¨æµè§ˆå™¨åŸç”Ÿ ESM èƒ½åŠ›ï¼ŒæŒ‰éœ€ç¼–è¯‘æºç  + esbuild é¢„æ„å»ºä¾èµ–ï¼Œå½»åº•ç»•è¿‡ä¼ ç»Ÿæ‰“åŒ…å™¨çš„æ€§èƒ½ç“¶é¢ˆã€‚**

## è¯´ä¸€ä¸‹ä½ å¯¹ Monorepo çš„ç†è§£

**Monorepoï¼ˆå•ä½“ä»“åº“ï¼‰** æ˜¯ä¸€ç§è½¯ä»¶å¼€å‘çš„æºç ç®¡ç†ç­–ç•¥ï¼š**å°†å¤šä¸ªç›¸å…³é¡¹ç›®ï¼ˆå¦‚å¤šä¸ªåŒ…ã€åº”ç”¨ã€æœåŠ¡ï¼‰æ”¾åœ¨åŒä¸€ä¸ªä»£ç ä»“åº“ä¸­è¿›è¡Œç»Ÿä¸€ç®¡ç†**ï¼Œè€Œä¸æ˜¯ä¸ºæ¯ä¸ªé¡¹ç›®å•ç‹¬åˆ›å»ºä¸€ä¸ªä»“åº“ï¼ˆå³ Multirepo / Polyrepoï¼‰ã€‚

---

### ä¸€ã€æ ¸å¿ƒæ€æƒ³
> **â€œé€»è¾‘åˆ†ç¦»ï¼Œç‰©ç†é›†ä¸­â€**  
> è™½ç„¶ä»£ç åœ¨åŒä¸€ä¸ª Git ä»“åº“é‡Œï¼Œä½†é€šè¿‡å·¥å…·å’Œè§„èŒƒä¿æŒå„å­é¡¹ç›®çš„**ç‹¬ç«‹æ€§ã€å¯å¤ç”¨æ€§å’Œå¯å‘å¸ƒæ€§**ã€‚

#### å…¸å‹ç»“æ„ç¤ºä¾‹ï¼š
```bash
my-monorepo/
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ shared-utils/      # å…±äº«å·¥å…·åº“ï¼ˆå¯ç‹¬ç«‹å‘å¸ƒï¼‰
â”‚   â”œâ”€â”€ ui-components/     # React ç»„ä»¶åº“
â”‚   â”œâ”€â”€ web-app/           # ä¸» Web åº”ç”¨
â”‚   â””â”€â”€ mobile-app/        # React Native åº”ç”¨
â”œâ”€â”€ tools/                 # æ„å»º/éƒ¨ç½²è„šæœ¬
â”œâ”€â”€ package.json
â””â”€â”€ pnpm-workspace.yaml    # æˆ– lerna.json, nx.json
```

---

### äºŒã€Monorepo çš„æ ¸å¿ƒä¼˜åŠ¿

#### âœ… 1. **è·¨é¡¹ç›®åä½œæ›´é«˜æ•ˆ**
- ä¿®æ”¹ `shared-utils` åï¼Œ**ç«‹å³åœ¨ `web-app` å’Œ `mobile-app` ä¸­éªŒè¯æ•ˆæœ**ï¼›
- é¿å… Multirepo ä¸­â€œæ”¹ A â†’ å‘ç‰ˆ â†’ å‡çº§ B â†’ æµ‹è¯• â†’ å‘ç°é—®é¢˜ â†’ å›æ»šâ€çš„ç¹çæµç¨‹ã€‚

#### âœ… 2. **åŸå­åŒ–æäº¤ï¼ˆAtomic Commitsï¼‰**
- ä¸€æ¬¡æäº¤å¯åŒæ—¶ä¿®æ”¹å¤šä¸ªåŒ…ï¼ˆå¦‚æ¥å£å˜æ›´ + å‰ç«¯è°ƒç”¨ + åç«¯å®ç°ï¼‰ï¼›
- ä¿è¯ç³»ç»Ÿæ•´ä½“ä¸€è‡´æ€§ï¼Œé¿å…ç‰ˆæœ¬é”™é…ã€‚

#### âœ… 3. **ç»Ÿä¸€æŠ€æœ¯æ ˆä¸è§„èŒƒ**
- å…±äº« ESLintã€TypeScriptã€Babelã€æµ‹è¯•é…ç½®ï¼›
- å¼ºåˆ¶ä»£ç é£æ ¼ã€ä¾èµ–ç‰ˆæœ¬ä¸€è‡´ï¼ˆé€šè¿‡ `pnpm overrides` æˆ– `yarn resolutions`ï¼‰ã€‚

#### âœ… 4. **ä¾èµ–ç®¡ç†ä¼˜åŒ–**
- **å•ä¸€ `node_modules`**ï¼ˆä½¿ç”¨ pnpm / Yarn Workspacesï¼‰ï¼š
  - å‡å°‘ç£ç›˜å ç”¨ï¼ˆç›¸åŒä¾èµ–åªå®‰è£…ä¸€æ¬¡ï¼‰ï¼›
  - æ¶ˆé™¤â€œä¾èµ–åœ°ç‹±â€ï¼ˆä¸åŒåŒ…ä¾èµ–åŒä¸€åº“çš„ä¸åŒç‰ˆæœ¬ï¼‰ã€‚

#### âœ… 5. **ç®€åŒ– CI/CD ä¸è‡ªåŠ¨åŒ–**
- ä¸€æ¬¡ PR å¯è§¦å‘æ‰€æœ‰å—å½±å“é¡¹ç›®çš„æµ‹è¯•ï¼›
- å·¥å…·ï¼ˆå¦‚ Nxã€Turborepoï¼‰èƒ½**æ™ºèƒ½è®¡ç®—å½±å“èŒƒå›´**ï¼Œåªæ„å»º/æµ‹è¯•å˜æ›´ç›¸å…³çš„åŒ…ã€‚

---

### ä¸‰ã€Monorepo çš„æŒ‘æˆ˜ä¸åº”å¯¹

| æŒ‘æˆ˜              | è§£å†³æ–¹æ¡ˆ                                  |
| ----------------- | ----------------------------------------- |
| **ä»“åº“ä½“ç§¯è†¨èƒ€**  | ä½¿ç”¨ `.gitignore` + å·¥å…·ï¼ˆå¦‚ Nxï¼‰æŒ‰éœ€å…‹éš† |
| **æƒé™æ§åˆ¶å›°éš¾**  | Git å­ç›®å½•æƒé™ï¼ˆGitHub CODEOWNERSï¼‰       |
| **æ„å»º/æµ‹è¯•å˜æ…¢** | **å¢é‡æ„å»º**ï¼ˆNx/Turborepo ç¼“å­˜ï¼‰         |
| **å‘å¸ƒæµç¨‹å¤æ‚**  | è‡ªåŠ¨åŒ–è¯­ä¹‰åŒ–å‘å¸ƒï¼ˆChangesets, Lernaï¼‰     |
| **å›¢é˜Ÿè®¤çŸ¥è´Ÿæ‹…**  | æ¸…æ™°æ–‡æ¡£ + ç›®å½•è§„èŒƒ + å·¥å…·è„šæ‰‹æ¶          |

---

### å››ã€ä¸»æµ Monorepo å·¥å…·å¯¹æ¯”

| å·¥å…·                  | ç‰¹ç‚¹                             | é€‚ç”¨åœºæ™¯                              |
| --------------------- | -------------------------------- | ------------------------------------- |
| **pnpm + Workspaces** | è½»é‡ã€åŸç”Ÿæ”¯æŒã€ä¾èµ–æ‰å¹³åŒ–       | ç®€å•å…±äº«ä¾èµ–                          |
| **Yarn Workspaces**   | ç”Ÿæ€æˆç†Ÿã€ä¸ Yarn æ·±åº¦é›†æˆ       | å·²ä½¿ç”¨ Yarn çš„é¡¹ç›®                    |
| **Lerna**             | ä¸“æ³¨åŒ…ç®¡ç†ï¼ˆå‘å¸ƒ/ç‰ˆæœ¬ï¼‰          | å¤š npm åŒ…ç»´æŠ¤                         |
| **Nx**                | æ™ºèƒ½ä»»åŠ¡è°ƒåº¦ã€è¿œç¨‹ç¼“å­˜ã€æ’ä»¶ç”Ÿæ€ | å¤§å‹å…¨æ ˆé¡¹ç›®ï¼ˆReact + Node + NestJSï¼‰ |
| **Turborepo**         | æé€Ÿå¢é‡æ„å»ºã€äº‘ç¼“å­˜ã€ç®€å•é…ç½®   | Vite/Next.js ç­‰ç°ä»£æ¡†æ¶               |

> ğŸ’¡ **è¶‹åŠ¿**ï¼š  
> æ–°é¡¹ç›®æ¨è **pnpm + Turborepo/Nx** â€”â€” pnpm è§£å†³ä¾èµ–ï¼ŒTurborepo/Nx è§£å†³ä»»åŠ¡ç¼–æ’ã€‚

---

### äº”ã€å…¸å‹åº”ç”¨åœºæ™¯

1. **ç»„ä»¶åº“ + åº”ç”¨**  
   - å¦‚ï¼š`@myorg/ui` ç»„ä»¶åº“ + `dashboard` åå°ç³»ç»Ÿã€‚
2. **å¾®å‰ç«¯æ¶æ„**  
   - ä¸»åº”ç”¨ + å¤šä¸ªå­åº”ç”¨ï¼ˆ`app1`, `app2`ï¼‰å…±äº«å·¥å…·å‡½æ•°ã€‚
3. **å…¨æ ˆé¡¹ç›®**  
   - å‰ç«¯ï¼ˆReactï¼‰ã€åç«¯ï¼ˆNestJSï¼‰ã€CLI å·¥å…·å…±ç”¨ç±»å‹å®šä¹‰å’Œå·¥å…·å‡½æ•°ã€‚
4. **å¤šç«¯åº”ç”¨**  
   - Web + Mobile (React Native) + Desktop (Electron) å…±äº«ä¸šåŠ¡é€»è¾‘ã€‚

---

### å…­ã€ä¸€å¥è¯æ€»ç»“
> **Monorepo ä¸æ˜¯â€œæŠŠæ‰€æœ‰ä»£ç å¡è¿›ä¸€ä¸ªä»“åº“â€ï¼Œè€Œæ˜¯é€šè¿‡å·¥å…·é“¾å®ç°â€œé«˜å†…èšã€ä½è€¦åˆâ€çš„ååŒå¼€å‘æ¨¡å¼â€”â€”å®ƒç”¨å·¥ç¨‹åŒ–æ‰‹æ®µè§£å†³äº†è·¨é¡¹ç›®åä½œçš„æ‘©æ“¦ï¼Œæ˜¯å¤§å‹å‰ç«¯å›¢é˜Ÿæå‡äº¤ä»˜æ•ˆç‡çš„å…³é”®å®è·µã€‚**

## ä½ åœ¨é¡¹ç›®æ˜¯æ€ä¹ˆåš Monorepoï¼Ÿ

åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œæˆ‘é‡‡ç”¨ **â€œpnpm + Turborepo + Changesetsâ€** çš„ç»„åˆæ¥æ­å»ºå’Œç»´æŠ¤ Monorepoï¼Œå…¼é¡¾**å¼€å‘ä½“éªŒã€æ„å»ºæ€§èƒ½ã€ä¾èµ–ç®¡ç†å’Œå‘å¸ƒæµç¨‹**ã€‚ä»¥ä¸‹æ˜¯æˆ‘è½åœ° Monorepo çš„å®Œæ•´å®è·µæ–¹æ¡ˆï¼š

---

### ä¸€ã€é¡¹ç›®ç»“æ„è®¾è®¡ï¼ˆæ¸…æ™°åˆ†å±‚ï¼‰

```bash
my-project/
â”œâ”€â”€ apps/                  # åº”ç”¨å±‚ï¼ˆå¯ç‹¬ç«‹éƒ¨ç½²ï¼‰
â”‚   â”œâ”€â”€ web/               # Next.js å‰ç«¯åº”ç”¨
â”‚   â””â”€â”€ api/               # NestJS åç«¯æœåŠ¡
â”œâ”€â”€ packages/              # å…±äº«åŒ…ï¼ˆå¯ç‹¬ç«‹å‘å¸ƒï¼‰
â”‚   â”œâ”€â”€ ui/                # React ç»„ä»¶åº“ï¼ˆå« Storybookï¼‰
â”‚   â”œâ”€â”€ types/             # å…¨å±€ TypeScript ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ config/            # ESLint / TypeScript / Babel å…±äº«é…ç½®
â”‚   â””â”€â”€ utils/             # å·¥å…·å‡½æ•°ï¼ˆå¦‚æ—¥æœŸå¤„ç†ã€API å®¢æˆ·ç«¯ï¼‰
â”œâ”€â”€ tools/                 # è‡ªå®šä¹‰è„šæœ¬ï¼ˆå¦‚ä»£ç ç”Ÿæˆå™¨ï¼‰
â”œâ”€â”€ package.json           # æ ¹å·¥ä½œåŒºå£°æ˜
â”œâ”€â”€ pnpm-workspace.yaml    # pnpm å·¥ä½œåŒºé…ç½®
â”œâ”€â”€ turbo.json             # Turborepo ä»»åŠ¡ç¼–æ’
â””â”€â”€ .changeset/            # Changesets å‘å¸ƒé…ç½®
```

> âœ… **åŸåˆ™**ï¼š  
> - `apps/` åªåŒ…å«å¯è¿è¡Œçš„åº”ç”¨ï¼›  
> - `packages/` å¿…é¡»æ˜¯**æ— å‰¯ä½œç”¨ã€å¯ç‹¬ç«‹æµ‹è¯•ã€å¯å‘å¸ƒ**çš„æ¨¡å—ã€‚

---

### äºŒã€æ ¸å¿ƒå·¥å…·é“¾é€‰å‹ä¸é…ç½®

#### 1. **ä¾èµ–ç®¡ç†ï¼špnpm Workspaces**
- **ä¼˜åŠ¿**ï¼šç¡¬é“¾æ¥ + ç¬¦å·é“¾æ¥ï¼ŒèŠ‚çœç£ç›˜ç©ºé—´ï¼Œé¿å…ä¾èµ–å†²çªã€‚
- **é…ç½®**ï¼š
  ```yaml
  # pnpm-workspace.yaml
  packages:
    - "apps/*"
    - "packages/*"
    - "tools/*"
  ```

- **ä½¿ç”¨**ï¼š
  ```bash
  # åœ¨ web åº”ç”¨ä¸­æ·»åŠ å¯¹ ui åŒ…çš„ä¾èµ–
  pnpm add @myorg/ui --filter ./apps/web
  ```

#### 2. **ä»»åŠ¡ç¼–æ’ï¼šTurborepoï¼ˆå…³é”®æé€Ÿï¼‰**
- **ä½œç”¨**ï¼šæ™ºèƒ½å¹¶è¡Œæ‰§è¡Œä»»åŠ¡ + è¿œç¨‹ç¼“å­˜ã€‚
- **é…ç½®**ï¼š
  ```json
  // turbo.json
  {
    "pipeline": {
      "build": {
        "dependsOn": ["^build"], // ä¾èµ–å…¶ä»–åŒ…çš„ build
        "outputs": [".next/**", "dist/**"]
      },
      "test": {
        "dependsOn": ["build"],
        "outputs": []
      },
      "dev": {
        "cache": false, // å¼€å‘å‘½ä»¤ä¸ç¼“å­˜
        "persistent": true // æŒä¹…åŒ–è¿è¡Œï¼ˆå¦‚ dev serverï¼‰
      }
    }
  }
  ```

- **æ•ˆæœ**ï¼š
  ```bash
  # åªæ„å»ºå—å½±å“çš„åŒ…ï¼ˆåˆ©ç”¨ç¼“å­˜ï¼‰
  pnpm turbo run build
  
  # å¹¶è¡Œå¯åŠ¨æ‰€æœ‰åº”ç”¨çš„å¼€å‘æœåŠ¡å™¨
  pnpm turbo run dev --parallel
  ```

#### 3. **ç‰ˆæœ¬å‘å¸ƒï¼šChangesetsï¼ˆè‡ªåŠ¨åŒ–è¯­ä¹‰åŒ–å‘å¸ƒï¼‰**
- **æµç¨‹**ï¼š
  1. å¼€å‘è€…æäº¤ PR æ—¶ï¼Œè¿è¡Œ `pnpm changeset` ç”Ÿæˆå˜æ›´è®°å½•ï¼›
  2. CI åˆå¹¶ PR åï¼Œè‡ªåŠ¨åˆ›å»ºç‰ˆæœ¬å‘å¸ƒ PRï¼›
  3. åˆå¹¶å‘å¸ƒ PR â†’ è‡ªåŠ¨æ‰“ tag + å‘å¸ƒ npm åŒ…ã€‚
- **ä¼˜åŠ¿**ï¼š  
  - ç²¾ç¡®æ§åˆ¶æ¯ä¸ªåŒ…çš„ç‰ˆæœ¬ï¼ˆmajor/minor/patchï¼‰ï¼›  
  - è‡ªåŠ¨ç”Ÿæˆ CHANGELOGã€‚

---

### ä¸‰ã€å…³é”®å®è·µç»†èŠ‚

#### âœ… 1. **å…±äº«é…ç½®ï¼ˆé¿å…é‡å¤ï¼‰**
- å°† ESLintã€TypeScriptã€Jest é…ç½®æŠ½ç¦»åˆ° `packages/config`ï¼š
  ```js
  // apps/web/eslint.config.js
  const baseConfig = require('@myorg/config/eslint');
  module.exports = [...baseConfig, /* é¡¹ç›®ç‰¹æœ‰è§„åˆ™ */];
  ```

#### âœ… 2. **ç±»å‹å®‰å…¨è·¨åŒ…å¼•ç”¨**
- `packages/types` å¯¼å‡ºå…¨å±€ç±»å‹ï¼š
  ```ts
  // packages/types/src/user.ts
  export interface User { id: string; name: string; }
  
  // apps/web/src/pages/profile.tsx
  import type { User } from '@myorg/types'; // ç±»å‹å®‰å…¨ï¼
  ```

#### âœ… 3. **æœ¬åœ°å¼€å‘è”åŠ¨**
- ä¿®æ”¹ `packages/ui` åï¼Œ`apps/web` **å®æ—¶çƒ­æ›´æ–°**ï¼ˆæ— éœ€é‡æ–°å®‰è£…ï¼‰ï¼›
- é€šè¿‡ `pnpm link` æˆ– Turborepo çš„ `--continue` ä¿è¯ä¸€è‡´æ€§ã€‚

#### âœ… 4. **CI ä¼˜åŒ–ï¼ˆåªè·‘å—å½±å“çš„ä»»åŠ¡ï¼‰**
- GitHub Actions ç¤ºä¾‹ï¼š
  ```yaml
  - name: Run affected tests
    run: |
      TURBO_TOKEN=${{ secrets.TURBO_TOKEN }}
      TURBO_TEAM=${{ vars.TURBO_TEAM }}
      pnpm turbo run test --filter=...
  ```
- åˆ©ç”¨ Turborepo **è¿œç¨‹ç¼“å­˜**ï¼Œè·³è¿‡å·²æ„å»ºçš„åŒ…ã€‚

---

### å››ã€é¿å‘ç»éªŒ

| é—®é¢˜         | è§£å†³æ–¹æ¡ˆ                                           |
| ------------ | -------------------------------------------------- |
| **å¾ªç¯ä¾èµ–** | ç”¨ `madge` æ‰«æä¾èµ–å›¾ï¼Œç¦æ­¢ `packages/` é—´å¾ªç¯å¼•ç”¨ |
| **å‘å¸ƒæ··ä¹±** | å¼ºåˆ¶ PR å…³è” Changeset æ–‡ä»¶ï¼Œå¦åˆ™ CI å¤±è´¥          |
| **æ„å»ºç¼“æ…¢** | å¯ç”¨ Turborepo è¿œç¨‹ç¼“å­˜ï¼ˆVercel æä¾›å…è´¹é¢åº¦ï¼‰     |
| **IDE å¡é¡¿** | åœ¨ VS Code ä¸­æ’é™¤ `node_modules` å’Œæ„å»ºäº§ç‰©ç›®å½•    |

---

### äº”ã€æ•ˆæœå¯¹æ¯”ï¼ˆçœŸå®é¡¹ç›®æ•°æ®ï¼‰

| æŒ‡æ ‡         | Multirepo        | Monorepo (pnpm+Turborepo)     |
| ------------ | ---------------- | ----------------------------- |
| é¦–æ¬¡å®‰è£…ä¾èµ– | 8 åˆ†é’Ÿ           | 2 åˆ†é’Ÿï¼ˆç¡¬é“¾æ¥å¤ç”¨ï¼‰          |
| å…¨é‡æ„å»º     | 120s             | 45sï¼ˆç¼“å­˜ + å¹¶è¡Œï¼‰            |
| è·¨åŒ…ä¿®æ”¹éªŒè¯ | éœ€æ‰‹åŠ¨ link/å‘ç‰ˆ | ä¿å­˜å³ç”Ÿæ•ˆ                    |
| æ–°æˆå‘˜ä¸Šæ‰‹   | éœ€é…ç½®å¤šä¸ªä»“åº“   | å…‹éš†ä¸€ä¸ªä»“åº“ + `pnpm install` |

---

### ä¸€å¥è¯æ€»ç»“
> **æˆ‘çš„ Monorepo å®è·µ = pnpmï¼ˆä¾èµ–ï¼‰ + Turborepoï¼ˆæ„å»ºï¼‰ + Changesetsï¼ˆå‘å¸ƒï¼‰ + ä¸¥æ ¼åˆ†å±‚ï¼ˆæ¶æ„ï¼‰ï¼Œç›®æ ‡æ˜¯è®©è·¨é¡¹ç›®åä½œåƒå•ä½“åº”ç”¨ä¸€æ ·ç®€å•ï¼ŒåŒæ—¶ä¿ç•™å¾®åŒ…çš„çµæ´»æ€§ã€‚**

## ä¸ºä»€ä¹ˆ pnpm æ¯” npm å¿«ï¼Ÿ

`pnpm` æ¯” `npm` å¿«ï¼Œ**æ ¸å¿ƒåŸå› åœ¨äºå…¶ç‹¬ç‰¹çš„ä¾èµ–å­˜å‚¨å’Œå®‰è£…æœºåˆ¶**â€”â€”å®ƒé€šè¿‡ **ç¡¬é“¾æ¥ï¼ˆhard linksï¼‰ + ç¬¦å·é“¾æ¥ï¼ˆsymlinksï¼‰ + å†…å®¹å¯å¯»å€å­˜å‚¨ï¼ˆContent-Addressable Storeï¼‰**ï¼Œé¿å…äº†é‡å¤ä¸‹è½½å’Œå¤åˆ¶æ–‡ä»¶ï¼Œå¤§å¹…æå‡äº†å®‰è£…é€Ÿåº¦ã€èŠ‚çœç£ç›˜ç©ºé—´ï¼Œå¹¶ä¿è¯äº†ä¾èµ–ä¸€è‡´æ€§ã€‚

---

### ä¸€ã€æ ¹æœ¬åŒºåˆ«ï¼šä¾èµ–å­˜å‚¨æ¨¡å‹

| åŒ…ç®¡ç†å™¨ | ä¾èµ–å­˜å‚¨æ–¹å¼                              | ç£ç›˜å ç”¨                 | å®‰è£…é€Ÿåº¦           |
| -------- | ----------------------------------------- | ------------------------ | ------------------ |
| **npm**  | æ¯ä¸ªé¡¹ç›®ç‹¬ç«‹ `node_modules`ï¼ˆåµŒå¥—æˆ–æ‰å¹³ï¼‰ | é«˜ï¼ˆé‡å¤ä¾èµ–å¤šæ¬¡å­˜å‚¨ï¼‰   | æ…¢ï¼ˆå¤§é‡æ–‡ä»¶å¤åˆ¶ï¼‰ |
| **pnpm** | å…¨å±€å†…å®¹å¯å¯»å€å­˜å‚¨ + ç¡¬é“¾æ¥               | æä½ï¼ˆç›¸åŒä¾èµ–åªå­˜ä¸€ä»½ï¼‰ | æå¿«ï¼ˆæ— æ–‡ä»¶å¤åˆ¶ï¼‰ |

---

### äºŒã€pnpm çš„ä¸‰å¤§æ ¸å¿ƒæŠ€æœ¯

#### 1. **å…¨å±€å†…å®¹å¯å¯»å€å­˜å‚¨ï¼ˆStoreï¼‰**
- æ‰€æœ‰ä¾èµ–åŒ…è¢«è§£å‹å¹¶å­˜å‚¨åœ¨ **å…¨å±€å”¯ä¸€ä½ç½®**ï¼ˆå¦‚ `~/.pnpm-store`ï¼‰ï¼›
- è·¯å¾„æŒ‰ **åŒ…å + ç‰ˆæœ¬ + å®Œæ•´ä¾èµ–æ ‘å“ˆå¸Œ** ç”Ÿæˆï¼Œç¡®ä¿**å®Œå…¨ç¡®å®šæ€§**ï¼š
  ```
  ~/.pnpm-store/v3/files/
  â””â”€â”€ abc123.../         # æ–‡ä»¶å†…å®¹çš„å“ˆå¸Œ
      â””â”€â”€ index.js       # å®é™…æ–‡ä»¶å†…å®¹
  ```

#### 2. **ç¡¬é“¾æ¥ï¼ˆHard Linksï¼‰å¤ç”¨æ–‡ä»¶**
- å½“é¡¹ç›®éœ€è¦æŸä¸ªä¾èµ–æ—¶ï¼Œpnpm **ä¸åœ¨ `node_modules` ä¸­å¤åˆ¶æ–‡ä»¶**ï¼Œè€Œæ˜¯åˆ›å»º**ç¡¬é“¾æ¥**æŒ‡å‘å…¨å±€ Store ä¸­çš„æ–‡ä»¶ï¼›
- **ç¡¬é“¾æ¥ç‰¹ç‚¹**ï¼š
  - å¤šä¸ªè·¯å¾„æŒ‡å‘åŒä¸€ä»½ç‰©ç†æ•°æ®ï¼›
  - ä¿®æ”¹ä»»ä¸€é“¾æ¥ = ä¿®æ”¹æ‰€æœ‰ï¼ˆä½†ä¾èµ–æ˜¯åªè¯»çš„ï¼Œå®‰å…¨ï¼‰ï¼›
  - å‡ ä¹é›¶ç£ç›˜å¼€é”€ & é›¶å¤åˆ¶æ—¶é—´ã€‚

> ğŸ’¡ **å¯¹æ¯” npm**ï¼š  
> npm ä¼šå°†æ¯ä¸ªä¾èµ–å®Œæ•´å¤åˆ¶åˆ° `node_modules`ï¼Œ10 ä¸ªé¡¹ç›®ç”¨åŒä¸€ä¸ª lodash â†’ ç£ç›˜å­˜ 10 ä»½ã€‚

#### 3. **ç¬¦å·é“¾æ¥ï¼ˆSymlinksï¼‰æ„å»ºä¾èµ–æ ‘**
- pnpm åœ¨é¡¹ç›® `node_modules` ä¸­åªåˆ›å»º**ç¬¦å·é“¾æ¥**ï¼Œå½¢æˆç¬¦åˆ Node.js è§£æè§„åˆ™çš„ç›®å½•ç»“æ„ï¼š
  ```bash
  my-project/
  â””â”€â”€ node_modules/
      â”œâ”€â”€ .pnpm/                 # çœŸå®ä¾èµ–å­˜å‚¨åŒºï¼ˆæ‰å¹³åŒ–ï¼‰
      â”‚   â”œâ”€â”€ lodash@4.17.21 -> ~/.pnpm-store/...
      â”‚   â””â”€â”€ react@18.2.0 -> ~/.pnpm-store/...
      â”œâ”€â”€ lodash -> .pnpm/lodash@4.17.21/node_modules/lodash
      â””â”€â”€ react -> .pnpm/react@18.2.0/node_modules/react
  ```
- **ä¼˜åŠ¿**ï¼š
  - é¿å… npm/yarn çš„â€œå¹½çµä¾èµ–â€ï¼ˆphantom dependenciesï¼‰ï¼›
  - ä¸¥æ ¼éµå¾ª `package.json` å£°æ˜çš„ä¾èµ–å…³ç³»ã€‚

---

### ä¸‰ã€æ€§èƒ½å¯¹æ¯”ï¼ˆå®æµ‹æ•°æ®ï¼‰

| åœºæ™¯                          | npm (v9)          | pnpm (v8)          | æå‡        |
| ----------------------------- | ----------------- | ------------------ | ----------- |
| **é¦–æ¬¡å®‰è£…**ï¼ˆå¤§å‹é¡¹ç›®ï¼‰      | 45s               | 22s                | â‰ˆ2x         |
| **äºŒæ¬¡å®‰è£…**ï¼ˆç¼“å­˜å‘½ä¸­ï¼‰      | 30s               | **3s**             | **10x**     |
| **ç£ç›˜å ç”¨**ï¼ˆ10 ä¸ªç›¸ä¼¼é¡¹ç›®ï¼‰ | 1.2 GB            | **200 MB**         | **6x èŠ‚çœ** |
| **CI ç¯å¢ƒå®‰è£…**               | æ…¢ï¼ˆéœ€ä¸‹è½½+è§£å‹ï¼‰ | æå¿«ï¼ˆå¤ç”¨ Storeï¼‰ | æ˜¾è‘—æé€Ÿ    |

> ğŸ” **å…³é”®**ï¼špnpm çš„ Store å¯è·¨é¡¹ç›®ã€è·¨ CI Job å¤ç”¨ï¼ˆé…åˆç¼“å­˜ç­–ç•¥ï¼‰ã€‚

---

### å››ã€é¢å¤–ä¼˜åŠ¿ï¼ˆä¸ä»…æ˜¯å¿«ï¼‰

#### âœ… 1. **æœç»â€œå¹½çµä¾èµ–â€**
- npm/yarn å…è®¸ä»£ç ç›´æ¥å¼•ç”¨æœªå£°æ˜çš„ä¾èµ–ï¼ˆå›  `node_modules` æ‰å¹³åŒ–ï¼‰ï¼›
- pnpm çš„ä¸¥æ ¼ç¬¦å·é“¾æ¥ç»“æ„**å¼ºåˆ¶æ˜¾å¼å£°æ˜ä¾èµ–**ï¼Œæå‡é¡¹ç›®å¥å£®æ€§ã€‚

#### âœ… 2. **Monorepo å‹å¥½**
- åœ¨ Monorepo ä¸­ï¼Œæ‰€æœ‰å­é¡¹ç›®å…±äº«åŒä¸€ä¸ª Storeï¼›
- `pnpm install` ä¸€æ¬¡å®‰è£…æ‰€æœ‰ workspace ä¾èµ–ï¼Œæ— é‡å¤ã€‚

#### âœ… 3. **ç¦»çº¿æ¨¡å¼æ›´å¼º**
- å…¨å±€ Store ç›¸å½“äºæœ¬åœ°ç¼“å­˜ï¼Œå³ä½¿æ–­ç½‘ä¹Ÿèƒ½å®‰è£…å·²ä¸‹è½½è¿‡çš„ä¾èµ–ã€‚

---

### äº”ã€ä¸ºä»€ä¹ˆ npm ä¸è¿™ä¹ˆè®¾è®¡ï¼Ÿ
- **å†å²åŒ…è¢±**ï¼šnpm æ—©æœŸä¸ºç®€å•æ€§é‡‡ç”¨ç›´æ¥å¤åˆ¶ï¼›
- **å…¼å®¹æ€§**ï¼šéƒ¨åˆ†å·¥å…·å‡è®¾ `node_modules` æ˜¯çœŸå®æ–‡ä»¶ï¼ˆpnpm é€šè¿‡ `--shamefully-hoist` å…¼å®¹ï¼‰ï¼›
- **ç”Ÿæ€æƒ¯æ€§**ï¼šæ”¹å˜åº•å±‚æ¨¡å‹é£é™©é«˜ã€‚

> ğŸ’¡ **ç°çŠ¶**ï¼šYarn v2+ï¼ˆPnPï¼‰ä¹Ÿé‡‡ç”¨ç±»ä¼¼æ€è·¯ï¼Œä½† pnpm å› **å…¼å®¹ä¼ ç»Ÿ `node_modules` ç»“æ„**æ›´æ˜“è¿ç§»ã€‚

---

### å…­ã€ä¸€å¥è¯æ€»ç»“
> **pnpm å¿«åœ¨â€œä¸å¤åˆ¶â€â€”â€”ç”¨ç¡¬é“¾æ¥å…±äº«å…¨å±€å­˜å‚¨çš„ä¾èµ–æ–‡ä»¶ï¼Œç”¨ç¬¦å·é“¾æ¥æ„å»ºç²¾å‡†ä¾èµ–æ ‘ï¼Œæ—¢çœç©ºé—´åˆæé€Ÿï¼Œè¿˜é¡ºæ‰‹è§£å†³äº† npm çš„ä¾èµ–éšæ‚£ã€‚**

## ESLint æ¦‚å¿µåŠåŸç†

**ESLint** æ˜¯ä¸€ä¸ª**å¯æ’ä»¶åŒ–ã€é«˜åº¦å¯é…ç½®çš„ JavaScript/TypeScript ä»£ç æ£€æŸ¥å·¥å…·**ï¼Œç”¨äºåœ¨å¼€å‘é˜¶æ®µ**é™æ€åˆ†æä»£ç **ï¼Œå‘ç°æ½œåœ¨é”™è¯¯ã€é£æ ¼é—®é¢˜å’Œä¸è§„èŒƒå†™æ³•ï¼Œä»è€Œæå‡ä»£ç è´¨é‡å’Œå›¢é˜Ÿåä½œä¸€è‡´æ€§ã€‚

---

### ä¸€ã€æ ¸å¿ƒæ¦‚å¿µ

#### 1. **Linterï¼ˆä»£ç æ£€æŸ¥å™¨ï¼‰**
- é™æ€åˆ†ææºç ï¼ˆæ— éœ€è¿è¡Œï¼‰ï¼Œæ£€æŸ¥ï¼š
  - è¯­æ³•é”™è¯¯ï¼ˆå¦‚æœªå®šä¹‰å˜é‡ï¼‰ï¼›
  - æ½œåœ¨ bugï¼ˆå¦‚ `==` vs `===`ï¼‰ï¼›
  - ä»£ç é£æ ¼ï¼ˆç¼©è¿›ã€å¼•å·ã€åˆ†å·ç­‰ï¼‰ï¼›
  - æœ€ä½³å®è·µï¼ˆå¦‚é¿å… `console.log` ä¸Šçº¿ï¼‰ã€‚

#### 2. **è§„åˆ™ï¼ˆRulesï¼‰**
- ESLint çš„æœ€å°æ£€æŸ¥å•å…ƒï¼Œæ¯æ¡è§„åˆ™ç‹¬ç«‹å¼€å…³ï¼›
- ç¤ºä¾‹ï¼š
  ```js
  "no-console": "warn",      // ç¦æ­¢ consoleï¼ˆè­¦å‘Šï¼‰
  "semi": ["error", "always"] // å¿…é¡»åŠ åˆ†å·ï¼ˆæŠ¥é”™ï¼‰
  ```

#### 3. **é…ç½®æ–‡ä»¶ï¼ˆConfigurationï¼‰**
- æ”¯æŒå¤šç§æ ¼å¼ï¼š`.eslintrc.js`ã€`.eslintrc.json`ã€`package.json` ä¸­çš„ `eslintConfig`ï¼›
- å¯ç»§æ‰¿å…±äº«é…ç½®ï¼ˆå¦‚ `eslint:recommended`ã€`@typescript-eslint/recommended`ï¼‰ã€‚

#### 4. **è§£æå™¨ï¼ˆParserï¼‰**
- é»˜è®¤ä½¿ç”¨ Espreeï¼ˆåŸºäº Acornï¼‰ï¼Œæ”¯æŒ ES5~ES2023ï¼›
- æ‰©å±•åœºæ™¯ï¼š
  - TypeScript â†’ `@typescript-eslint/parser`ï¼›
  - Vue â†’ `vue-eslint-parser`ã€‚

#### 5. **æ’ä»¶ï¼ˆPluginsï¼‰**
- æ‰©å±• ESLint èƒ½åŠ›ï¼Œæä¾›**è‡ªå®šä¹‰è§„åˆ™/è§£æå™¨**ï¼›
- å‘½åè§„èŒƒï¼š`eslint-plugin-xxx`ï¼ˆä½¿ç”¨æ—¶çœç•¥å‰ç¼€ï¼‰ï¼›
- ç¤ºä¾‹ï¼š
  ```js
  plugins: ['react', '@typescript-eslint']
  ```

#### 6. **å¯å…±äº«é…ç½®ï¼ˆShareable Configsï¼‰**
- å°è£…å¸¸ç”¨è§„åˆ™é›†ï¼Œä¾¿äºå›¢é˜Ÿå¤ç”¨ï¼›
- å‘½åè§„èŒƒï¼š`eslint-config-xxx`ï¼ˆä½¿ç”¨æ—¶åŠ  `xxx`ï¼‰ï¼›
- ç¤ºä¾‹ï¼š
  ```js
  extends: ['airbnb', 'plugin:react/recommended']
  ```

---

### äºŒã€å·¥ä½œåŸç†ï¼ˆå››æ­¥æµç¨‹ï¼‰

```mermaid
graph LR
A[æºä»£ç ] --> B[è§£æå™¨ Parser]
B --> C[AST æŠ½è±¡è¯­æ³•æ ‘]
C --> D[è§„åˆ™éå† AST]
D --> E[æŠ¥å‘Šé—®é¢˜]
```

#### 1. **è§£æä»£ç  â†’ ç”Ÿæˆ AST**
- ESLint è°ƒç”¨é…ç½®çš„ **Parser**ï¼ˆå¦‚ `@typescript-eslint/parser`ï¼‰ï¼›
- å°†æºç è½¬æ¢ä¸º **ASTï¼ˆAbstract Syntax Treeï¼‰**ï¼Œç»“æ„åŒ–è¡¨ç¤ºä»£ç é€»è¾‘ã€‚

#### 2. **éå† AST â†’ è§¦å‘è§„åˆ™**
- ESLint ä½¿ç”¨ **æ·±åº¦ä¼˜å…ˆéå†** ASTï¼›
- æ¯é‡åˆ°ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆå¦‚ `VariableDeclaration`, `CallExpression`ï¼‰ï¼Œè§¦å‘æ³¨å†Œçš„è§„åˆ™ç›‘å¬å™¨ã€‚

#### 3. **è§„åˆ™æ‰§è¡Œ â†’ æ£€æŸ¥é€»è¾‘**
- æ¯æ¡è§„åˆ™æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ¥æ”¶ AST èŠ‚ç‚¹å¹¶åˆ¤æ–­æ˜¯å¦è¿è§„ï¼›
- ç¤ºä¾‹ï¼š`no-var` è§„åˆ™ä¼šæ£€æŸ¥æ˜¯å¦å­˜åœ¨ `VariableDeclaration` ä¸” `kind === 'var'`ã€‚

#### 4. **ç”ŸæˆæŠ¥å‘Š â†’ è¾“å‡ºç»“æœ**
- æ±‡æ€»æ‰€æœ‰è¿è§„é¡¹ï¼ŒæŒ‰é…ç½®è¾“å‡ºï¼š
  - ç»ˆç«¯é«˜äº®æ˜¾ç¤ºï¼›
  - IDE å®æ—¶æ ‡çº¢ï¼ˆé€šè¿‡ ESLint æ’ä»¶ï¼‰ï¼›
  - CI å¤±è´¥ï¼ˆè‹¥è®¾ä¸º `error`ï¼‰ã€‚

---

### ä¸‰ã€å…³é”®ç‰¹æ€§

#### âœ… 1. **å¯æ’æ‹”æ¶æ„**
- è§£æå™¨ã€è§„åˆ™ã€æ’ä»¶å‡å¯æ›¿æ¢ï¼Œæ”¯æŒä»»æ„è¯­è¨€æ‰©å±•ï¼ˆTS/JSX/Vueï¼‰ã€‚

#### âœ… 2. **è‡ªåŠ¨ä¿®å¤ï¼ˆ--fixï¼‰**
- éƒ¨åˆ†è§„åˆ™æ”¯æŒè‡ªåŠ¨ä¿®å¤ï¼ˆå¦‚æ ¼å¼é—®é¢˜ï¼‰ï¼š
  ```bash
  eslint --fix src/
  ```

#### âœ… 3. **ä½œç”¨åŸŸåˆ†æï¼ˆScope Analysisï¼‰**
- å†…ç½®ä½œç”¨åŸŸç®¡ç†å™¨ï¼Œç²¾å‡†åˆ¤æ–­å˜é‡å£°æ˜/å¼•ç”¨å…³ç³»ï¼›
- ä¾‹å¦‚ï¼šæ£€æµ‹â€œå˜é‡æœªå®šä¹‰â€æ—¶ï¼Œä¼šæ£€æŸ¥å½“å‰ä½œç”¨åŸŸé“¾ã€‚

#### âœ… 4. **é…ç½®çº§è”ä¸è¦†ç›–**
- æ”¯æŒç›®å½•çº§ `.eslintrc`ï¼Œå­ç›®å½•è‡ªåŠ¨ç»§æ‰¿çˆ¶çº§é…ç½®ï¼›
- å¯é€šè¿‡ `overrides` å¯¹ç‰¹å®šæ–‡ä»¶ï¼ˆå¦‚ `*.test.js`ï¼‰å®šåˆ¶è§„åˆ™ã€‚

---

### å››ã€å…¸å‹é…ç½®ç¤ºä¾‹

```js
// .eslintrc.js
module.exports = {
  // æŒ‡å®šç¯å¢ƒï¼ˆæ³¨å…¥å…¨å±€å˜é‡ï¼‰
  env: {
    browser: true,
    es2021: true,
    node: true
  },
  
  // ç»§æ‰¿æ¨èè§„åˆ™
  extends: [
    'eslint:recommended',
    '@typescript-eslint/recommended'
  ],
  
  // æŒ‡å®šè§£æå™¨
  parser: '@typescript-eslint/parser',
  
  // åŠ è½½æ’ä»¶
  plugins: ['@typescript-eslint'],
  
  // è‡ªå®šä¹‰è§„åˆ™
  rules: {
    'no-console': 'warn',
    '@typescript-eslint/no-explicit-any': 'error'
  },
  
  // æŒ‡å®šæ–‡ä»¶ç±»å‹
  overrides: [
    {
      files: ['*.test.ts'],
      rules: { 'no-unused-expressions': 'off' }
    }
  ]
};
```

---

### äº”ã€ESLint vs å…¶ä»–å·¥å…·

| å·¥å…·           | å®šä½               | äº’è¡¥æ€§                                                          |
| -------------- | ------------------ | --------------------------------------------------------------- |
| **Prettier**   | ä»£ç æ ¼å¼åŒ–ï¼ˆç¾è§‚ï¼‰ | âœ… ä¸ ESLint åˆ†å·¥ï¼šESLint ç®¡é€»è¾‘ï¼ŒPrettier ç®¡é£æ ¼                |
| **TypeScript** | ç±»å‹æ£€æŸ¥           | âœ… ESLint è¡¥å…… TS æ— æ³•è¦†ç›–çš„è¿è¡Œæ—¶é—®é¢˜ï¼ˆå¦‚ `no-param-reassign`ï¼‰ |
| **JSHint**     | è€ä¸€ä»£ Linter      | âŒ åŠŸèƒ½å¼±äº ESLintï¼Œå·²åŸºæœ¬æ·˜æ±°                                   |

> ğŸ’¡ **æœ€ä½³å®è·µ**ï¼š  
> ESLint + Prettier + TypeScript = ç°ä»£å‰ç«¯ä»£ç è´¨é‡é“ä¸‰è§’ã€‚

---

### å…­ã€ä¸€å¥è¯æ€»ç»“
> **ESLint é€šè¿‡è§£æä»£ç ä¸º ASTï¼Œéå†èŠ‚ç‚¹è§¦å‘è§„åˆ™æ£€æŸ¥ï¼Œåœ¨ç¼–ç é˜¶æ®µæ‹¦æˆªé—®é¢˜â€”â€”å®ƒæ˜¯ JavaScript ç”Ÿæ€ä¸­ä¸å¯æˆ–ç¼ºçš„â€œä»£ç å®ˆé—¨å‘˜â€ã€‚**

## Babel æ¦‚å¿µåŠåŸç†

**Babel** æ˜¯ä¸€ä¸ª **JavaScript ç¼–è¯‘å™¨ï¼ˆCompilerï¼‰**ï¼Œæ ¸å¿ƒåŠŸèƒ½æ˜¯å°†**æ–°ç‰ˆæˆ–å®éªŒæ€§ JavaScript ä»£ç **ï¼ˆå¦‚ ES2023ã€TypeScriptã€JSXï¼‰**è½¬æ¢ä¸ºå‘åå…¼å®¹çš„æ—§ç‰ˆ JavaScript**ï¼ˆå¦‚ ES5ï¼‰ï¼Œä»¥ç¡®ä¿ä»£ç èƒ½åœ¨ä¸æ”¯æŒæ–°ç‰¹æ€§çš„æµè§ˆå™¨æˆ–ç¯å¢ƒä¸­è¿è¡Œã€‚

> ğŸ“Œ **å®šä½**ï¼šä¸æ˜¯æ‰“åŒ…å·¥å…·ï¼ˆå¦‚ Webpackï¼‰ï¼Œè€Œæ˜¯**æºç è½¬æ¢å·¥å…·**ï¼ˆTranspilerï¼‰ã€‚

---

### ä¸€ã€æ ¸å¿ƒæ¦‚å¿µ

#### 1. **è½¬è¯‘ï¼ˆTranspilationï¼‰**
- å°†ä¸€ç§ JavaScript è¯­æ³•ï¼ˆé«˜ç‰ˆæœ¬/æ‰©å±•è¯­æ³•ï¼‰ â†’ è½¬æ¢ä¸ºå¦ä¸€ç§ç­‰æ•ˆçš„ä½ç‰ˆæœ¬è¯­æ³•ï¼›
- ç¤ºä¾‹ï¼š
  ```js
  // è¾“å…¥ï¼ˆES2020ï¼‰
  const add = (a, b) => a + b;
  
  // Babel è¾“å‡ºï¼ˆES5ï¼‰
  var add = function(a, b) {
    return a + b;
  };
  ```

#### 2. **é¢„è®¾ï¼ˆPresetsï¼‰**
- ä¸€ç»„**æ’ä»¶çš„é›†åˆ**ï¼Œç”¨äºå¤„ç†ç‰¹å®šåœºæ™¯ï¼›
- å¸¸ç”¨é¢„è®¾ï¼š
  - `@babel/preset-env`ï¼šæ™ºèƒ½è½¬æ¢ ES6+ è¯­æ³•ï¼ˆæŒ‰ç›®æ ‡ç¯å¢ƒï¼‰ï¼›
  - `@babel/preset-react`ï¼šè½¬æ¢ JSXï¼›
  - `@babel/preset-typescript`ï¼šç§»é™¤ TypeScript ç±»å‹æ³¨è§£ã€‚

#### 3. **æ’ä»¶ï¼ˆPluginsï¼‰**
- æ‰§è¡Œ**å•ä¸€è½¬æ¢ä»»åŠ¡**çš„æ¨¡å—ï¼›
- ç¤ºä¾‹ï¼š
  - `@babel/plugin-transform-arrow-functions`ï¼šè½¬æ¢ç®­å¤´å‡½æ•°ï¼›
  - `@babel/plugin-proposal-class-properties`ï¼šæ”¯æŒ class å­—æ®µï¼ˆ`class A { x = 1 }`ï¼‰ã€‚

#### 4. **Polyfillï¼ˆå«ç‰‡ï¼‰**
- Babel **åªè½¬æ¢è¯­æ³•**ï¼Œä¸æä¾›æ–° APIï¼ˆå¦‚ `Promise`, `Array.from`ï¼‰ï¼›
- éœ€é…åˆ `core-js` ç­‰ Polyfill åº“è¡¥å……ç¼ºå¤±çš„å…¨å±€å¯¹è±¡/æ–¹æ³•ã€‚

---

### äºŒã€å·¥ä½œåŸç†ï¼ˆä¸‰æ­¥ç¼–è¯‘æµç¨‹ï¼‰

![An Image](../public/assets/tongyi-mermaid-2026-01-05-140116.png)

#### 1. **è§£æï¼ˆParsingï¼‰**
- ä½¿ç”¨ **è§£æå™¨**ï¼ˆé»˜è®¤ `@babel/parser`ï¼ŒåŸå Babylonï¼‰å°†æºç è½¬æ¢ä¸º **ASTï¼ˆAbstract Syntax Treeï¼‰**ï¼›
- AST æ˜¯ä»£ç çš„ç»“æ„åŒ–è¡¨ç¤ºï¼Œä¾¿äºåˆ†æå’Œä¿®æ”¹ã€‚

#### 2. **è½¬æ¢ï¼ˆTransformationï¼‰**
- éå† ASTï¼Œåº”ç”¨é…ç½®çš„ **æ’ä»¶/é¢„è®¾** å¯¹èŠ‚ç‚¹è¿›è¡Œå¢åˆ æ”¹ï¼›
- æ¯ä¸ªæ’ä»¶é€šè¿‡ **è®¿é—®è€…æ¨¡å¼ï¼ˆVisitor Patternï¼‰** ç›‘å¬ç‰¹å®š AST èŠ‚ç‚¹ï¼š
  ```js
  // æ’ä»¶ç¤ºä¾‹ï¼šå°† console.log æ›¿æ¢ä¸º alert
  export default function() {
    return {
      visitor: {
        CallExpression(path) {
          if (path.node.callee.object?.name === 'console' && 
              path.node.callee.property?.name === 'log') {
            path.replaceWith(
              t.callExpression(t.identifier('alert'), path.node.arguments)
            );
          }
        }
      }
    };
  }
  ```

#### 3. **ç”Ÿæˆï¼ˆCode Generationï¼‰**
- ä½¿ç”¨ **ä»£ç ç”Ÿæˆå™¨**ï¼ˆ`@babel/generator`ï¼‰å°†ä¿®æ”¹åçš„ AST è½¬å›å­—ç¬¦ä¸²å½¢å¼çš„ JavaScript ä»£ç ã€‚

---

### ä¸‰ã€å…³é”®ç‰¹æ€§

#### âœ… 1. **æŒ‰éœ€è½¬æ¢ï¼ˆ@babel/preset-envï¼‰**
- é€šè¿‡ `browserslist` é…ç½®ç›®æ ‡ç¯å¢ƒï¼Œ**åªè½¬æ¢ä¸æ”¯æŒçš„è¯­æ³•**ï¼š
  ```js
  // .browserslistrc
  > 1%,
  not dead
  
  // babel.config.js
  presets: [
    ['@babel/preset-env', { targets: 'defaults' }]
  ]
  ```
- ç»“åˆ `useBuiltIns: 'usage'` å®ç°**æŒ‰éœ€æ³¨å…¥ Polyfill**ã€‚

#### âœ… 2. **æ”¯æŒæ‰©å±•è¯­æ³•**
- JSX â†’ React.createElement()
- TypeScript â†’ ç§»é™¤ç±»å‹æ³¨è§£ï¼ˆä¿ç•™è¿è¡Œæ—¶é€»è¾‘ï¼‰
- Flow â†’ ç±»å‹æ“¦é™¤

#### âœ… 3. **æ’ä»¶åŒ–æ¶æ„**
- ç¤¾åŒºæä¾›æ•°åƒæ’ä»¶ï¼Œæ”¯æŒå®éªŒæ€§ææ¡ˆï¼ˆå¦‚è£…é¥°å™¨ã€ç®¡é“æ“ä½œç¬¦ï¼‰ï¼›
- å¯è‡ªå®šä¹‰æ’ä»¶å®ç°ä»£ç ä¼˜åŒ–ã€åŸ‹ç‚¹æ³¨å…¥ç­‰ã€‚

---

### å››ã€å…¸å‹é…ç½®ç¤ºä¾‹

```js
// babel.config.js
module.exports = {
  presets: [
    // æ™ºèƒ½è½¬æ¢ ES6+
    ['@babel/preset-env', {
      targets: { browsers: ['> 1%', 'not ie <= 11'] },
      useBuiltIns: 'usage', // æŒ‰éœ€å¼•å…¥ core-js
      corejs: 3
    }],
    // è½¬æ¢ JSX
    ['@babel/preset-react', { runtime: 'automatic' }],
    // ç§»é™¤ TS ç±»å‹
    '@babel/preset-typescript'
  ],
  plugins: [
    // æ”¯æŒ class å±æ€§
    '@babel/plugin-proposal-class-properties',
    // è‡ªåŠ¨å¼•å…¥ Polyfillï¼ˆå·²ç”± preset-env å¤„ç†ï¼‰
  ]
};
```

---

### äº”ã€Babel vs å…¶ä»–å·¥å…·

| å·¥å…·                          | å®šä½            | ä¸ Babel å…³ç³»                                                                 |
| ----------------------------- | --------------- | ----------------------------------------------------------------------------- |
| **TypeScript Compiler (tsc)** | ç±»å‹æ£€æŸ¥ + è½¬è¯‘ | Babel **ä¸æ£€æŸ¥ç±»å‹**ï¼Œä»…æ“¦é™¤ TS è¯­æ³•ï¼›å¸¸æ­é…ä½¿ç”¨ï¼ˆtsc ç±»å‹æ£€æŸ¥ + Babel è½¬è¯‘ï¼‰ |
| **SWC / esbuild**             | è¶…å¿« JS è½¬è¯‘å™¨  | Babel çš„é«˜æ€§èƒ½æ›¿ä»£å“ï¼ˆRust/Go ç¼–å†™ï¼‰ï¼Œä½†æ’ä»¶ç”Ÿæ€è¾ƒå¼±                          |
| **Webpack**                   | æ¨¡å—æ‰“åŒ…å™¨      | Webpack é€šè¿‡ `babel-loader` è°ƒç”¨ Babel è½¬è¯‘æ¨¡å—                               |

> ğŸ’¡ **ç°ä»£è¶‹åŠ¿**ï¼š  
> å¼€å‘ç¯å¢ƒç”¨ **esbuild/SWC** æé€Ÿï¼Œç”Ÿäº§ç¯å¢ƒç”¨ **Babel** ä¿è¯å…¼å®¹æ€§ã€‚

---

### å…­ã€ä¸€å¥è¯æ€»ç»“
> **Babel æ˜¯ JavaScript çš„â€œè¯­æ³•ç¿»è¯‘å®˜â€â€”â€”å®ƒé€šè¿‡è§£æâ†’è½¬æ¢â†’ç”Ÿæˆä¸‰æ­¥ï¼Œå°†å‰æ²¿ä»£ç å®‰å…¨é™çº§ä¸ºå¹¿æ³›å…¼å®¹çš„ç‰ˆæœ¬ï¼Œæ˜¯ç°ä»£å‰ç«¯å·¥ç¨‹åŒ–çš„åŸºçŸ³å·¥å…·ã€‚**

## npm install çš„æ‰§è¡Œè¿‡ç¨‹

`npm install` çš„æ‰§è¡Œè¿‡ç¨‹æ˜¯ä¸€ä¸ª**å¤šé˜¶æ®µã€é«˜åº¦ååŒçš„ä¾èµ–è§£æä¸å®‰è£…æµç¨‹**ï¼Œå…¶æ ¸å¿ƒç›®æ ‡æ˜¯ï¼š**æ ¹æ® `package.json` å’Œ `package-lock.json`ï¼Œåœ¨æœ¬åœ°æ„å»ºå‡ºä¸€ä¸ªç¬¦åˆè¯­ä¹‰åŒ–ç‰ˆæœ¬è§„åˆ™ï¼ˆSemVerï¼‰ä¸”å¯å¤ç°çš„ `node_modules` ç›®å½•ç»“æ„**ã€‚

ä»¥ä¸‹æ˜¯ `npm install`ï¼ˆä»¥ npm v7+ ä¸ºä¾‹ï¼‰çš„è¯¦ç»†æ‰§è¡Œæ­¥éª¤ï¼š

---

### ä¸€ã€æ•´ä½“æµç¨‹æ¦‚è§ˆ

![An Image](../public/assets/tongyi-mermaid-2026-01-05-140200.png)

---

### äºŒã€è¯¦ç»†æ‰§è¡Œæ­¥éª¤

#### 1. **è¯»å–é…ç½®ä¸æ¸…å•æ–‡ä»¶**
- è¯»å–å½“å‰ç›®å½•çš„ `package.json`ï¼Œè·å–ï¼š
  - `dependencies`
  - `devDependencies`
  - `optionalDependencies`
  - `engines`ï¼ˆNode/npm ç‰ˆæœ¬è¦æ±‚ï¼‰
- è¯»å– `.npmrc` é…ç½®ï¼ˆå¦‚ registry æºã€ç¼“å­˜è·¯å¾„ï¼‰ã€‚

#### 2. **åŠ è½½æˆ–ç”Ÿæˆä¾èµ–æ ‘ï¼ˆArborist ç®—æ³•ï¼‰**
- npm v7+ ä½¿ç”¨ **Arborist**ï¼ˆâ€œå›­ä¸â€ï¼‰å¼•æ“è¿›è¡Œä¾èµ–è§£æï¼›
- **å…³é”®é€»è¾‘**ï¼š
  - è‹¥å­˜åœ¨ `package-lock.json` ä¸”ä¸ `package.json` å…¼å®¹ â†’ **ç›´æ¥ä½¿ç”¨ lock æ–‡ä»¶ä¸­çš„ç²¾ç¡®ç‰ˆæœ¬**ï¼›
  - è‹¥ lock æ–‡ä»¶ç¼ºå¤±/è¿‡æœŸ â†’ **é‡æ–°è®¡ç®—ä¾èµ–æ ‘**ï¼Œéµå¾ª SemVer è§„åˆ™ï¼ˆå¦‚ `^1.2.3` å…è®¸ `1.x.x` æœ€æ–°ï¼‰ã€‚

> ğŸ”‘ **SemVer è§„åˆ™ç¤ºä¾‹**ï¼š
> - `^1.2.3` â†’ å…è®¸ `1.2.4`, `1.3.0`ï¼Œä½†ä¸å…è®¸ `2.0.0`
> - `~1.2.3` â†’ å…è®¸ `1.2.4`ï¼Œä½†ä¸å…è®¸ `1.3.0`

#### 3. **ä¾èµ–å»é‡ä¸æ‰å¹³åŒ–ï¼ˆnpm v2 vs v3+ï¼‰**
- **npm v2**ï¼šåµŒå¥—å®‰è£…ï¼ˆ`node_modules/a/node_modules/b`ï¼‰ï¼Œå¯¼è‡´é‡å¤ä¾èµ–ã€è·¯å¾„è¿‡é•¿ï¼›
- **npm v3+**ï¼š**æ‰å¹³åŒ–ç­–ç•¥**ï¼ˆå°½å¯èƒ½å°†ä¾èµ–æå‡åˆ°é¡¶å±‚ï¼‰ï¼š
  ```bash
  node_modules/
  â”œâ”€â”€ lodash@4.17.21      # è¢«å¤šä¸ªåŒ…ä¾èµ–ï¼Œåªå®‰è£…ä¸€ä»½
  â”œâ”€â”€ react@18.2.0
  â””â”€â”€ react-dom@18.2.0
      â””â”€â”€ node_modules/
          â””â”€â”€ react@18.2.0  # è‹¥ç‰ˆæœ¬å†²çªï¼Œæ‰åµŒå¥—
  ```
- **ç›®çš„**ï¼šå‡å°‘ç£ç›˜å ç”¨ï¼Œé¿å…â€œä¾èµ–åœ°ç‹±â€ã€‚

#### 4. **ä»ç¼“å­˜æˆ–ç½‘ç»œè·å–åŒ…**
- **ä¼˜å…ˆä½¿ç”¨æœ¬åœ°ç¼“å­˜**ï¼ˆ`~/.npm` æˆ–é¡¹ç›®çº§ç¼“å­˜ï¼‰ï¼›
- è‹¥ç¼“å­˜æœªå‘½ä¸­ï¼š
  - ä»é…ç½®çš„ registryï¼ˆå¦‚ `https://registry.npmjs.org`ï¼‰ä¸‹è½½ tarballï¼›
  - éªŒè¯åŒ…å®Œæ•´æ€§ï¼ˆé€šè¿‡ `integrity` å­—æ®µçš„ SHA å“ˆå¸Œï¼‰ã€‚

#### 5. **è§£å‹å¹¶æ„å»º `node_modules`**
- å°† tarball è§£å‹åˆ° `node_modules` å¯¹åº”ä½ç½®ï¼›
- æ‰§è¡ŒåŒ…çš„ **`preinstall` / `install` / `postinstall` è„šæœ¬**ï¼ˆå¦‚ `node-gyp` ç¼–è¯‘åŸç”Ÿæ¨¡å—ï¼‰ã€‚

#### 6. **æ›´æ–°æˆ–ç”Ÿæˆ `package-lock.json`**
- **lock æ–‡ä»¶ä½œç”¨**ï¼š
  - é”å®šæ‰€æœ‰ä¾èµ–çš„**ç²¾ç¡®ç‰ˆæœ¬ + å®Œæ•´ä¾èµ–æ ‘ + integrity å“ˆå¸Œ**ï¼›
  - ç¡®ä¿å›¢é˜Ÿæˆå‘˜å’Œ CI ç¯å¢ƒå®‰è£…**å®Œå…¨ä¸€è‡´**çš„ä¾èµ–ã€‚
- è‹¥ `package.json` æœ‰å˜æ›´ â†’ ç”Ÿæˆæ–° lock æ–‡ä»¶ï¼›
- è‹¥æ— å˜æ›´ â†’ ä»…éªŒè¯ lock æ–‡ä»¶æœ‰æ•ˆæ€§ã€‚

#### 7. **è¿è¡Œé¡¹ç›®ç”Ÿå‘½å‘¨æœŸè„šæœ¬**
- æ‰§è¡Œ `package.json` ä¸­å®šä¹‰çš„ï¼š
  - `prepare`ï¼ˆåœ¨æ‰“åŒ…å‰è¿è¡Œï¼‰
  - `prepublishOnly`ï¼ˆä»…å‘å¸ƒæ—¶è¿è¡Œï¼‰

---

### ä¸‰ã€å…³é”®æœºåˆ¶è§£æ

#### âœ… 1. **ç¡®å®šæ€§å®‰è£…ï¼ˆDeterministic Installï¼‰**
- `package-lock.json` ç¡®ä¿ï¼š  
  **æ— è®ºä½•æ—¶ã€ä½•åœ°æ‰§è¡Œ `npm install`ï¼Œç»“æœéƒ½å®Œå…¨ä¸€è‡´**ã€‚  
  ï¼ˆå¯¹æ¯”ï¼š`yarn` ç”¨ `yarn.lock`ï¼Œ`pnpm` ç”¨ `pnpm-lock.yaml`ï¼‰

#### âœ… 2. **ç¼“å­˜æœºåˆ¶**
- **HTTP ç¼“å­˜**ï¼šé¿å…é‡å¤è¯·æ±‚ registryï¼›
- **å†…å®¹ç¼“å­˜**ï¼šç›¸åŒ integrity çš„åŒ…åªå­˜å‚¨ä¸€ä»½ï¼›
- **CI ä¼˜åŒ–**ï¼šå¯ç¼“å­˜ `~/.npm` ç›®å½•åŠ é€Ÿåç»­æ„å»ºã€‚

#### âœ… 3. **å®‰å…¨æ ¡éªŒ**
- æ¯ä¸ªåŒ…çš„ `integrity` å­—æ®µï¼ˆSHA-512ï¼‰ç”¨äºéªŒè¯ä¸‹è½½å†…å®¹æœªè¢«ç¯¡æ”¹ï¼›
- è‹¥æ ¡éªŒå¤±è´¥ï¼Œå®‰è£…ä¸­æ­¢ã€‚

---

### å››ã€å¸¸è§é—®é¢˜ä¸è¡Œä¸º

| åœºæ™¯                               | npm è¡Œä¸º                                                      |
| ---------------------------------- | ------------------------------------------------------------- |
| **`npm install`ï¼ˆæ— å‚æ•°ï¼‰**        | æŒ‰ `package-lock.json` å®‰è£…ï¼Œå¿½ç•¥ `package.json` ä¸­çš„ç‰ˆæœ¬èŒƒå›´ |
| **`npm install pkg`**              | æ›´æ–° `package.json` + `package-lock.json`ï¼Œå®‰è£…æœ€æ–°å…¼å®¹ç‰ˆæœ¬   |
| **åˆ é™¤ `node_modules` åé‡è£…**     | ç»“æœä¸ä¹‹å‰å®Œå…¨ä¸€è‡´ï¼ˆå›  lock æ–‡ä»¶å­˜åœ¨ï¼‰                        |
| **ä¿®æ”¹ `package.json` å install** | é‡æ–°è®¡ç®—å—å½±å“å­æ ‘ï¼Œæ›´æ–° lock æ–‡ä»¶                            |

---

### äº”ã€ä¸å…¶ä»–åŒ…ç®¡ç†å™¨å¯¹æ¯”

| ç‰¹æ€§          | npm                 | Yarn           | pnpm                            |
| ------------- | ------------------- | -------------- | ------------------------------- |
| **ä¾èµ–ç»“æ„**  | æ‰å¹³åŒ–ï¼ˆå¯èƒ½é‡å¤ï¼‰  | æ‰å¹³åŒ–         | **ç¡¬é“¾æ¥ + ç¬¦å·é“¾æ¥**ï¼ˆæ— é‡å¤ï¼‰ |
| **lock æ–‡ä»¶** | `package-lock.json` | `yarn.lock`    | `pnpm-lock.yaml`                |
| **å®‰è£…é€Ÿåº¦**  | ä¸­ç­‰                | å¿«ï¼ˆå¹¶è¡Œä¸‹è½½ï¼‰ | **æå¿«**ï¼ˆæ— æ–‡ä»¶å¤åˆ¶ï¼‰          |
| **ç£ç›˜å ç”¨**  | é«˜                  | ä¸­             | **æä½**                        |

---

### å…­ã€ä¸€å¥è¯æ€»ç»“
> **`npm install` çš„æœ¬è´¨æ˜¯ä¸€æ¬¡â€œä¾èµ–å†³è®® + å®‰å…¨åˆ†å‘ + çŠ¶æ€å›ºåŒ–â€çš„è¿‡ç¨‹â€”â€”å®ƒé€šè¿‡ lock æ–‡ä»¶ç¡®ä¿å¯å¤ç°æ€§ï¼Œé€šè¿‡æ‰å¹³åŒ–å‡å°‘å†—ä½™ï¼Œé€šè¿‡ç¼“å­˜å’Œæ ¡éªŒå¹³è¡¡é€Ÿåº¦ä¸å®‰å…¨ã€‚**

## npm run start çš„æ•´ä¸ªè¿‡ç¨‹ï¼Ÿ

`npm run start` çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œæœ¬è´¨ä¸Šæ˜¯ **Node.js è°ƒç”¨ npm CLIï¼Œè§£æå¹¶è¿è¡Œ `package.json` ä¸­å®šä¹‰çš„ `start` è„šæœ¬å‘½ä»¤**ã€‚æ•´ä¸ªæµç¨‹æ¶‰åŠ **Shell ç¯å¢ƒã€è„šæœ¬æ‰§è¡Œã€è¿›ç¨‹ç®¡ç†** ç­‰å¤šä¸ªç¯èŠ‚ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†åˆ†è§£ï¼š

---

### ä¸€ã€æ•´ä½“æ‰§è¡Œæµç¨‹

![An Image](../public/assets/tongyi-mermaid-2026-01-05-140503.png)

---

### äºŒã€è¯¦ç»†æ­¥éª¤è§£æ

#### 1. **è§£æå‘½ä»¤**
- ç»ˆç«¯ï¼ˆå¦‚ Bashã€Zshã€PowerShellï¼‰å°† `npm run start` äº¤ç»™ **npm CLI**ï¼ˆå…¨å±€å®‰è£…çš„ `npm` å‘½ä»¤ï¼‰ï¼›
- `run` æ˜¯ npm çš„å­å‘½ä»¤ï¼Œ`start` æ˜¯ä¼ é€’ç»™å®ƒçš„å‚æ•°ã€‚

#### 2. **å®šä½é¡¹ç›®æ ¹ç›®å½•**
- npm ä»å½“å‰ç›®å½•å‘ä¸Šé€’å½’æŸ¥æ‰¾ **`package.json` æ–‡ä»¶**ï¼Œç¡®å®šé¡¹ç›®æ ¹è·¯å¾„ï¼›
- è‹¥æ‰¾ä¸åˆ° â†’ æŠ¥é”™ï¼š`No package.json found`ã€‚

#### 3. **è¯»å– `scripts` é…ç½®**
- è§£æ `package.json` ä¸­çš„ `scripts` å­—æ®µï¼š
  ```json
  {
    "scripts": {
      "start": "vite"  // æˆ– "react-scripts start", "node server.js" ç­‰
    }
  }
  ```
- å¦‚æœ `scripts.start` ä¸å­˜åœ¨ï¼Œnpm **ä¸ä¼šæŠ¥é”™**ï¼ˆç‰¹æ®Šè¡Œä¸ºï¼ï¼‰ï¼Œè€Œæ˜¯å°è¯•è¿è¡Œé»˜è®¤å‘½ä»¤ï¼š
  - **Node.js é¡¹ç›®**ï¼š`node server.js`
  - **ä½†ç°ä»£é¡¹ç›®é€šå¸¸æ˜¾å¼å®šä¹‰ `start`ï¼Œé¿å…æ­§ä¹‰**ã€‚

> âš ï¸ æ³¨æ„ï¼š  
> `npm start` æ˜¯ `npm run start` çš„ç®€å†™ï¼Œä¸¤è€…ç­‰ä»·ã€‚

#### 4. **å‡†å¤‡æ‰§è¡Œç¯å¢ƒ**
npm ä¼šä¸ºè„šæœ¬è®¾ç½®ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼ˆä¾›è„šæœ¬å†…éƒ¨ä½¿ç”¨ï¼‰ï¼š
- `npm_config_*`ï¼šnpm é…ç½®é¡¹ï¼ˆå¦‚ `npm_config_registry`ï¼‰
- `npm_package_*`ï¼š`package.json` ä¸­çš„å­—æ®µï¼ˆå¦‚ `npm_package_name`ï¼‰
- `PATH`ï¼šè‡ªåŠ¨åŠ å…¥ `node_modules/.bin`ï¼Œä½¿æœ¬åœ°å®‰è£…çš„ CLIï¼ˆå¦‚ `vite`, `webpack`ï¼‰å¯ç›´æ¥è°ƒç”¨ã€‚

> âœ… ä¾‹å¦‚ï¼šå³ä½¿æœªå…¨å±€å®‰è£… `vite`ï¼Œä¹Ÿèƒ½åœ¨è„šæœ¬ä¸­ç›´æ¥å†™ `vite`ã€‚

#### 5. **åœ¨å­ Shell ä¸­æ‰§è¡Œå‘½ä»¤**
- npm å¯åŠ¨ä¸€ä¸ª **æ–°çš„å­è¿›ç¨‹ï¼ˆchild processï¼‰**ï¼Œé€šè¿‡ç³»ç»Ÿ Shellï¼ˆå¦‚ `/bin/sh`ï¼‰æ‰§è¡Œè„šæœ¬å†…å®¹ï¼›
- ç¤ºä¾‹ï¼š
  ```bash
  # å®é™…æ‰§è¡Œçš„å‘½ä»¤ï¼ˆä¼ªä»£ç ï¼‰
  /bin/sh -c 'vite'
  ```
- è„šæœ¬ä¸­çš„å¤šä¸ªå‘½ä»¤å¯ç”¨ `&&`ã€`||`ã€`&` è¿æ¥ï¼ˆå¦‚ `"start": "npm run clean && vite"`ï¼‰ã€‚

#### 6. **è¿›ç¨‹ç”Ÿå‘½å‘¨æœŸç®¡ç†**
- å­è¿›ç¨‹ï¼ˆå¦‚ Vite å¼€å‘æœåŠ¡å™¨ï¼‰æ¥ç®¡ç»ˆç«¯è¾“å…¥/è¾“å‡ºï¼›
- **Ctrl+C** ä¼šå‘å­è¿›ç¨‹å‘é€ `SIGINT` ä¿¡å·ï¼Œè§¦å‘ä¼˜é›…å…³é—­ï¼›
- è‹¥è„šæœ¬é€€å‡ºç é `0`ï¼Œnpm ä¼šè®¤ä¸ºæ‰§è¡Œå¤±è´¥ï¼ˆCI ä¸­ä¼šå¯¼è‡´ pipeline ä¸­æ–­ï¼‰ã€‚

---

### ä¸‰ã€å…¸å‹ `start` è„šæœ¬ç¤ºä¾‹

| é¡¹ç›®ç±»å‹             | `start` è„šæœ¬                     | å®é™…å¯åŠ¨è¿›ç¨‹                                          |
| -------------------- | -------------------------------- | ----------------------------------------------------- |
| **Vite**             | `"start": "vite"`                | å¯åŠ¨åŸºäº ESBuild çš„å¼€å‘æœåŠ¡å™¨                         |
| **Create React App** | `"start": "react-scripts start"` | å¯åŠ¨ Webpack Dev Server                               |
| **Next.js**          | `"start": "next start"`          | å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨ï¼ˆéœ€å…ˆ buildï¼‰<br>ï¼ˆå¼€å‘ç”¨ `dev` è„šæœ¬ï¼‰ |
| **è‡ªå®šä¹‰ Node æœåŠ¡** | `"start": "node src/server.js"`  | ç›´æ¥è¿è¡Œ Node.js åº”ç”¨                                 |

> ğŸ’¡ æ³¨æ„ï¼š  
> - **å¼€å‘æœåŠ¡å™¨é€šå¸¸ç”¨ `dev` è„šæœ¬**ï¼ˆå¦‚ `"dev": "vite"`ï¼‰ï¼Œè€Œ `start` å¤šç”¨äº**ç”Ÿäº§å¯åŠ¨**ï¼›  
> - ä½† CRA ç­‰å·¥å…·é“¾å°† `start` ç”¨äºå¼€å‘ï¼Œå±å†å²çº¦å®šã€‚

---

### å››ã€å…³é”®ç‰¹æ€§ä¸æ³¨æ„äº‹é¡¹

#### âœ… 1. **è‡ªåŠ¨æ³¨å…¥ `node_modules/.bin` åˆ° PATH**
- æ— éœ€å†™å®Œæ•´è·¯å¾„ï¼š  
  âŒ `"start": "./node_modules/.bin/vite"`  
  âœ… `"start": "vite"`

#### âœ… 2. **æ”¯æŒè·¨å¹³å°è„šæœ¬ï¼ˆè°¨æ…ï¼‰**
- ç®€å•å‘½ä»¤ï¼ˆå¦‚ `vite`ï¼‰è·¨å¹³å°ï¼›
- å¤æ‚ Shell æ“ä½œï¼ˆå¦‚ `rm -rf`ï¼‰éœ€ç”¨è·¨å¹³å°åº“ï¼ˆå¦‚ `rimraf`ï¼‰ï¼š
  ```json
  "scripts": {
    "clean": "rimraf dist"
  }
  ```

#### âœ… 3. **ç¯å¢ƒå˜é‡ä¼ é€’**
- å¯åœ¨å‘½ä»¤å‰åŠ ç¯å¢ƒå˜é‡ï¼ˆUnix-likeï¼‰ï¼š
  ```json
  "start": "NODE_ENV=production node server.js"
  ```
- Windows éœ€ç”¨ `cross-env`ï¼š
  ```json
  "start": "cross-env NODE_ENV=production node server.js"
  ```

#### âŒ 4. **ä¸è¦åœ¨ `start` ä¸­è¿è¡Œé•¿æ—¶é—´åå°ä»»åŠ¡**
- `npm run start` ä¼š**é˜»å¡ç»ˆç«¯**ï¼Œé€‚åˆå‰å°æœåŠ¡ï¼ˆå¦‚ Web æœåŠ¡å™¨ï¼‰ï¼›
- åå°ä»»åŠ¡åº”ä½¿ç”¨ `pm2` æˆ–ç³»ç»ŸæœåŠ¡ç®¡ç†ã€‚

---

### äº”ã€è°ƒè¯•æŠ€å·§

#### 1. **æŸ¥çœ‹å®é™…æ‰§è¡Œå‘½ä»¤**
```bash
npm run start --dry-run
# æˆ–å¯ç”¨ verbose æ—¥å¿—
npm run start --loglevel=silly
```

#### 2. **æ£€æŸ¥ PATH æ˜¯å¦åŒ…å« .bin**
```json
"scripts": {
  "debug-path": "echo $PATH"
}
```

#### 3. **æ‰‹åŠ¨æ¨¡æ‹Ÿæ‰§è¡Œ**
```bash
# è¿›å…¥é¡¹ç›®ç›®å½•å
npx vite  # ç­‰ä»·äº npm run startï¼ˆè‹¥ start=viteï¼‰
```

---

### å…­ã€ä¸€å¥è¯æ€»ç»“
> **`npm run start` æ˜¯ npm æ ¹æ® `package.json` å¯åŠ¨ä¸€ä¸ªå­è¿›ç¨‹æ¥è¿è¡Œå¼€å‘æˆ–ç”Ÿäº§æœåŠ¡å™¨â€”â€”å®ƒè‡ªåŠ¨é…ç½®ç¯å¢ƒã€æ³¨å…¥æœ¬åœ° CLIï¼Œå¹¶å°†æ§åˆ¶æƒäº¤ç»™å®é™…çš„æ„å»ºå·¥å…·ï¼ˆå¦‚ Vite/Webpackï¼‰ï¼Œæ˜¯å‰ç«¯é¡¹ç›®å¯åŠ¨çš„æ ‡å‡†å…¥å£ã€‚**

## å¯¹ CSS å·¥ç¨‹åŒ–çš„ç†è§£

**CSS å·¥ç¨‹åŒ–**æ˜¯æŒ‡å°† CSS ä»£ç çº³å…¥ç°ä»£è½¯ä»¶å·¥ç¨‹ä½“ç³»ï¼Œé€šè¿‡**æ¨¡å—åŒ–ã€è‡ªåŠ¨åŒ–ã€å¯ç»´æŠ¤æ€§è®¾è®¡å’Œå·¥å…·é“¾æ”¯æŒ**ï¼Œè§£å†³ä¼ ç»Ÿ CSS åœ¨å¤§å‹é¡¹ç›®ä¸­é¢ä¸´çš„**å…¨å±€æ±¡æŸ“ã€å‘½åå†²çªã€å¤ç”¨å›°éš¾ã€ç»´æŠ¤æˆæœ¬é«˜**ç­‰é—®é¢˜ï¼Œä½¿å…¶å…·å¤‡ä¸ JavaScript ç›¸åŒçš„å·¥ç¨‹èƒ½åŠ›ã€‚

---

### ä¸€ã€ä¼ ç»Ÿ CSS çš„ç—›ç‚¹ï¼ˆä¸ºä»€ä¹ˆéœ€è¦å·¥ç¨‹åŒ–ï¼Ÿï¼‰

| é—®é¢˜           | è¡¨ç°                               |
| -------------- | ---------------------------------- |
| **å…¨å±€ä½œç”¨åŸŸ** | `.button { ... }` ä¼šæ±¡æŸ“æ•´ä¸ªé¡µé¢   |
| **å‘½åå†²çª**   | å¤šäººåä½œæ—¶ç±»åé‡å¤è¦†ç›–             |
| **å¤ç”¨å›°éš¾**   | ç›¸åŒæ ·å¼éœ€å¤åˆ¶ç²˜è´´ï¼ˆè¿å DRYï¼‰     |
| **æ— é€»è¾‘èƒ½åŠ›** | æ— æ³•ä½¿ç”¨å˜é‡ã€å‡½æ•°ã€æ¡ä»¶ç­‰ç¼–ç¨‹ç‰¹æ€§ |
| **ä¾èµ–ä¸æ˜ç¡®** | ä¸æ¸…æ¥šæŸä¸ª CSS æ–‡ä»¶è¢«å“ªäº›ç»„ä»¶ä½¿ç”¨  |

---

### äºŒã€CSS å·¥ç¨‹åŒ–çš„æ ¸å¿ƒç›®æ ‡

1. **å±€éƒ¨ä½œç”¨åŸŸï¼ˆScoped Stylesï¼‰**  
   â†’ æ ·å¼åªä½œç”¨äºå½“å‰ç»„ä»¶ï¼Œé¿å…å…¨å±€æ±¡æŸ“ã€‚
2. **æ¨¡å—åŒ–ä¸å¤ç”¨**  
   â†’ åƒ JS æ¨¡å—ä¸€æ ·å¯¼å…¥/å¯¼å‡ºæ ·å¼ã€‚
3. **æå‡å¼€å‘ä½“éªŒ**  
   â†’ æ”¯æŒå˜é‡ã€åµŒå¥—ã€å‡½æ•°ç­‰ç¼–ç¨‹ç‰¹æ€§ã€‚
4. **å¯ç»´æŠ¤æ€§ä¸å¯æ‰©å±•æ€§**  
   â†’ ç»“æ„æ¸…æ™°ï¼Œæ˜“äºå›¢é˜Ÿåä½œã€‚
5. **æ€§èƒ½ä¼˜åŒ–**  
   â†’ è‡ªåŠ¨å‹ç¼©ã€æå–å…³é”® CSSã€æŒ‰éœ€åŠ è½½ã€‚

---

### ä¸‰ã€ä¸»æµ CSS å·¥ç¨‹åŒ–æ–¹æ¡ˆ

#### âœ… 1. **CSS Modulesï¼ˆåŸºäºæ–‡ä»¶çš„å±€éƒ¨ä½œç”¨åŸŸï¼‰**
- **åŸç†**ï¼šæ„å»ºæ—¶å°†ç±»åå“ˆå¸ŒåŒ–ï¼Œç”Ÿæˆå”¯ä¸€æ ‡è¯†ã€‚
  ```css
  /* button.module.css */
  .primary { color: blue; }
  ```
  ```js
  import styles from './button.module.css';
  // å®é™…ç±»å â†’ primary__aB3cD
  <button className={styles.primary}>Click</button>
  ```
- **ä¼˜ç‚¹**ï¼šç®€å•ã€å…¼å®¹æ‰€æœ‰æ¡†æ¶ï¼›
- **ç¼ºç‚¹**ï¼šåŠ¨æ€ç±»åå¤„ç†éº»çƒ¦ï¼Œè°ƒè¯•æ—¶ç±»åä¸å¯è¯»ã€‚

#### âœ… 2. **CSS-in-JSï¼ˆæ ·å¼å†™åœ¨ JS ä¸­ï¼‰**
- **ä»£è¡¨åº“**ï¼šstyled-componentsï¼ˆReactï¼‰ã€Emotionï¼›
- **ç¤ºä¾‹**ï¼š
  ```jsx
  const Button = styled.button`
    color: ${props => props.primary ? 'blue' : 'gray'};
    padding: 8px 16px;
  `;
  ```
- **ä¼˜ç‚¹**ï¼š
  - å®Œå…¨å±€éƒ¨ä½œç”¨åŸŸï¼›
  - æ”¯æŒ JS é€»è¾‘ï¼ˆpropsã€çŠ¶æ€ï¼‰ï¼›
  - è‡ªåŠ¨ vendor prefixã€ä¸»é¢˜åˆ‡æ¢ã€‚
- **ç¼ºç‚¹**ï¼š
  - è¿è¡Œæ—¶å¼€é”€ï¼›
  - SSR éœ€é¢å¤–å¤„ç†ï¼›
  - å­¦ä¹ æˆæœ¬é«˜ã€‚

#### âœ… 3. **Scoped CSSï¼ˆå•æ–‡ä»¶ç»„ä»¶æ–¹æ¡ˆï¼‰**
- **ä»£è¡¨**ï¼šVue SFCã€Svelteï¼›
- **åŸç†**ï¼šç¼–è¯‘æ—¶ä¸ºç»„ä»¶å†… CSS æ·»åŠ å±æ€§é€‰æ‹©å™¨ã€‚
  ```vue
  <style scoped>
  .button { color: blue; }
  </style>
  <!-- ç¼–è¯‘å -->
  <button class="button" data-v-f3f3eg9>Click</button>
  <style>.button[data-v-f3f3eg9] { color: blue; }</style>
  ```
- **ä¼˜ç‚¹**ï¼šå¼€å‘ä½“éªŒæ— ç¼ï¼Œé›¶é…ç½®ï¼›
- **ç¼ºç‚¹**ï¼šä»…é™ç‰¹å®šæ¡†æ¶ã€‚

#### âœ… 4. **åŸå­åŒ– CSSï¼ˆUtility-Firstï¼‰**
- **ä»£è¡¨**ï¼šTailwind CSSã€Windi CSSï¼›
- **æ€æƒ³**ï¼šç”¨åŸå­ç±»ç»„åˆæ ·å¼ï¼Œè€Œéè¯­ä¹‰åŒ–ç±»åã€‚
  ```html
  <button class="text-blue-500 px-4 py-2 rounded">Click</button>
  ```
- **ä¼˜ç‚¹**ï¼š
  - æè‡´å¤ç”¨ï¼Œæ— å†—ä½™ CSSï¼›
  - è®¾è®¡ç³»ç»Ÿä¸€è‡´æ€§é«˜ï¼›
  - Tree Shaking ç§»é™¤æœªç”¨æ ·å¼ã€‚
- **ç¼ºç‚¹**ï¼š
  - HTML å¯è¯»æ€§ä¸‹é™ï¼›
  - éœ€è¦å­¦ä¹ æ–°è¯­ä¹‰ã€‚

---

### å››ã€é…å¥—å·¥ç¨‹åŒ–èƒ½åŠ›

#### ğŸ”§ 1. **é¢„å¤„ç†å™¨ï¼ˆPreprocessorsï¼‰**
- **Sass/Less/Stylus**ï¼šæä¾›å˜é‡ã€åµŒå¥—ã€æ··åˆï¼ˆmixinï¼‰ç­‰ï¼›
  ```scss
  $primary: #007bff;
  .btn {
    color: $primary;
    &:hover { opacity: 0.8; }
  }
  ```

#### ğŸ”§ 2. **PostCSSï¼ˆCSS åå¤„ç†ï¼‰**
- **ä½œç”¨**ï¼šå¯¹ç¼–è¯‘åçš„ CSS è¿›è¡Œè½¬æ¢ï¼›
- **å¸¸ç”¨æ’ä»¶**ï¼š
  - `autoprefixer`ï¼šè‡ªåŠ¨åŠ æµè§ˆå™¨å‰ç¼€ï¼›
  - `postcss-preset-env`ï¼šä½¿ç”¨æœªæ¥ CSS è¯­æ³•ï¼›
  - `cssnano`ï¼šå‹ç¼© CSSã€‚

#### ğŸ”§ 3. **æ„å»ºé›†æˆ**
- Webpack / Vite é€šè¿‡ loader/plugin å¤„ç† CSSï¼š
  - `css-loader`ï¼šè§£æ `@import` å’Œ `url()`ï¼›
  - `MiniCssExtractPlugin`ï¼šæå– CSS åˆ°ç‹¬ç«‹æ–‡ä»¶ï¼›
  - `PurgeCSS`ï¼šç§»é™¤æœªä½¿ç”¨çš„ CSSï¼ˆé…åˆ Tailwindï¼‰ã€‚

#### ğŸ”§ 4. **è®¾è®¡ç³»ç»Ÿä¸ä¸»é¢˜**
- é€šè¿‡ CSS Variables å®ç°åŠ¨æ€ä¸»é¢˜ï¼š
  ```css
  :root {
    --color-primary: #007bff;
  }
  .dark {
    --color-primary: #4da6ff;
  }
  .button { color: var(--color-primary); }
  ```

---

### äº”ã€é€‰å‹å»ºè®®

| é¡¹ç›®ç±»å‹           | æ¨èæ–¹æ¡ˆ                                 |
| ------------------ | ---------------------------------------- |
| **React æ–°é¡¹ç›®**   | Tailwind CSS + CSS Modulesï¼ˆæˆ– Emotionï¼‰ |
| **Vue é¡¹ç›®**       | Scoped CSS + Sass                        |
| **è®¾è®¡é©±åŠ¨äº§å“**   | Tailwind CSSï¼ˆå¿«é€Ÿå®ç° UI ä¸€è‡´æ€§ï¼‰       |
| **é«˜å®šåˆ¶åŒ–ç»„ä»¶åº“** | CSS Modules + PostCSS                    |
| **è¿½æ±‚æè‡´æ€§èƒ½**   | åŸå­åŒ– CSS + PurgeCSS                    |

---

### å…­ã€ä¸€å¥è¯æ€»ç»“
> **CSS å·¥ç¨‹åŒ–ä¸æ˜¯â€œç”¨ä»€ä¹ˆå·¥å…·â€ï¼Œè€Œæ˜¯â€œå¦‚ä½•è®©æ ·å¼å…·å¤‡æ¨¡å—åŒ–ã€å¯ç»´æŠ¤ã€å¯åä½œçš„å·¥ç¨‹å±æ€§â€â€”â€”å®ƒé€šè¿‡ä½œç”¨åŸŸéš”ç¦»ã€ç¼–ç¨‹èƒ½åŠ›å¢å¼ºå’Œè‡ªåŠ¨åŒ–å·¥å…·é“¾ï¼Œå°† CSS ä»â€œå…¨å±€è„šæœ¬â€å‡çº§ä¸ºâ€œä¸€ç­‰å…¬æ°‘æ¨¡å—â€ã€‚**
